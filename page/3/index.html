<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"qianyan.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Senior Consultant | DevOps Master | Blockchain &amp; Web3 Specialist">
<meta property="og:type" content="website">
<meta property="og:title" content="鄢倩">
<meta property="og:url" content="https://qianyan.github.io/page/3/index.html">
<meta property="og:site_name" content="鄢倩">
<meta property="og:description" content="Senior Consultant | DevOps Master | Blockchain &amp; Web3 Specialist">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Ryan Qian">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://qianyan.github.io/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>鄢倩</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">鄢倩</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">(conj clojurians me)</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ryan Qian</p>
  <div class="site-description" itemprop="description">Senior Consultant | DevOps Master | Blockchain & Web3 Specialist</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">81</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/qianyan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;qianyan" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:qianyan.lambda@gmail.com" title="E-Mail → mailto:qianyan.lambda@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://weibo.com/3672207020" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;3672207020" rel="noopener me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://x.com/_qian_yan" title="Twitter → https:&#x2F;&#x2F;x.com&#x2F;_qian_yan" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://lambdaisland.com/blog" title="https:&#x2F;&#x2F;lambdaisland.com&#x2F;blog" rel="noopener" target="_blank">Lambdaisland</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://www.youtube.com/@SystemCrafters" title="https:&#x2F;&#x2F;www.youtube.com&#x2F;@SystemCrafters" rel="noopener" target="_blank">System Crafters</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://aphyr.com/" title="https:&#x2F;&#x2F;aphyr.com" rel="noopener" target="_blank">Aphyr</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://bucharestfp.ro/" title="http:&#x2F;&#x2F;bucharestfp.ro" rel="noopener" target="_blank">Bucharest FP</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://blog.rlmflores.me/" title="http:&#x2F;&#x2F;blog.rlmflores.me&#x2F;" rel="noopener" target="_blank">Rodrigo Flores</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://seancorfield.github.io/" title="https:&#x2F;&#x2F;seancorfield.github.io&#x2F;" rel="noopener" target="_blank">Seancorfield</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2018/02/17/The-Simple-Summary-of-FP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ryan Qian">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鄢倩">
      <meta itemprop="description" content="Senior Consultant | DevOps Master | Blockchain & Web3 Specialist">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 鄢倩">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/02/17/The-Simple-Summary-of-FP/" class="post-title-link" itemprop="url">函数式编程简介</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2018-02-17 22:45:31 / 修改时间：22:45:56" itemprop="dateCreated datePublished" datetime="2018-02-17T22:45:31+08:00">2018-02-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="函数式编程是什么"><a href="#函数式编程是什么" class="headerlink" title="函数式编程是什么"></a>函数式编程是什么</h3><blockquote>
<p>函数式编程更加强调程序执行的结果而非执行的过程，倡导利用若干简单的执行单元让计算结果不断渐进，逐层推导复杂的运算，而不是设计一个复杂的执行过程。 – wiki</p>
</blockquote>
<h3 id="例子一-累加运算"><a href="#例子一-累加运算" class="headerlink" title="例子一 累加运算"></a>例子一 累加运算</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sum</span></span><br><span class="line">List&lt;Integer&gt; nums = Arrays.asList(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">sum</span><span class="params">(List&lt;Integer&gt; nums)</span> &#123;</span><br><span class="line">	<span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (Integer num : nums) &#123;</span><br><span class="line">		result += num;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sum(nums); <span class="comment">// -&gt; 46</span></span><br></pre></td></tr></table></figure>
<p>同样的代码用 Java8 Stream 实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Arrays.asList(0, 1, 2, 3, 4, 5, 6, 7, 8, 10).stream().reduce(0, Integer::sum);</span><br></pre></td></tr></table></figure>
<p>同样的代码用 Clojure 实现</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="built_in">apply</span></span> + [<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">10</span>]) <span class="comment">; -&gt; 46</span></span><br><span class="line">#_(<span class="name"><span class="built_in">reduce</span></span> + [<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">10</span>])</span><br></pre></td></tr></table></figure>
<h3 id="例子二-fabonacci数列"><a href="#例子二-fabonacci数列" class="headerlink" title="例子二 fabonacci数列"></a>例子二 fabonacci数列</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">fibonacci</span><span class="params">(<span class="type">int</span> number)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (number == <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(number == <span class="number">2</span>) &#123;</span><br><span class="line">	    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">3</span>; cnt &lt;= number; cnt++) &#123;</span><br><span class="line">		<span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a + b;</span><br><span class="line">		a = b;</span><br><span class="line">		b = c;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// java8</span><br><span class="line">Stream.iterate(new int[]&#123;1, 1&#125;, s -&gt; new int[]&#123;s[1], s[0] + s[1]&#125;)</span><br><span class="line">				.limit(10)</span><br><span class="line">				.map(n -&gt; n[1])</span><br><span class="line">				.collect(toList())</span><br><span class="line">// -&gt; [1, 2, 3, 5, 8, 13, 21, 34, 55, 89]</span><br></pre></td></tr></table></figure>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// clojure</span><br><span class="line">(<span class="name"><span class="built_in">-&gt;&gt;</span></span> (<span class="name"><span class="built_in">iterate</span></span> (<span class="name"><span class="built_in">fn</span></span> [[a b]] [b (<span class="name"><span class="built_in">+</span></span> a b)]) [<span class="number">1</span> <span class="number">1</span>])</span><br><span class="line">     (<span class="name"><span class="built_in">map</span></span> second)</span><br><span class="line">     (<span class="name"><span class="built_in">take</span></span> <span class="number">10</span>))</span><br><span class="line"><span class="comment">; -&gt; (1 2 3 5 8 13 21 34 55 89)  </span></span><br></pre></td></tr></table></figure>
<p>比起命令式的语言，函数式语言更加关注执行的结果，而非执行的过程。</p>
<h2 id="函数式编程的历史"><a href="#函数式编程的历史" class="headerlink" title="函数式编程的历史"></a>函数式编程的历史</h2><h3 id="从Hilbert-23个数学难题谈起"><a href="#从Hilbert-23个数学难题谈起" class="headerlink" title="从Hilbert 23个数学难题谈起"></a>从Hilbert 23个数学难题谈起</h3><p>1900年，Hilbert 提出了数学界悬而未决的10大问题，后续陆续添加成了23个问题，被称为著名的 Hilbert 23 Problem。针对其中第2个决定数学基础的问题——算术公理之相容性，年轻的哥德尔提出了哥德尔不完备定理，解决了这个问题形式化之后的前两点，即数学是完备的吗？数学是相容的吗？哥德尔用两条定理给出了否定的回答。所谓不完备，即系统中存在一个为真，但是无法在系统中推导出来的命题。比如：U说：“U在PM中不可证”。虽然和说谎者很类似，但其实有明显的差异。我们可以假设U为可证，那么可以推出PM是矛盾（不相容）的；但是假设U不可证，却推导不出PM是矛盾的。U的含义是在M中不可证，而事实上，它被证明不可证，所以U是PM中不可证的真命题。基于第一条不完备定理，又可以推导出第二条定理。如果一个（强度足以证明基本算术公理的）公理系统可以用来证明它自身的相容性，那么它是不相容的。</p>
<p>而最后一个问题，数学是确定的吗？也就是说，存在一个算法判定一个给定的命题是否是不确定的吗（Entscheidungsproblem 确定性问题）？这个问题引起了阿隆佐·邱奇和年轻的阿兰·图灵的兴趣。阿隆佐·邱奇的lambda calculus和图灵的图灵机构造出了可计算数，图灵的那篇论文  <em>ON COMPUTABLE NUMBERS, WITH AN APPLICATION TO THE ENTSCHEIDUNGSPROBLEM</em>  的意义不在于证明可计算数是否可数，而在于证明可判定性是否成立。在1936年他们对判定性问题分别独立给出了否定的答案。也就是现在被我们熟知的图灵停机问题：不存在这样一个程序（算法），它能够计算任何程序（算法）在给定输入上是否会结束（停机）。图灵借此发明了通用图灵机的概念，为后来的冯·诺依曼体系的计算机体系提供了理论基础。</p>
<h3 id="Lambda-Calculus"><a href="#Lambda-Calculus" class="headerlink" title="Lambda Calculus"></a>Lambda Calculus</h3><p><img src="http://upload-images.jianshu.io/upload_images/217988-bd2f325f4578f4c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Lambda Calculus"></p>
<p>Lambda 表达式包含三个要素</p>
<ol>
<li>变量</li>
<li>lambda 抽象</li>
<li>lambda 应用<br>据此我们可以用函数给出布尔值的定义<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data BOOL = FALSE | TRUE</span><br><span class="line">TRUE = λx.λy.x</span><br><span class="line">FALSE = λx.λy.y</span><br><span class="line"></span><br><span class="line">not = λb.b FALSE TRUE</span><br><span class="line">and = λb1.λb2.b1 b2 FALSE</span><br><span class="line">or  = λb1.λb2.b1 TRUE b2</span><br><span class="line">xor = λb1.λb2.b1 (not b2) b2</span><br></pre></td></tr></table></figure>
自然数的定义<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data NAT = Z | S NAT</span><br><span class="line">0 = λf.λs.s</span><br><span class="line">1 = λf.λs.f s</span><br><span class="line">2 = λf.λs.f f s</span><br><span class="line"></span><br><span class="line">succ n = λf.λs.f (n f s)</span><br><span class="line">zero? n = n (λb.FALSE) TRUE</span><br><span class="line">add = succ n1 n2</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="函数式编程语言的发展"><a href="#函数式编程语言的发展" class="headerlink" title="函数式编程语言的发展"></a>函数式编程语言的发展</h3><p>在这之后，随着通用计算机的产生，人们发觉使用机器码写程序太没有效率。所以1956年左右，John Buckus发明了Fortran（FORmula TRANslating 的缩写）语言，如果对编译原理有了解，那么对BNF范式就不陌生了。与此同时，John McCarthy 发明了Lisp语言，现代的Clojure就是Lisp的方言之一。1966年，Niklaus Wirth发明了Pascal。1969年，Ken Thompson和Dennis Ritchie发明了C语言，过程式语言由于其高效和可移植性迅速崛起。1973年，Robin Milner 发明了ML（Meta Language），后来演变成了OCaml和Stardard ML。1977年，John Buckus在其图灵奖的演讲中创造了 Functional Programming 这个词。1990年，惰性求值的函数式编程语言 Haskell 1.0 发布。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/217988-b32e43ff96d620f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="编程语言发展历史"></p>
<h3 id="神奇的-Y-Combinator"><a href="#神奇的-Y-Combinator" class="headerlink" title="神奇的 Y Combinator"></a>神奇的 Y Combinator</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(def Y (fn [f]</span><br><span class="line">         ((fn [x] (x x))</span><br><span class="line">          (fn [x]</span><br><span class="line">            (f (fn [y]</span><br><span class="line">                 ((x x) y)))))))</span><br></pre></td></tr></table></figure>

<h3 id="Lisp、ML以及Haskell的关系"><a href="#Lisp、ML以及Haskell的关系" class="headerlink" title="Lisp、ML以及Haskell的关系"></a>Lisp、ML以及Haskell的关系</h3><p>Lisp是动态语言，使用S表达式<br>ML和Haskell都是静态强类型函数式语言<br>ML是第一个使用Hindley-Milner type inference algorithm的语言<br>Lisp和ML都是call-by-value，但是Haskell则是call-by-name<br>Lisp和ML都是不纯的编程语言，但是Haskell是side effect free的</p>
<h2 id="函数是一等公民"><a href="#函数是一等公民" class="headerlink" title="函数是一等公民"></a>函数是一等公民</h2><p>函数是一等公民，指的是你可以将函数作为参数、返回值、数据结构存在，而且不仅可以用函数名引用，甚至可以匿名调用。</p>
<h3 id="1-作为参数"><a href="#1-作为参数" class="headerlink" title="1. 作为参数"></a>1. 作为参数</h3><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="built_in">map</span></span> inc [<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span>]) <span class="comment">;-&gt; (2 3 4 5 6) ;; inc is an argument</span></span><br></pre></td></tr></table></figure>
<h3 id="2-作为返回值"><a href="#2-作为返回值" class="headerlink" title="2. 作为返回值"></a>2. 作为返回值</h3><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">defn</span> <span class="title">add</span> [num] </span><br><span class="line">    (<span class="name"><span class="built_in">fn</span></span> [other-num] (<span class="name"><span class="built_in">+</span></span> num other-num))) <span class="comment">;; as return-value</span></span><br><span class="line">(<span class="keyword">def</span> <span class="title">add-one</span> (<span class="name">add</span> <span class="number">1</span>))</span><br><span class="line">(<span class="name">add-one</span> <span class="number">2</span>) <span class="comment">;-&gt; 3</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">defn</span> <span class="title">flip</span> [f]  <span class="comment">;; as argument and return-value</span></span><br><span class="line">  (<span class="name"><span class="built_in">fn</span></span> [x y]</span><br><span class="line">    (<span class="name">f</span> y x)))</span><br></pre></td></tr></table></figure>
<h3 id="3-数据结构"><a href="#3-数据结构" class="headerlink" title="3. 数据结构"></a>3. 数据结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(def dictionary &#123;:a &quot;abandon&quot;&#125;) ;; map is also a function, data is code.</span><br><span class="line">(dictionary :a) ;-&gt; &quot;abandon&quot;</span><br><span class="line">(:a dictionary) ;-&gt; &quot;abandon&quot;</span><br></pre></td></tr></table></figure>
<h3 id="4-匿名函数"><a href="#4-匿名函数" class="headerlink" title="4. 匿名函数"></a>4. 匿名函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">((fn [x] (* x x))</span><br><span class="line">        2) ;-&gt; 4</span><br><span class="line">    </span><br><span class="line">(map </span><br><span class="line">    (fn [num] (+ 1 num)) ;; anonymous function</span><br><span class="line">    [1 2 3 4 5]) ;-&gt; (2 3 4 5 6)</span><br></pre></td></tr></table></figure>
<h3 id="5-模块化"><a href="#5-模块化" class="headerlink" title="5. 模块化"></a>5. 模块化</h3><p>在面向对象中，对象是一等公民。所以我们处处要从对象的角度去考虑计算问题，然后产生一种共识——数据应该和它相关的操作放到一起，也就是我们所说的封装。确实没错，但是我们得知道封装的意义在哪里？功能内聚好理解（分块）和局部性影响（控制可变性）。函数式编程同样考虑这些，功能内聚不一定要用类的方式（考虑一下JS的prototype，也是一种面向对象），只要模块做得好，一样能达到效果。局部性影响，其本质是封装可变因素以避免其扩散到代码各处。函数式给出了自己的答案，消除可变因素。</p>
<p>高阶函数和惰性求值也非常有利于模块化。</p>
<h2 id="纯函数和不可变性"><a href="#纯函数和不可变性" class="headerlink" title="纯函数和不可变性"></a>纯函数和不可变性</h2><p>纯函数是指执行过程中没有副作用的函数，所谓副作用是说超出函数控制的操作，比如在执行过程中操作文件系统、数据库等外部资源。纯函数还具有引用透明性的特点，也就是同样的输入导致同样的输出，以至于完全可以用函数的值代替对函数的调用。</p>
<h3 id="引用透明"><a href="#引用透明" class="headerlink" title="引用透明"></a>引用透明</h3><p>举个例子：</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="built_in">inc</span></span> <span class="number">1</span>) <span class="comment">; -&gt; 2</span></span><br><span class="line"></span><br><span class="line">(<span class="name"><span class="built_in">=</span></span> (<span class="name"><span class="built_in">inc</span></span> (<span class="name"><span class="built_in">inc</span></span> <span class="number">1</span>)</span><br><span class="line">   (<span class="name"><span class="built_in">inc</span></span> <span class="number">2</span>))) <span class="comment">; -&gt; true</span></span><br></pre></td></tr></table></figure>
<p>你们可能就会问，这种东西究竟有什么用呢？纯函数可以很方便地进行缓存。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(defn fibonacci [number]</span><br><span class="line">  (if (or (zero? number) (= 1 number)) 1</span><br><span class="line">      (+</span><br><span class="line">       (fibonacci (dec number))</span><br><span class="line">       (fibonacci (- number 2)))))</span><br><span class="line">(fibonacci 30) ; -&gt; &quot;Elapsed time: 185.690208 msecs&quot;</span><br><span class="line"></span><br><span class="line">(def fibonacci</span><br><span class="line">  (memoize (fn [number] ;;</span><br><span class="line">             (if (or (zero? number) (= 1 number)) 1</span><br><span class="line">                 (+</span><br><span class="line">                  (fibonacci (dec number))</span><br><span class="line">                  (fibonacci (- number 2)))))))</span><br><span class="line">(fibonacci 30) ; -&gt; &quot;Elapsed time: 0.437114 msecs&quot;</span><br></pre></td></tr></table></figure>
<h3 id="不可变计算"><a href="#不可变计算" class="headerlink" title="不可变计算"></a>不可变计算</h3><p>谈到不可变性，我们做个游戏。统计在座的一共有多少人数。我们都知道从某个人开始依次报数，最后得到的数字就是总人数，其实这就是一种不可变计算的游戏，为什么这么说呢？因为报数其实一个计算的过程，第一个人计算出1这个数，传递给第二个人。然后第二个人拿着前面的1进行加一操作，然后把结果2传递给后面的人做加法，以此类推。为了提高统计的效率，我也可以进行分组，然后每组自行报数，最后统计结果。但是如果我在白板上写个数字1，然后让大家来过来该这个数字，很大可能会出现错误，因为这个数字成为了竞态条件。在多并发的情况下，就得用读写锁来控制。所以不可变性特别利于并发。<br><img src="http://upload-images.jianshu.io/upload_images/217988-83061fa854cfadf2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="不可变性"></p>
<h3 id="不可变的链式结构"><a href="#不可变的链式结构" class="headerlink" title="不可变的链式结构"></a>不可变的链式结构</h3><p>好了，现在我们有个新的需求，设计一个不可变列表收集大家的名字。每个节点存储一个姓名的字符串，并且有个指针指向下一个节点。但是这也打破了列表的不可变性。怎么办？我们可以把新的节点指向旧有的列表，然后返回一个新的列表。这就是不可变列表实现的机制。随便一提，这也是区块链不可变特征的由来。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/217988-f83728f3beea90e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="不可变的链式结构"></p>
<p>Clojure的创造者Rich Hickey扩展了Ideal Hash Tree数据结构，实现了Persistent Vector。由于此处的叶子节点可以扩展成32个，所以可以大量存储数据。利用Ideal Hash Tree的特点可以快速索引出数据，与此同时，数据的“增删改”也能做到近常数化的时间，并且总是产生新的数据结构替换原有的数据结构，即一种不可变的链式存储结构。<br><img src="http://upload-images.jianshu.io/upload_images/217988-db581f0f87265914.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Clojure Persistent Vector"></p>
<h3 id="不可变的树状结构"><a href="#不可变的树状结构" class="headerlink" title="不可变的树状结构"></a>不可变的树状结构</h3><p>Zipper数据结构类似于文本编辑器中的 gap buffer，编辑文本时，光标左边和右边分别是独立的buffer，光标处也是单独的buffer，这样便可以方便地添加文字，也很方便删除左右buffer中的文字；移动光标会涉及buffer之间的拷贝。基本上能在常数时间内完成编辑。Zipper数据结构模仿了这种方式，能在常数时间内完成树的编辑工作，也能很快地重新构建一棵树。<br><img src="http://upload-images.jianshu.io/upload_images/217988-6017ad15b573ab02.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="不可变的树状结构"></p>
<h2 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h2><p>可计算很大问题就是得实现递归功能。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(defn reverse-seq [coll]</span><br><span class="line">  (when-let [elem (first coll)]</span><br><span class="line">    (concat (reverse-seq (rest coll)) [elem])))</span><br><span class="line">(reverse-seq [1 2 3]) ; -&gt; (3 2 1)</span><br></pre></td></tr></table></figure>
<p>和循环无异的尾递归</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(defn gcd [&amp; nums]</span><br><span class="line">  (reduce #(if (zero? %2)</span><br><span class="line">                %</span><br><span class="line">                (recur %2 (mod % %2))) nums))</span><br><span class="line">(gcd 8 16) ; -&gt; 8                </span><br></pre></td></tr></table></figure>
<h2 id="生成式测试"><a href="#生成式测试" class="headerlink" title="生成式测试"></a>生成式测试</h2><p>生成式测试会基于输入假设输出，并且生成许多可能的数据验证假设的正确性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(defn add [a b]</span><br><span class="line">  (+ a b))</span><br><span class="line">;; 任取两个整数，把a和b加起来的结果减去a总会得到b。</span><br><span class="line">(def test-add</span><br><span class="line">  (prop/for-all [a (gen/int)</span><br><span class="line">                 b (gen/int)]</span><br><span class="line">                (= (- (add a b) a) b)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(tc/quick-check 100 test-add)</span><br><span class="line">; -&gt; &#123;:result true, :num-tests 100, :seed 1515935038284&#125;</span><br></pre></td></tr></table></figure>

<p>测试结果表明，刚才运行了100组测试，并且都通过了。理论上，程序可以生成无数的测试数据来验证add方法的正确性。即便不能穷尽，我们也获得一组统计上的数字，而不仅仅是几个纯手工挑选的用例。</p>
<h2 id="抽象是什么"><a href="#抽象是什么" class="headerlink" title="抽象是什么"></a>抽象是什么</h2><p>抽取共性，封装细节，忘记不重要的差异点。这样的好处是可以做到局部化影响和延迟决策。<br><img src="http://upload-images.jianshu.io/upload_images/217988-f9b16b9dc18ba66c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="抽象屏障"></p>
<h3 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h3><p>命名就是一种抽象，重构中最重要的技法就是重命名和提取小函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(* 3 3 3)</span><br><span class="line">(* x x x)</span><br><span class="line">(* y y y)</span><br><span class="line">-&gt;</span><br><span class="line">(defn cube [x]</span><br><span class="line">  (* x x x))</span><br></pre></td></tr></table></figure>
<h3 id="延迟决策"><a href="#延迟决策" class="headerlink" title="延迟决策"></a>延迟决策</h3><p>例如：我们定义数对 pair</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pair:: (cons x y)</span><br><span class="line">first pair -&gt; x</span><br><span class="line">second pair -&gt; y</span><br></pre></td></tr></table></figure>
<p>那么它的具体实现会是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(defn cons [x y]</span><br><span class="line">  (fn [m]</span><br><span class="line">    (cond (= m 0) x</span><br><span class="line">          (= m 1) y)))</span><br><span class="line">(defn first [z]</span><br><span class="line">  (z 0))</span><br><span class="line">(defn second [z]</span><br><span class="line">  (z 1))</span><br></pre></td></tr></table></figure>
<p>也可以是这样的，还可以是其它各种各样的形式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(defn cons [x y]</span><br><span class="line">  (fn [b]</span><br><span class="line">    (b x y))</span><br><span class="line">(defn first [z]</span><br><span class="line">    (z (fn [x y] x)))</span><br><span class="line">(defn second [z]</span><br><span class="line">    (z (fn [x y] y)))</span><br></pre></td></tr></table></figure>
<h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><p>高阶函数就是可以接收函数的函数，高阶函数提供了足够的抽象，屏蔽了很多底层的实现细节。比如Clojure中的<code>map</code>高阶函数，它接收<code>(fn [v] ...)</code>，把一组数据映射成另外一组数据。</p>
<h3 id="过程抽象"><a href="#过程抽象" class="headerlink" title="过程抽象"></a>过程抽象</h3><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="built_in">map</span></span> inc [<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span>]) <span class="comment">; -&gt; (2 3 4 5 6)</span></span><br></pre></td></tr></table></figure>
<p>这些函数抽象出映射这样语义，除了容易记忆，还能很方便地重新编写成高效的底层实现。也就是说，一旦出现了更高效的<code>map</code>实现算法，现有的代码都能立刻从中受益。</p>
<h2 id="函数的组合"><a href="#函数的组合" class="headerlink" title="函数的组合"></a>函数的组合</h2><p>函数组合之后会产生巨大的能量</p>
<h3 id="神奇的加法"><a href="#神奇的加法" class="headerlink" title="神奇的加法"></a>神奇的加法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(((comp (map inc) (filter odd?)) +) 1 2) ; -&gt; 4</span><br></pre></td></tr></table></figure>
<p>怎么去理解这个函数的组合？我们给它取个好听的名字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(def special+ ((comp (map inc) (filter odd?)) +))</span><br><span class="line">(special+ 1 2) ; -&gt; 4</span><br><span class="line"></span><br><span class="line">; &lt;=&gt; 等价于</span><br><span class="line">(if (odd? (inc 2))</span><br><span class="line">    (+ 1 3))</span><br><span class="line">    1)</span><br></pre></td></tr></table></figure>
<p>这个未必是个好的组合方式，但是不可否认的是，我们可以用这些随意地将这些函数组合到一起，得到我们想要的结果。</p>
<h3 id="transducer"><a href="#transducer" class="headerlink" title="transducer"></a>transducer</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(def xf (comp (filter odd?) (take 10)))</span><br><span class="line">(transduce xf conj (range))</span><br><span class="line">;; [1 3 5 7 9 11 13 15 17 19]</span><br></pre></td></tr></table></figure>
<p>这里直接将求值延迟到了<code>transduce</code>计算的时候，换句话说，<code>xf</code>定义了一种过程：filter出奇数并取出前10个元素。同等的代码，如果用表达式直接书写的话，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(-&gt;&gt; (range)</span><br><span class="line">     (filter odd?)</span><br><span class="line">     (take 10))</span><br></pre></td></tr></table></figure>
<p>这里的问题就是我们没能使用高阶函数抽象出过程，如果把 conj 换成其他的reduce运算，现在的过程无法支撑，但是tranducers可以！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(transduce xf + (range)) ;-&gt; 100</span><br></pre></td></tr></table></figure>
<p>我们再看一个tranducer的神奇使用方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">(defn log [&amp; [idx]]</span><br><span class="line">  (fn [rf]</span><br><span class="line">    (fn</span><br><span class="line">      ([] (rf))</span><br><span class="line">      ([result] (rf result))</span><br><span class="line">      ([result el]</span><br><span class="line">        (let [n-step (if idx (str &quot;Step: &quot; idx &quot;. &quot;) &quot;&quot;)]</span><br><span class="line">          (println (format &quot;%sResult: %s, Item: %s&quot; n-step result el)))</span><br><span class="line">        (rf result el)))))</span><br><span class="line"></span><br><span class="line">(def ^:dynamic *dbg?* false)</span><br><span class="line"></span><br><span class="line">(defn comp* [&amp; xforms]</span><br><span class="line">  (apply comp</span><br><span class="line">         (if *dbg?*</span><br><span class="line">           (-&gt;&gt; (range)</span><br><span class="line">                (map log)</span><br><span class="line">                (interleave xforms))</span><br><span class="line">           xforms)))</span><br><span class="line"></span><br><span class="line">(binding [*dbg?* true]</span><br><span class="line">  (transduce</span><br><span class="line">   (comp*</span><br><span class="line">    (map inc)</span><br><span class="line">    (filter odd?))</span><br><span class="line">   +</span><br><span class="line">   (range 5))) ;; -&gt; 9</span><br><span class="line">   </span><br><span class="line">Step: 0. Result: 0, Item: 1</span><br><span class="line">Step: 1. Result: 0, Item: 1</span><br><span class="line">Step: 0. Result: 1, Item: 2</span><br><span class="line">Step: 0. Result: 1, Item: 3</span><br><span class="line">Step: 1. Result: 1, Item: 3</span><br><span class="line">Step: 0. Result: 4, Item: 4</span><br><span class="line">Step: 0. Result: 4, Item: 5</span><br><span class="line">Step: 1. Result: 4, Item: 5</span><br></pre></td></tr></table></figure>
<p>之所以会出现上述的结果，是因为<code>interleave xforms</code>将<code>(map inc)</code>以及<code>(filter odd?)</code>和logs进行了交叉，得到的结果是<code>(comp (map inc) (log) (filter odd?) (log))</code>，所以如果是偶数就会被filter清除，看不见log了。</p>
<p>首先一定得理解：每个tranducer函数都是同构的！<br>形式如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(defn m [f]</span><br><span class="line">    (fn [rf] </span><br><span class="line">        (fn [result elem]</span><br><span class="line">            (rf result (f elem)))))</span><br></pre></td></tr></table></figure>
<p>这意味着<code>(m f)</code>的函数都是可以组合的，组合的形式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(comp (m f) (m1 f1) ...)</span><br></pre></td></tr></table></figure>
<p>展开之后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">((m f) </span><br><span class="line">    ((m1 f1) </span><br><span class="line">        ((m2 f2) ...)))</span><br><span class="line">-&gt;</span><br><span class="line">(fn [result elem]</span><br><span class="line">    (((m1 f1) </span><br><span class="line">        ((m2 f2) ...)) result (f elem)))</span><br></pre></td></tr></table></figure>
<p>所以可以看到第一个执行的一定是 comp 的首个 reducing function 参数。故：</p>
<ol>
<li>xform 作为组合的前提</li>
<li>执行顺序从左到右；</li>
<li><code>+</code> 作为 reducing function 最后执行；</li>
</ol>
<h3 id="Monad"><a href="#Monad" class="headerlink" title="Monad"></a>Monad</h3><p>什么是<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/324c9ce77317">Monad</a>呢？A monad is just a monoid in the category of endofunctors.</p>
<ol>
<li>Identity—For a monad m, m flatMap unit &#x3D;&gt; m </li>
<li>Unit—For a monad m, unit(v) flatMap f &#x3D;&gt; f(v) </li>
<li>Associativity—For a monad m, m flatMap g flatMap h &#x3D;&gt; m flatMap {x &#x3D;&gt; g(x) flatMap h} <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">// java8 实现的 9*9 乘法表</span><br><span class="line">public class ListMonad&lt;T&gt; &#123;</span><br><span class="line">    private List&lt;T&gt; elements;</span><br><span class="line"></span><br><span class="line">    private ListMonad(T elem) &#123;</span><br><span class="line">        this.elements = singletonList(elem);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private ListMonad(List&lt;T&gt; elems) &#123;</span><br><span class="line">        this.elements = elems;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;U&gt; ListMonad&lt;U&gt; flatmap(Function&lt;T, ListMonad&lt;U&gt;&gt; fn) &#123;</span><br><span class="line">        List&lt;U&gt; newElements = new ArrayList&lt;&gt;();</span><br><span class="line">        this.elements.forEach(elem -&gt; newElements.addAll(fn.apply(elem).elements));</span><br><span class="line">        return new ListMonad&lt;&gt;(newElements);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;X&gt; ListMonad&lt;X&gt; uint(X elem) &#123;</span><br><span class="line">        return new ListMonad&lt;&gt;(elem);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;U&gt; ListMonad&lt;U&gt; apply(ListMonad&lt;Function&lt;T, U&gt;&gt; m) &#123;</span><br><span class="line">        return m.flatmap(this::map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;U&gt; ListMonad&lt;U&gt; map(Function&lt;T, U&gt; fn) &#123;</span><br><span class="line">        return flatmap(t -&gt; uint(fn.apply(t)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ListMonad&lt;Integer&gt; m = new ListMonad&lt;&gt;(Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9));</span><br><span class="line">        ListMonad&lt;Integer&gt; m1 = new ListMonad&lt;&gt;(Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9));</span><br><span class="line"></span><br><span class="line">        ListMonad&lt;Integer&gt; list = m.apply(m1.map(x -&gt; y -&gt; x * y));</span><br><span class="line">        // [1...81]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="表达式优于语句"><a href="#表达式优于语句" class="headerlink" title="表达式优于语句"></a>表达式优于语句</h2><h3 id="S表达式"><a href="#S表达式" class="headerlink" title="S表达式"></a>S表达式</h3><ol>
<li>原子，或者；</li>
<li>形式为 (x • y) 的表达式，其中x和y也是S表达式。</li>
</ol>
<p>举个例子，递增一组数据，过滤奇数，然后进行排序，最终取出第一个。如果取不到，返回<code>:not-found</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(-&gt; [1 2 3] </span><br><span class="line">    (-&gt;&gt; (map inc) </span><br><span class="line">         (filter odd?) </span><br><span class="line">         (sort) </span><br><span class="line">         (first)) </span><br><span class="line">    (or :not-found))</span><br><span class="line">; -&gt; 3 </span><br><span class="line">(-&gt; [1 1 3] </span><br><span class="line">    (-&gt;&gt; (map inc) </span><br><span class="line">         (filter odd?) </span><br><span class="line">         (sort) </span><br><span class="line">         (first)) </span><br><span class="line">    (or :not-found)</span><br><span class="line">; -&gt; :not-found    </span><br></pre></td></tr></table></figure>
<p>当然你也可以写成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(if-let [r (first (sort (filter odd? (map inc [1 1 1]))))] </span><br><span class="line">    r </span><br><span class="line">    :not-found)</span><br><span class="line">; -&gt; :not-found    </span><br></pre></td></tr></table></figure>
<p>其实两者都是S表达式，但是下面的写法更加偏向于语句。从串联起来读来讲，前者明显是由于后者的。这要是放在其他函数式语言上，效果更加显著。比如下面重构if-else控制语句到Optional类型。</p>
<h3 id="if-else-Optional"><a href="#if-else-Optional" class="headerlink" title="if-else -&gt; Optional"></a>if-else -&gt; Optional</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Rule&gt; rule = ruleOf(id);</span><br><span class="line"><span class="keyword">if</span>(rule.isPresent()) &#123;</span><br><span class="line">    <span class="keyword">return</span> transform(rule.get());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Rule <span class="title function_">transform</span><span class="params">(Rule rule)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Rule.builder()</span><br><span class="line">                .withName(<span class="string">&quot;No.&quot;</span> + rule.getId())</span><br><span class="line">                .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是典型的语句可以重构到表达式的场景，关键是怎么重构呢？<br>第一步，调转<code>if</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Optional</span> <span class="variable">rule</span> <span class="operator">=</span> ruleOf(id);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!rule.isPresent()) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">&#125; </span><br><span class="line">   </span><br><span class="line"><span class="keyword">return</span> transform(rule.get());</span><br></pre></td></tr></table></figure>
<p>第二步，<code>Optional.map</code>函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">return</span> rule.map(r -&gt; transform(r)).get();</span><br></pre></td></tr></table></figure>
<p>第三步，<code>inline transform</code>函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">rule.map(r -&gt; Rule.builder()</span><br><span class="line">                    .withName(&quot;No.&quot; + r.getId())</span><br><span class="line">                    .build()).get();</span><br></pre></td></tr></table></figure>
<p>第四步，<code>Optional.orElseThrow</code>函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">rule.map(r -&gt; Rule.builder()</span><br><span class="line">                    .withName(&quot;No.&quot; + r.getId())</span><br><span class="line">                    .build())</span><br><span class="line">    .orElseThrow(() -&gt; new RuntimeException());</span><br></pre></td></tr></table></figure>
<p>第五步，注<code>if</code>释语句中的<code>throw new RuntimeException()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(!rule.isPresent()) &#123;</span><br><span class="line">   // throw new RuntimeException();</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>这时候发现语句中为空，即可将整个语句删除。可以考虑<code>inline rule</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ruleOf(id).map(r -&gt; Rule.builder()</span><br><span class="line">                    .withName(&quot;No.&quot; + r.getId())</span><br><span class="line">                    .build())</span><br><span class="line">    .orElseThrow(() -&gt; new RuntimeException());</span><br></pre></td></tr></table></figure>
<p>完毕。</p>
<h2 id="我们认识事物的方式"><a href="#我们认识事物的方式" class="headerlink" title="我们认识事物的方式"></a>我们认识事物的方式</h2><ol>
<li>把几个简单的想法合并成一个复合概念，从而创造出所有复杂的概念。</li>
<li>简单的或复杂的两种思想融合在一起，并立即把它们联系起来，不要把它们统一起来，从而得到它所有的关系思想。</li>
<li>把他们与其他所有陪伴他们的真实存在的想法分开：这就是所谓的抽象，因此所有的一般想法都是被提出来的。</li>
</ol>
<h2 id="推荐的书籍"><a href="#推荐的书籍" class="headerlink" title="推荐的书籍"></a>推荐的书籍</h2><ol>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1391740/">逻辑的引擎</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26587213/">函数式编程思维</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1148282/">算机程序的构造和解释</a><br><img src="http://upload-images.jianshu.io/upload_images/217988-8bb6c8f3354a5640.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="推荐的书籍"></li>
</ol>
<hr>
<p>参考资料</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%81%9C%E6%9C%BA%E9%97%AE%E9%A2%98">图灵停机问题</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/pongba/article/details/1336028">康托尔、哥德尔、图灵 - 永恒的金色对角线</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.klipse.tech/lambda/2016/08/07/pure-y-combinator-clojure.html">Y combinator in Clojure</a></li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%B8%8C%E5%B0%94%E4%BC%AF%E7%89%B9%E7%9A%8423%E4%B8%AA%E9%97%AE%E9%A2%98">希尔伯特的23个问题</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/28112037">再谈哥德尔不完备定理</a></li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%87%BD%E6%95%B8%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80">wiki 函数式编程</a></li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%CE%9B%E6%BC%94%E7%AE%97">lambda 演算</a></li>
<li><a target="_blank" rel="noopener" href="http://athena.ecs.csus.edu/~csc135fp/project/history.html">History of functional programming</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/24648375">函数式编程的早期历史</a></li>
<li><a target="_blank" rel="noopener" href="http://www.sohu.com/a/164321809_136745">走进计算机文化史</a></li>
<li><a target="_blank" rel="noopener" href="https://sarabander.github.io/sicp/html/index.xhtml">SICP</a></li>
<li><a target="_blank" rel="noopener" href="http://www.math.cmu.edu/~wgunther/talks/gsLambdaCalculus.pdf">Lambda Calculus and the Decision Problem</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2018/02/04/the-victorian-internet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ryan Qian">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鄢倩">
      <meta itemprop="description" content="Senior Consultant | DevOps Master | Blockchain & Web3 Specialist">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 鄢倩">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/02/04/the-victorian-internet/" class="post-title-link" itemprop="url">维多利亚时代的互联网</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-02-04 23:19:24" itemprop="dateCreated datePublished" datetime="2018-02-04T23:19:24+08:00">2018-02-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2018-05-07 12:26:24" itemprop="dateModified" datetime="2018-05-07T12:26:24+08:00">2018-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%94%9F%E6%B4%BB/" itemprop="url" rel="index"><span itemprop="name">生活</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>人类互相交流的欲望从未减弱过。</p>
</blockquote>
<h2 id="作者和书"><a href="#作者和书" class="headerlink" title="作者和书"></a>作者和书</h2><p>这本书是汤姆·斯坦迪奇（Tom Standage）于1997年完成，1998年9月第一次出版。中文版是后浪|江西出版社于2017-8年出版。作者毕业于牛津大学，主修工程学和电脑科技，在《经济学人》杂志科技版担任主编。出版过的图书作品有《从莎草纸到互联网》、《六个瓶子里的世界史》等，本书是其代表作和畅销之作，已被拍成纪录片。</p>
<h2 id="电报简史"><a href="#电报简史" class="headerlink" title="电报简史"></a>电报简史</h2><p>脑图见文末。本书的概述请见简友<a target="_blank" rel="noopener" href="https://www.jianshu.com/u/9595e1cb4e70">半目李</a> 的<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/07f5c2ca5672">《当时的明月换拨人看》</a></p>
<p>我们沿着时间之线溯回到故事源头。1746年法国著名科学家、修道院院长诺莱做了一个电流传导的实验，成功证明了电流可以完成长距离即时传播。可是在那之后漫长的一百年，电流传播信息却并未得到发展，反而是查普发明了感观电报（一种通过望远镜观察电报塔机械臂获取信息的技术）和“电报”（telegraphe 远方的书写者）这个词。1793年法国建成第一座电报塔。次年，法国国家电报系统的第一条支线巴黎-里尔落成，法国的观感电报网由此形成。</p>
<p>时势造英雄。1832年，从欧洲回美国的萨利号船上，塞缪尔·F.B.摩尔斯听到同船的科学家提到了电流可以即时传播，灵感之下，想到了电报的无限可能，短短数日，就创造出摩尔斯电码，而这，几乎是整个电报行业的基石。四年之后，1836年，大洋彼岸的威廉姆·福塞吉尔·库克同样意识到电报的巨大前景。随后的两年，两个人在电学科学家的帮助下，都独立解决了流量远距离传导的难题。而摩尔斯更进一步改进了摩尔斯电码，让它可以直接编码字母。技术难题攻克后，1837年，库克和惠斯通合作建立第一条依附于铁路公司的电报线；1844年，摩尔斯说服政府建立了一条华盛顿-巴尔的电报线。1845年，几乎同时，摩尔斯和库克各自建立了磁力电报公司和电力电报公司。自此欧洲各国和北美的电报网日益发达起来。</p>
<p>各国自家的电报网四通八达之后，国与国之间沟通的诉求日益迫切。1849年3月份，普鲁士和奥地利签订了第一个国际电报互联协议，虽然基于类似香港海关的别扭形式，但是维也纳和柏林这两座城市终于可以互通电报了。随着水下铺设电报线技术的成熟，隔着英吉利海峡相望的英国和法国于1852年完成第一封从伦敦到巴黎的电报通信。而随之富贵的是那些生产古塔胶的公司，因为水下铺设的电线需要古塔胶的保护。1858年8月5日，历史性的时刻来临了。长约3280公里的大西洋海底电缆铺设完成，这意味着欧洲和北美洲的电报网络第一次连接成功。尽管由于技术问题，这条线路服役不到一个月就完全瘫痪。1866年，经过充分科学的试验和前车之鉴的经验积累，跨大西洋电报网络再次连接。这次，它真的可以在两个大洲之间传递各色信息，包括商业贸易，军事情报还有新闻等。</p>
<p>不过很快，电报在超载的信息面前开始显露出疲态。由于需要发送的电报太多，发报员根本忙不过来，导致大量电报堆积，以至于人们惊讶地发现在同城使用电报，通信的速度竟然不如信差。为了节省电报的带宽，英国的发明家克拉克发明了基于蒸汽的气动传送管，利用蒸汽的推力将装有电报卡的小盒子快速地发射到目的电报中心。这看似滑稽的设计，却实实在在地解决了电报带宽不足的问题。19世纪70年代，全世界都在兴建电报网络。维多利亚时代（1837-1901）的互联网在这段时间里初具规模，它混杂着各国的电报网络，海底光缆，气动管和跑腿信差。</p>
<p>英雄时代也会落幕的。1871年10月，美国举办了摩尔斯电报大游行，庆祝这位80岁高龄的老人为全人类通信所做的贡献。我们的电报之父——摩尔斯庄严地用摩尔斯电码敲下了自己的名字，正式告别电报界。次年逝世。</p>
<p>大师的陨落，宛若宣告一个时代的终结。电报以及整个电报行业开始退出历史的舞台。1872年，波士顿的约瑟夫·B.斯特恩斯发明了双工器，可以用一条电报线完成收和发的动作。1874年，博多机将一条线路的容量扩展到原来的12倍。同年，爱迪生发明了四工电路。1876年，亚历山大·格雷厄姆·贝尔通过对谐波电报的研究，发明了电话机并申请了专利。19世纪80年代，电学热持续升温，电报行业以肉眼可见的速度衰退。1903年，英国发明家唐纳德·莫里发明了电传打字机，这几乎宣判了电报员的“死刑”。自此之后，电报就消失在了人们的视野里。2006年，美国的西部联合公司宣布停止办理一切电报业务，以后恐怕只能在博物馆里才能追忆到那段辉煌的历史。</p>
<h2 id="电报的思考"><a href="#电报的思考" class="headerlink" title="电报的思考"></a>电报的思考</h2><h3 id="到底是技术带来了社会范式的改变，还是人类的诉求本身？"><a href="#到底是技术带来了社会范式的改变，还是人类的诉求本身？" class="headerlink" title="到底是技术带来了社会范式的改变，还是人类的诉求本身？"></a>到底是技术带来了社会范式的改变，还是人类的诉求本身？</h3><p>开篇提到过人类总是渴望互相交流，查普发明感观电报绝非偶然，本质上是察觉到人想和远距离的其他人即时交流的诉求。所以是诉求本身带动了技术创新。当技术创新成功发展之后，首先是富人阶层最先享受到成果，资本的罪恶本质是压榨了普罗大众的劳动时间得来了剩余价值。这些剩余价值让富人免去工作，把自己的时间消耗在这些技术创新激发的原始诉求上。然后，商人出于无利不起早的心态，会极力追求更低成本的技术创新，在市场竞争下，用低廉的价格吸引穷人进入资本家新一轮的资本累积当中。商业从根本上就是趋利避害的。</p>
<p>当技术的创新在一些方面节约了人们的时间，人们必然会将这部分时间浪费在其它方面或者干脆全部沉浸式地浪费原来那部分事情上，比如：网上聊天。我们之所以会有社会范式改变的感觉，就是由于我们自己原来的生活节奏被打乱了。以前是不得已而为之，现在是得已而不为之或者为之，突然一下拥有了选择的自由，算是很合情合理的设定。用系统性思考模式，人类及其活动是个大系统，本身就具有自组织的特征，所谓自组织就是让自己变得复杂的能力。远距离的交流变得快捷，意味着系统内部的信息连接更多更紧密，原因是速度变快了，同样的时间内可以和更多人建立关系，同时交流也会更加频繁。这样的带来的影响是什么呢？那就是人类群体变得更加复杂，外在行为更加诡异，也越发难以被消灭。</p>
<p>回到问题本身，这个问题就不应该用线性思考方式思考。人类的诉求激发了技术创新，技术创新又改变了人类的生活，激发了更进一步的诉求。说到底就是形成了一种增强回路，社会范式不过是增强回路自然而然表现出的群体的一致的外在行为模式。</p>
<h3 id="电报网络和20世纪末的互联网有什么关系？"><a href="#电报网络和20世纪末的互联网有什么关系？" class="headerlink" title="电报网络和20世纪末的互联网有什么关系？"></a>电报网络和20世纪末的互联网有什么关系？</h3><p>抛开技术本身不谈，电报网络和互联网都承载了同样的目标——让人类交流更加便利，本质上没有区别。常说电子邮件是互联网上的杀手级应用，我看不见得，170年前的电报早就具备了这样的能力，甚至“邮箱地址”这种也早就出现了。我觉的互联网真正的厉害之处，在于极大地丰富了信息的表现方式，利用超媒体链接技术，实现了多种类型信息（文本，照片和视频）的互联，还有基于这些信息上层抽象——服务（保险，云服务等等）。再加上计算机和移动设备这类载体的普及，用户群暴增。时下，如果不用互联网可能会被归为异类。</p>
<h3 id="下一个爆发的是什么网呢？"><a href="#下一个爆发的是什么网呢？" class="headerlink" title="下一个爆发的是什么网呢？"></a>下一个爆发的是什么网呢？</h3><p>我们分析一下互联网是个什么东西。互联网的要素有虚拟的人，虚拟的团体或公司，信息，网络，数字货币等。互联网上除了通讯和智库这些基本的要素外，还有由此构建的各种商业服务，如：阿里巴巴的电子商务帝国。当然还有游戏这种天然电子消费品。信息交互的速度足够快了，信息的载体也非常丰富，设备也在不断革新贴近人类。那么还有什么可以改善的呢？从历史发展的角度看问题，真正革新的技术从来都不是拿着颠覆什么商业模式的口号打出名声的，它的出发点一定是帮助解决人类的原始诉求。</p>
<p>思考中…</p>
<p>答案会是区块链吗？</p>
<p>于2018年2月4日</p>
<h2 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h2><p><img src="http://upload-images.jianshu.io/upload_images/217988-d82ebdc89f1a73c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="维多利亚时代的互联网"></p>
<hr>
<p>[1]<a target="_blank" rel="noopener" href="https://book.douban.com/subject/25924608/">从莎草纸到互联网：社交媒体2000年</a><br>[2]<a target="_blank" rel="noopener" href="https://book.douban.com/subject/1874086/">六个瓶子里的世界史</a></p>
<p><img src="http://upload-images.jianshu.io/upload_images/217988-ce973aa35194f1ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="维多利亚时代的互联网.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2017/11/22/thinking-in-systems/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ryan Qian">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鄢倩">
      <meta itemprop="description" content="Senior Consultant | DevOps Master | Blockchain & Web3 Specialist">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 鄢倩">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/22/thinking-in-systems/" class="post-title-link" itemprop="url">系统之美</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-22 13:26:09" itemprop="dateCreated datePublished" datetime="2017-11-22T13:26:09+08:00">2017-11-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2018-05-07 12:26:10" itemprop="dateModified" datetime="2018-05-07T12:26:10+08:00">2018-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%94%9F%E6%B4%BB/" itemprop="url" rel="index"><span itemprop="name">生活</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>世界是普遍联系、永恒发展的，这是我很欣赏的一名大学马原老师奉为圭臬的话，也是给我很大触动的金玉良言。世界是一个大系统，其中有纷繁复杂的事物，用独特的行为方式互相影响，或直接或间接，要么直截了当因果相连，要么兜兜转转蝴蝶效应。如果持不可知论，世界将永存混沌。系统总是比看上去复杂，但是其中玄妙又遵循因果。依照系统思考的基本原则，系统的行为总是由系统的结构决定。我们不愿意看到的很多现象，归根结底都是系统性问题，是系统的内部结构决定的行为特征。这是一个很重要的问题。我们只有正视并承认这一点才有重塑系统的勇气和可能。</p>
<p>系统结构是不胜枚举的，但是我们总可以抽象出模式（系统基模 archetypes）提取特征。不论是还原论还是整体论，只要能帮助我们分析问题都是好的理论。在分析过程中，使用还原论分解系统的元素，然后把这些元素放回原位，互相关联起来，组合勾画出系统的反馈回路。从整体论的视角重塑系统，思考反馈回路又会产生怎样的行为。系统思考的研究者将特定的、会引发特定行为的系统结构成为系统基模，常见的8种系统基模陷阱分别是<strong>政策阻力、公地悲剧、目标侵蚀、竞争升级、富者愈富、转嫁负担、规避规则和目标错位</strong>。</p>
<p>可我们不禁想问：系统思考究竟是什么？要回答上面的这个问题，首先得搞清楚系统是什么。<strong>系统是一组相关联的事物——在一定的时间内，以特定的行为相互影响。系统可能会受到外力的影响，对此产生的反馈方式就是系统的特征。</strong></p>
<p>系统思考的观察方式并不是唯一的解释系统的方式。就像康德说的，人都是戴着有色眼镜生存的，不同的观察方式或许可以突破这一层有色眼镜，使用投影的方式在多个维度综合塑造起系统的真实模样。我甚至希望自己看待同一件事物的视角是相互矛盾的，那样我才会感受到自己的认知是多么有限，这个世界是多么伟大、在有限的生命中充满怎样无限的可能。</p>
<p>从还原论的视角认知的世界是由基本要素构成的，但是系统思考则不同。它的基本理论是，系统由要素、连接，功能或目标组成。一支笔是系统，它的组成要素有笔芯、油墨、笔筒和笔头。笔筒套着笔芯，笔芯镶着笔头，油墨会沿着笔芯和笔头流淌，这就是连接。一支笔的功能可能是写字或画画，然而这些功能是很难从系统内部联想到的，必须让一只手攥住它运作起来，让油墨勾连出运动的线条，力透纸背，入木三分，才能观测出实际的功能。有时候，系统的要素是显而易见的，总能应需要分解，但是分解的粒度却是极难把握的，再加上要素可能是无形的，那么就极有可能找不出所有的要素。这个时候，把注意力转向连接则是更为明智和恰当的选择。系统连接的表现形式多种多样，可能是物质流、信息流，准入条件或约束规则，交易、交谈。在现实中，连接多表现在系列动作上，球员之间更加信任、老师给学生打分等等。如果系统中的连接发生改变，系统会受到很大的影响，此后表现出的行为和原来的行为大相径庭。而犹胜这个的，便是系统的目标或者功能发生改变。因为系统有自组织的特点，目标发生的改变会强制系统内部要素应激，最终会导致结构发生改变，从而表现出令人咂舌的行为。</p>
<p>当我们理解系统不仅仅是要素的集合，而且包含内在连接和功能或目标了之后。接下来就得接受系统是动态变化的这一事实。存量是所有系统的基础，存量是任何时候都能观察、感知、计数和测量的系统要素。<strong>存量是对系统中变化量的一种历史记录。</strong>那么也就是说存量总是会随着时间变化而改变的，而使存量发生变化的就是流量，流量可以看做瞬时的存量。一旦这样理解系统的结构，系统的动态性也就不言而喻了。存量的改变决定了系统的动态变化速度，也让系统具备了延迟性的特点——在任何环境下，系统都不会马上受影响；即使想要改变系统的行为，也需要一定的时间等待它缓慢生效。对存量的改变是通过控制流量做到的。进入的流量大于出去的流量，系统的存量就会增加；反之，会减少；最理想的情况是存量维持在一个动态的平衡状态。如果我们想要改变系统的行为，就需要找到系统流量的控制点，促进或者削弱控制点（手段），以此达成我们想要系统表现出来的行为或者趋势。</p>
<p>系统根据存量的多少，又可以分为单存量和多存量系统。单存量系统因为只有一个存量，控制点数量较少，系统内在连接较少，所以控制起来不是太难。但是即便如此，我们也要意识到由于客观规律的约束，造成流量的不恒定，系统最终态或多或少会偏离预定的值。而复杂的多存量系统，则会因为存量之间会相互施加对控制点（包括自己的控制点）的影响，变得错综复杂，难以理出头绪。所以更好的梳理方式是观察现在系统结构包含哪些行为，以及触发这些行为的条件。这有点类似知果索因的探究方式：行为就是对控制点施加的影响，而条件则是改变存量的外在表现。比如喝咖啡这样的行为。触发这个行为的条件是我困了。困了是体内能量低于正常水平的外在表现。而能量在这里可以看做存量。</p>
<h2 id="系统思考的3大特征"><a href="#系统思考的3大特征" class="headerlink" title="系统思考的3大特征"></a>系统思考的3大特征</h2><p>承认系统是美的，这是我们研究系统的动力。<em>假如一个系统整体是良好的，那么每个部分都是好的。</em></p>
<p>系统具有适应力（Resilience）的特征。适应力指的是系统在多变的环境下保持自身存在和运作的能力，与之相对的是脆弱性或刚性。或者用KK的话说，适应力就是反脆弱性。面对周遭环境的不确定性，系统会表现出短期振荡、阶段性发作和周期性兴衰，适应力会参与其中让系统振荡收敛，复原。在系统正常运行的情况下，适应力是很难被察觉到的，而系统的稳定程度则比较容易统计出来。适应力在系统超出限度，调节回路被破坏，要素被分解的情况下才能被观察。这也就要求我们在设计系统的时候，不仅要考虑到系统正常运行时的指标，也要考虑到极端情况下，系统自我恢复的能力。系统的适应力不是凭空产生的，它是多个调节回路共同影响之下出现的结果。而且复杂的系统一般都有元调节回路（meta-resilience），甚至是元元调节回路（metameta-resilience），这就让系统具备了很强的自组织能力。</p>
<p>系统的第二个特征就是自组织（Self-orgnization）。自组织指的是系统让自己更为复杂化的能力。自组织往往伴随着被扼杀的动作，主要原因是自组织具有不可预料的特质，引导系统发展出全新的行为模式和系统结构。面对可能的不确定性，现在的人们会感到恐慌，其结果采取打压的态度。但是庆幸的是适应力和自组织是系统的基本特征，不可能被消灭。和适应力类似，可能是很多简单的规则逐步产生系统的自组织能力的。比如，现实中的雪花分形，还有生命游戏（game of life）。</p>
<p>系统的第三个特征是层次性（Hierarchy）。层次性指的是系统和子系统之间包含和生成的关系。子系统能够维持自身，并发挥一定的功能，并服务于一个更大系统的需求，而更大的系统负责调节和强化各个子系统的运作，那么就可以产生并保持相对稳定、有适应力和效率的结构。<strong>系统的层次性一般是自下而上进化的，上层的目的是服务于下层的目的，而不是牺牲多数人的目的以维护少数人的目的。</strong>层次结构要求整体优化，不能让某个子系统的目的占据上风，也不能有太多中央控制。这就意味着层次结构必须平衡整体系统和子系统的关系。</p>
<h2 id="系统思考的6大障碍"><a href="#系统思考的6大障碍" class="headerlink" title="系统思考的6大障碍"></a>系统思考的6大障碍</h2><ol>
<li>别被表象迷惑<br>不要太关注事件本身，而是得关注系统的长期行为趋势，和触发这些行为的条件，这有助于帮助我们梳理出系统结构。而系统结构是行为的根源。</li>
<li>在非线性的世界里，不要用线性的思维模式<br>线性系统可以被模块化，但是非线性系统通常是不可解、不可拆分的。非线性关系之间的相对优势发生改变，会导致不同回路的主导地位发生改变，导致千奇百怪存量的改变。</li>
<li>恰当地定义边界<br>世界万物是互相联系的，不存在孤立的系统。所以边界的划分也应该依据我们的需求和目的。过窄导致对影响因素分析不足，而过宽要致使信息噪声过大，反而难以找出关键要素。</li>
<li>看清各种限制因素<br>限制是客观存在的，它会限制系统的输入和输出。而且限制本身还是动态的，系统也可能是自身的限制因素。<strong>从某种程度上说，找到限制或约束力最大的因素是系统得以生存的基础。可能我们从来没让系统进化的更好，只是不断地打破限制因素，系统自己的特征决定了进化方向。</strong></li>
<li>无所不在的时间延迟<br>系统中的延迟无处不在，为了更好地处理问题，一定的预见性必不可少。不然会错过解决问题的黄金时间。</li>
<li>有限理性<br>我们不得不承认即使知道了全部信息，我们也无法做出完全合理的决策。只有快速构建反馈，可视化结果，让人知道做了决策之后的后果，行为就能发生转变。</li>
</ol>
<h2 id="系统思考的8大陷阱"><a href="#系统思考的8大陷阱" class="headerlink" title="系统思考的8大陷阱"></a>系统思考的8大陷阱</h2><ol>
<li>政策阻力<br>其中政策阻力表现的是哪儿不痛快堵哪里，病急乱投医，治标不治本。</li>
<li>公地悲剧<br>公地悲剧表现在对公有资源的滥用，由于个体遭受的损失由全体承担。</li>
<li>目标侵蚀<br>目标侵蚀是说关注在系统的坏的表现上，产生降低目标、减少修正行为进而加剧的恶性循环。</li>
<li>竞争升级<br>竞争升级就是囚徒困境中的先发制人策略的概述，直到一方退出或者资源耗竭为止。</li>
<li>富者愈富<br>富者愈富指的是为富不仁的道理，富人会刻意不去承担责任。</li>
<li>转嫁负担<br>转嫁负担是指上瘾行为，依赖外部干预者，而导致系统自身解决问题的能力变弱。</li>
<li>规避规则<br>规避规则是说上有政策，下有对策。</li>
<li>目标错位<br>而目标错误最严重，在错误的目标下，任何回路都只会导致无用的结果。</li>
</ol>
<h2 id="改变系统的12杠杆点"><a href="#改变系统的12杠杆点" class="headerlink" title="改变系统的12杠杆点"></a>改变系统的12杠杆点</h2><ol>
<li>数字<br>关注系统参数是一种低效的杠杆点，可能短期内有效，但是长期看来不起决定性作用。</li>
<li>缓冲器<br>存量意味着系统比较稳定，但是换个角度看，也可能是一种浪费。而且因为是物理实体，通常不易调节。</li>
<li>存量-流量结构<br>类似于缓冲器。不过这是系统的内在结构（不仅包含存量），因为是物理实体调节起来不太容易。</li>
<li>时间延迟<br>承认系统具有延迟的特点，时间延迟无法消除，也就要求我们顺势而为，配合系统的改变节拍， 放慢增长速度。</li>
<li>调节回路<br>为了改善系统的自我矫正能力，需要增强调节回路的力量。比如：保持信息公开透明。 </li>
<li>增强回路<br>减少增强回路的产生成果，可能是更加有力的杠杆点。</li>
<li>信息流<br>从人心的角度看，人们避免对自己的决策负责。信息流的缺失是系统功能不良的常见原因之一。恢复信息流，是比重建系统结构更加经济的方式。 </li>
<li>系统规则<br>系统的规则会让系统的行为产生翻天覆地的变化，如果规则倾向于维护一小部分人的利益，减少了来自其他人的反馈，就会触发“富者愈富” 的陷阱，导致自我毁灭。</li>
<li>自组织<br>自组织是进化的机制，而它需要一些原材料，即多样性。消除了多样性，世界将会陷入灾难。</li>
<li>目标<br>很多人身处系统之中，也无法得知系统的目标。系统的目标是一个高杠杆点，而它的目标很大程度上是让自己无限增长。那就需要一个更大的系统把维持平衡作为自己的目标。</li>
<li>社会范式<br>社会公认的观念就是社会范式，这些观念不需要特地强调就能被人所认同。改变社会范式的难度是巨大的，但是你可以积极接触那些拥抱新范式的人，参与宣传当中，避免接触反对这些新范式的人。而且，往往在构建系统模型的时候更容易改变范式，因为你跳出了系统本身，把它作为一个整体来观察了。</li>
<li>超越范式<br>意识到范式也是人类看待这个世界的一种模型罢了。不要纠结真理是否存在，假设所有的东西都可能是错的，为了完成目标，只要去选择合适的手段就好了。</li>
</ol>
<h2 id="系统的15大生存法则"><a href="#系统的15大生存法则" class="headerlink" title="系统的15大生存法则"></a>系统的15大生存法则</h2><ol>
<li>跟上系统的节拍<br>先去了解系统的真实状况，让事实说话，然后用系统性思考动态地分析问题。 </li>
<li>把你的心智模式展现在阳光下<br>用科学的方式检验自己的心智模式，包括价值观。 </li>
<li>相信、尊重并分享信息<br>信息是系统运作的重要连接 ，控制信息甚至就是控制了整个系统。比如：政治家办报。</li>
<li>谨慎使用语言，并用系统的概念去丰富语言<br>只有可以被谈论了，那东西才会火（发展），比如：微服务。</li>
<li>关注重要的，而不总是可以衡量的<br>容易衡量的东西一般不会被忘记；但是不容易衡量的东西，比如：质量、幸福感等等就很容易被遗漏，如果设计时不去考虑这些，人们就不会关注，更不会改进。</li>
<li>为反馈系统制定带有反馈功能的政策<br>把学习融入管理当中，构建调整回路的回路。 </li>
<li>追求整体利益<br>铭记层级组织存在的目的是服务于底层的。不要过度放大任何部分的重要性。</li>
<li>聆听系统的智慧<br>存在的系统自然有它存在的理由，发挥它现有的自我运行的力量和结构是最好的方式。</li>
<li>界定系统的职责<br>职责不是功能。也不是软件设计方法中单一职责表达的变化。职责就是责任，怎么增强系统的内在责任，就必须让每次决策及其结果之间建立起反馈回路。让决策者很快看到后果，意识到结果的严重程度，这才是优化决策最直接的方式。</li>
<li><strong>保持谦逊，做一名学习者</strong><br>不要假装自己是专家，虚张声势是无法改进自己的方式，因为它只能隐藏问题。面对不确定性，我们要做的不是假装自己知晓一切，还是应该“拥抱失误”，这意味着我们需要搜索、使用和分享“我们到底在哪里失误了”这样的信息。</li>
<li>庆祝复杂性<br>这是一种思考方式的转变。系统的复杂性从来不是问题，没有谁可以控制它，它恰是多样性和统一性的条件，所以这个世界才如此异彩纷呈。正如土地理论（Land ethic）所说“当某件事情倾向于保护生物群落的一致性，稳定性和自然之美，它就是对的，否则就是错的”。鼓励自组织、无序、变异和多样性才是我们应该做的。</li>
<li>扩展时间的范围<br>学习过去的经验，面向未来解决现在的问题，不然会很快会崩溃。</li>
<li>打破各种清规戒律<br>系统思考要求“跨领域”思考，正如区块链技术融合分布式原理、加密学理论、博弈论中的理性经济人那样，跨领域的思考模式会产生颠覆性的发明。</li>
<li>扩大关切的范围<br>世界是普遍联系的，没有任何系统是孤立存在的。你关切的东西，不应该仅仅是自己。“各扫自己门前雪，何管他人瓦上霜”是短视的表现。</li>
<li>不要降低“善”的标准<br>世界上充斥着奇葩猎奇的新闻，因为这些新闻是大都涉及偏离现有的社会范式的故事，人们对这个世界上的坏消息总是更容易相信些，这些坏消息成为了“目标侵蚀”的佐证，从而很轻易地丧失自己自幼学习的普世价值观，转而“同流合污”。</li>
</ol>
<p>系统思考的方式能引导我们看清问题的本质，这已经是莫大的帮助了。至于做或者不做，这是个人的选择权利，在人类精神的系统关照下，我们应当知道什么该做，什么必须去做。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2017/09/24/Acceptance-Criteria/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ryan Qian">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鄢倩">
      <meta itemprop="description" content="Senior Consultant | DevOps Master | Blockchain & Web3 Specialist">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 鄢倩">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/09/24/Acceptance-Criteria/" class="post-title-link" itemprop="url">验收条件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-09-24 17:01:31" itemprop="dateCreated datePublished" datetime="2017-09-24T17:01:31+08:00">2017-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-06-14 11:26:19" itemprop="dateModified" datetime="2024-06-14T11:26:19+08:00">2024-06-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h2><ol>
<li>日常语言描述</li>
<li>捕获系统行为</li>
<li>个数有限</li>
</ol>
<p>在故事基础部分，我提到用户故事通常是日常或者商务语言写成的句子，这些句子描述了用户在其工作职责范围内想要达成的某个目的以及达成该目的需要的功能（手段）。所以书写用户的故事的句式一般都是：As（用户的角色）… I Want（功能或手段）… So That（目的）。根据用户故事的 INVEST 划分原则中 N (Negotiated 可协商的) 原则，故事包含的是对需求的简短描述，具体的细节需要沟通产出，产出物表现为验收条件。</p>
<p>换言之，验收条件是在开发前的分析阶段输出的，它的作用是补充需求细节。更进一步，验收条件其实有力地消除了用户和开发人员之间的沟通鸿沟。为什么这么说呢？因为验收条件具备两点很重要的特征：</p>
<ul>
<li>日常语言描述</li>
<li>捕获系统行为</li>
</ul>
<p>这两点特征促进了参与各方在需求点上快速反馈，如下图：<br><img src="http://upload-images.jianshu.io/upload_images/217988-c3f6913b5098b359.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="验收条件-反馈环"><br>在敏捷活动中高效地沟通一直被反复强调，因为不高效的沟通造成的信息误导和返工是精益生产活动中应当极力消除的，所以任何能够促进沟通的方式方法都值得提倡。</p>
<p>除此之外，有限的个数 (2-8 ACs&#x2F;story) 也是验收条件的一个特征，这也是 INVEST 原则中 E (Estimable 可评估的) 所要求的。所以，也引出了验收条件的一个简明定义——用户故事的 DoD (Definition of Done)。也有人说，一组验收条件定义了用户故事的边界（Boundary）。如果任由用户故事自然“疯长”，范围无限放大，交付怕是遥遥无期。</p>
<p>验收条件会作为业务活动描述的一部分存在于用户故事中，一般会在开发之前准备就绪。在敏捷活动 kick-off 时，由业务分析师（BA）和开发人员（Dev），也可叫上质量保证师（QA）一起逐条澄清验收条件，以便保证开发之前达成共识，减少返工和浪费。在其它敏捷活动如：desk-checks, customer sign-off, UI testing, BDD 中也会重度参与。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="Given-When-Then"><a href="#Given-When-Then" class="headerlink" title="Given&#x2F;When&#x2F;Then"></a>Given&#x2F;When&#x2F;Then</h3><blockquote>
<p><strong>#Title</strong><br><strong>Given</strong> 用户触发操作之前处于的系统状态<br><strong>When</strong> 触发系统结果的操作<br><strong>Then</strong> 系统预期返回的结果</p>
</blockquote>
<h3 id="Verifiable-checklists"><a href="#Verifiable-checklists" class="headerlink" title="Verifiable checklists"></a>Verifiable checklists</h3><blockquote>
<p>e.g. [PhoneNumber] 只能包含0-9, +</p>
</blockquote>
<h2 id="反模式"><a href="#反模式" class="headerlink" title="反模式"></a>反模式</h2><h3 id="模棱两可的陈述"><a href="#模棱两可的陈述" class="headerlink" title="模棱两可的陈述"></a>模棱两可的陈述</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Given: that I have the search page loaded</span><br><span class="line"></span><br><span class="line">When: I perform a search</span><br><span class="line"></span><br><span class="line">Then: the search results come back within a reasonable period of time</span><br></pre></td></tr></table></figure>
<p>这里的 reasonable period of time 就是不可测试的，因为没有人可以决定什么才是 reasonable.</p>
<p>合理的改法是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Given: that I have the search page loaded</span><br><span class="line"></span><br><span class="line">When: I perform a search</span><br><span class="line"></span><br><span class="line">Then: the search results come back within 5ms</span><br></pre></td></tr></table></figure>
<p>5ms 之内，这是一个标量，完全可以衡量。</p>
<h3 id="非系统交互"><a href="#非系统交互" class="headerlink" title="非系统交互"></a>非系统交互</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Given I have pulled my car up to the valet area</span><br><span class="line"></span><br><span class="line">When I hand over my keys to the valet person</span><br><span class="line"></span><br><span class="line">Then I receive a paper ticket from the valet person</span><br><span class="line"></span><br><span class="line">And I am instructed to hold on to it so I can use it to retrieve my car later.</span><br></pre></td></tr></table></figure>
<p>这里的所有描述都是对现实场景的描述，和系统并无关系，对于开发人员构建系统几乎没有丝毫帮助。这种反模式的修正方法是剔除那些非系统的验收条件，重新梳理用户故事。</p>
<h3 id="非系统输出"><a href="#非系统输出" class="headerlink" title="非系统输出"></a>非系统输出</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Given: that I am on the home page</span><br><span class="line"></span><br><span class="line">And: I am logged in</span><br><span class="line"></span><br><span class="line">When: I navigate to account preferences</span><br><span class="line"></span><br><span class="line">Then: I can see my account preferences</span><br></pre></td></tr></table></figure>
<p>这里的 I can see my account preferences 是无法进行断言的，因为这是系统无关的，说得极端些，假如用户闭上眼睛，这个功能就没法通过验收了。</p>
<p>合理的改法是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Given: that I am on the home page</span><br><span class="line"></span><br><span class="line">And: I am logged in</span><br><span class="line"></span><br><span class="line">When: I navigate to account preferences</span><br><span class="line"></span><br><span class="line">Then: my account preferences are displayed</span><br></pre></td></tr></table></figure>
<p>这个时候，我可以检查系统展示了我的用户页面。</p>
<h3 id="非系统异常"><a href="#非系统异常" class="headerlink" title="非系统异常"></a>非系统异常</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Given 我选择了一份图表模板</span><br><span class="line">When 我跳转到显示界面</span><br><span class="line">Then 我发现图表不是我想要的</span><br></pre></td></tr></table></figure>
<p>这里的问题涉及了非系统输出没法进行测试等问题，还有一个显著的毛病是误认为用户自身的误操作也必须反映到用户故事中。这里出错的点是用户自己选错了模板，发现产生的图表不是自己想要的格式，系统是自动无法判别选择模板的正确性的。</p>
<h3 id="when-隐藏到-given"><a href="#when-隐藏到-given" class="headerlink" title="when 隐藏到 given"></a>when 隐藏到 given</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Given: that I am on the homepage</span><br><span class="line"></span><br><span class="line">And: I navigate to the search</span><br><span class="line"></span><br><span class="line">When: I look at the page</span><br><span class="line"></span><br><span class="line">Then: the search options are displayed</span><br></pre></td></tr></table></figure>
<p>基本上，这是团队编写 AC 时最容易犯的错误，操作出现在前置条件中，<em>when</em> 中反而不是系统行为了。</p>
<p>合理的改法是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Given: that I am on the homepage</span><br><span class="line"></span><br><span class="line">When: I navigate to the search</span><br><span class="line"></span><br><span class="line">Then: the search options are displayed</span><br></pre></td></tr></table></figure>
<h2 id="最佳模式"><a href="#最佳模式" class="headerlink" title="最佳模式"></a>最佳模式</h2><h3 id="1-可读的"><a href="#1-可读的" class="headerlink" title="1. 可读的"></a>1. 可读的</h3><p>我们希望业务人员审阅和修正验收条件，如果写的内容只有开发人员能懂，我们就失去了获得反馈的机会。使用上述书写格式，可以提高可读性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Given: that my mobile phone is switched on</span><br><span class="line"></span><br><span class="line">And: I have sufficient signal to make a call</span><br><span class="line"></span><br><span class="line">When: I dial a number</span><br><span class="line"></span><br><span class="line">Then: I am connected to the person I want to talk to</span><br><span class="line"></span><br><span class="line">And: incoming calls are diverted to my voicemail</span><br></pre></td></tr></table></figure>
<h4 id="2-可测试的"><a href="#2-可测试的" class="headerlink" title="2. 可测试的"></a>2. 可测试的</h4><p>参见反模式中合理改法。</p>
<h4 id="3-实现无关的"><a href="#3-实现无关的" class="headerlink" title="3. 实现无关的"></a>3. 实现无关的</h4><p>验收条件应该是实现无关的，它和用户故事一样，是给业务和开发人员提供交流凭证的一种工具，所以它应该聚焦于功能，而不是功能的展现形式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Given: that I am on the home page</span><br><span class="line"></span><br><span class="line">And: I am logged in</span><br><span class="line"></span><br><span class="line">When: I navigate to advanced search</span><br><span class="line"></span><br><span class="line">Then: the advanced search web page must be displayed</span><br><span class="line"></span><br><span class="line">And: a text box labelled &quot;Name&quot; is displayed</span><br><span class="line"></span><br><span class="line">And: a text box labelled &quot;Description&quot; is displayed</span><br><span class="line"></span><br><span class="line">And: a command button named &quot;Search&quot; is displayed</span><br></pre></td></tr></table></figure>
<p>这里已经框死了必须要使用 text box 实现展示功能，而实际上其背后真正的意图是通过属性字段进行搜索，隐藏了业务含义的验收条件是不可取的。</p>
<p>合理的改法是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Given: that I am on the home page</span><br><span class="line"></span><br><span class="line">And: I am logged in</span><br><span class="line"></span><br><span class="line">When: I navigate to advanced search</span><br><span class="line"></span><br><span class="line">Then: the advanced search is displayed</span><br><span class="line"></span><br><span class="line">And: an option to search by name is displayed</span><br><span class="line"></span><br><span class="line">And: an option search by description is displayed</span><br><span class="line"></span><br><span class="line">And: the advanced search is displayed in accordance with the attached wireframe</span><br></pre></td></tr></table></figure>
<p>换句话说，验收条件本身不应该关注于展现形式，当然，为了便于理解，wireframe 是提供直观素材的更好的方式。</p>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><h3 id="用户故事"><a href="#用户故事" class="headerlink" title="用户故事"></a>用户故事</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">作为一名管理员</span><br><span class="line">我想要把一名员工加入系统中</span><br><span class="line">以便管理他们的权限</span><br></pre></td></tr></table></figure>
<h3 id="分析步骤"><a href="#分析步骤" class="headerlink" title="分析步骤"></a>分析步骤</h3><h4 id="1-定义边界"><a href="#1-定义边界" class="headerlink" title="1. 定义边界"></a>1. 定义边界</h4><ul>
<li>触发添加员工操作</li>
<li>输入员工的详情</li>
<li>验证遗漏或者错误的字段</li>
<li>保存</li>
</ul>
<h4 id="2-提炼和细化"><a href="#2-提炼和细化" class="headerlink" title="2. 提炼和细化"></a>2. 提炼和细化</h4><ol>
<li>触发添加员工操作<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">假如我进入了员工管理系统</span><br><span class="line">当我进入员工的浏览页</span><br><span class="line">之后添加员工的操作出现在页面上</span><br></pre></td></tr></table></figure>
2. 输入员工的详情<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">假如添加员工的操作出现在浏览页</span><br><span class="line">当我调用了添加员工的操作</span><br><span class="line">那么我可以输入员工的姓名和出生日期</span><br><span class="line">并且出现了保存操作</span><br></pre></td></tr></table></figure>
3. 验证遗漏的字段<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">假如我没有填写员工的姓名和/或生日</span><br><span class="line">当我尝试保存</span><br><span class="line">那么保存不会成功</span><br><span class="line">并且会有消息显示遗漏的字段</span><br></pre></td></tr></table></figure>
4. 验证错误的生日日期<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">假如我正在添加一名员工的详情</span><br><span class="line">并且我输入了未来或者早于1900年的日期，或者错误的日期格式</span><br><span class="line">当我尝试保存</span><br><span class="line">那么保存不会成功</span><br><span class="line">并且会有消息显示输入的生日日期无效</span><br><span class="line"></span><br><span class="line">验证列表：</span><br><span class="line">[日期格式] yyyy/MM/dd</span><br></pre></td></tr></table></figure>
5. 保存<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">假如我正在添加一名员工的详情</span><br><span class="line">并且我输入了有效的生日和姓名</span><br><span class="line">当我尝试保存</span><br><span class="line">那么会有消息显示保存成功</span><br><span class="line">并且包含该员工详情的页面会呈现</span><br><span class="line">并且详情中的生日和姓名和之前输入的一致</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="警告"><a href="#警告" class="headerlink" title="警告"></a>警告</h2><p>验收条件并不是唯一澄清和约束用户故事的方式！任何可以提升理解和降低沟通成本的方式方法都值得尝试。比如：用户偏好 —— 希望使用下拉框而不是复选框，往往可以通过添加一条记录在故事中补充这部分信息。另外，一个完整的故事最好能附上线框图，一图胜千言。</p>
<hr>
<p>进一步阅读<br>[1] <a href="/2017/09/19/agile-team-workflow/">敏捷团队工作流</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2017/09/19/agile-team-workflow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ryan Qian">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鄢倩">
      <meta itemprop="description" content="Senior Consultant | DevOps Master | Blockchain & Web3 Specialist">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 鄢倩">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/09/19/agile-team-workflow/" class="post-title-link" itemprop="url">敏捷团队工作流</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-09-19 23:07:17" itemprop="dateCreated datePublished" datetime="2017-09-19T23:07:17+08:00">2017-09-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2018-09-24 21:13:05" itemprop="dateModified" datetime="2018-09-24T21:13:05+08:00">2018-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="站会"><a href="#站会" class="headerlink" title="站会"></a>站会</h2><p>站会中的内容是每天工作的开始，也是对昨天工作的回顾。一般会由团队的某位成员主持，这位主持人有责任让电子系统上的story卡片和看板上的保持一致。站会上，大家依看板从右至左依次更新自己负责story的状态，如果遇到阻碍，应该在站会上及时提出，团队之中的成员如果能提供帮助，应该在站会之后，组织解决方案的讨论。</p>
<h3 id="站会反模式"><a href="#站会反模式" class="headerlink" title="站会反模式"></a>站会反模式</h3><ol>
<li>站会上由组长一人发言、分配任务；</li>
<li>一人长篇阔论占据大半时间（合理的发言时间为1-2分钟，总的时间控制在15分钟左右）；</li>
<li>站会上谈论和story卡片无关的内容。</li>
</ol>
<h2 id="迭代计划会议-IPM"><a href="#迭代计划会议-IPM" class="headerlink" title="迭代计划会议 (IPM)"></a>迭代计划会议 (IPM)</h2><p>迭代计划会议是项目组成员在每一个迭代开始时，聚到一起共同决定这个迭代的 backlog (代办事项) 需要交付的故事卡。<br>这个会议的产出物包含：</p>
<ol>
<li>迭代的 backlog 和用户故事的验收条件</li>
<li>这个迭代的总体业务目标</li>
<li>故事点数，也即开发测试人员对用户故事的评估及承诺</li>
</ol>
<p>参与者包含：</p>
<ol>
<li>Product Owner</li>
<li>Scrum Master</li>
<li>开发团队</li>
<li>其他干系人</li>
</ol>
<p>日程：</p>
<ol>
<li>团队确立这个迭代可以完成的工作量（以点数计），一般从历史迭代中获取</li>
<li>团队根据定义的顺序讨论故事卡，对于每一张故事卡，需要讨论的内容包含：<ol>
<li>衡量故事的相对大小（以点数计），可能会进行故事卡的拆分</li>
<li>沟通验收条件</li>
<li>根据已经讨论出来故事卡的价值、时间和风险，PO重新确定故事卡的优先级</li>
<li>一旦预先设定的工作量到达，就停止本轮迭代会议</li>
</ol>
</li>
<li>团队就迭代的业务目标达成共识</li>
</ol>
<h2 id="用户故事-kickoff-会议"><a href="#用户故事-kickoff-会议" class="headerlink" title="用户故事 kickoff 会议"></a>用户故事 kickoff 会议</h2><p>Story kick off，指的是启动一个 Stroy 进入开发阶段。Story kick off的时候，通常需要三种角色参与：BA、QA 以及开发 Story 的 Dev。</p>
<p>会议内容：</p>
<ul>
<li>DEV 自己先完整地过一遍 Story 的描述；</li>
<li>DEV 给 BA 和 QA 去讲这个 Story 的功能以及 AC；</li>
<li>要能够清晰的讲出来，并且三者达成一致，如果有疑惑，需要当场得到解决；</li>
<li>DEV 开始开发 Story，并自行将 Story 拆分成多个子任务列表，开工。</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://www.infoq.com/cn/articles/my-agile-practice-in-thoughtworks">我在ThoughtWorks中的敏捷实践</a></p>
<h2 id="Desk-Check-Shoulder-Check"><a href="#Desk-Check-Shoulder-Check" class="headerlink" title="Desk Check &#x2F; Shoulder Check"></a>Desk Check &#x2F; Shoulder Check</h2><p>Desk Check 发生在开发人员确信自己已经完成了故事卡，需要另外的人（BA、QA、Dev）坐到旁边一起帮忙验证是否确实完成。</p>
<p>Desk checklist:<br>参与者：BA、QA、Dev 或者其他感兴趣的人</p>
<ul>
<li>故事卡测试覆盖率够吗？</li>
<li>自己本地测过功能么？</li>
<li>自己本地跑过全量的测试么？</li>
<li>所有的 AC 是否都满足了？</li>
<li>做故事卡的过程中是否遇到了理解上的问题？</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.thoughtworks.com/insights/blog/defect-prevention-using-agile-techniques">Defect Prevention Using Agile Techniques</a></p>
<h2 id="Tech-Huddle"><a href="#Tech-Huddle" class="headerlink" title="Tech Huddle"></a>Tech Huddle</h2><p>开发人员聚到一起就项目中遇到的技术展开讨论<br>前提条件：<br>会议之前确定并逐条列出会议讨论的技术主题<br>产出物：</p>
<ol>
<li>一个或多个行动方案，合并到用户故事</li>
<li>方案的优缺点</li>
<li>方案的责任人</li>
</ol>
<h2 id="迭代回顾会议"><a href="#迭代回顾会议" class="headerlink" title="迭代回顾会议"></a>迭代回顾会议</h2><p>在每个迭代结束时，Scrum Master会主持该会议，目的是为了确定哪些改变可以提升下个迭代的生产效率。在这个会议当中，每个人都可以开诚布公地提出自己的建议，有利于管理者从反馈中获取团队的现状。</p>
<p>最高指导原则 (Prime Directive)：</p>
<blockquote>
<p>Regardless of what we discover, we understand and truly believe that everyone did the best job he or she could, given what was known at the time, his or her skills and abilities, the resources available, and the situation at hand.<br>无论我们发现了什么，考虑到当时的已知情况、个人的技术水平和能力、可用的资源，以及手上的状况，我们理解并坚信：每个人对自己的工作都已全力以赴。</p>
</blockquote>
<p>内容包含：</p>
<ul>
<li>上个迭代中做的好的有哪些？</li>
<li>上个迭代中做的不好的有哪些？</li>
<li>我们可以做些什么改善哪些不好的地方？（改善建议）</li>
</ul>
<p>参与者包含：</p>
<ol>
<li>Product Owner</li>
<li>Scrum Master</li>
<li>开发团队</li>
<li>其他干系人</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://insights.thoughtworks.cn/7-step-agenda-effective-retrospective/">高效回顾会议的七步议程</a></p>
<h2 id="迭代review会议-Showcase"><a href="#迭代review会议-Showcase" class="headerlink" title="迭代review会议 (Showcase)"></a>迭代review会议 (Showcase)</h2><p>Showcase 就是开发团队把开发好的功能给客户的 Product Owner（以下简称PO）等业务相关人员演示，以获取他们对所开发系统的反馈，是敏捷开发流程中的一个实践，一般的频率是一个迭代一次，也可以根据项目具体情况做调整。</p>
<p>内容包含：</p>
<p><a target="_blank" rel="noopener" href="https://insights.thoughtworks.cn/agile-showcase-se7en/">敏捷实践Showcase的七宗罪</a><br><a target="_blank" rel="noopener" href="http://www.funretrospectives.com/category/energizer/">Retro 破冰游戏</a></p>
<h2 id="用户故事"><a href="#用户故事" class="headerlink" title="用户故事"></a>用户故事</h2><h2 id="故事基础"><a href="#故事基础" class="headerlink" title="故事基础"></a>故事基础</h2><p>用户故事是指在软件开发和项目管理中用日常语言或商务用语写成的句子。这个句子反映一个用户在其工作职责的范围内要达到的某个目的, 以及此目的所需要的功能。</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><blockquote>
<p>为了避免遗漏附件延误工作<br>作为邮件发送者<br>我希望邮件系统能够在我忘记带附件的时候提醒我</p>
</blockquote>
<h3 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">为了&lt;某个目的或价值&gt;, 作为&lt;某类利益相关者&gt;, 我想要&lt;某个功能&gt;</span><br><span class="line">作为&lt;某类利益相关者&gt;, 我想要&lt;某个功能&gt;, 以便&lt;达到某个目的或获得某种价值&gt;</span><br></pre></td></tr></table></figure>

<h3 id="要点"><a href="#要点" class="headerlink" title="要点"></a>要点</h3><h4 id="重点描述商业的价值不只是功能"><a href="#重点描述商业的价值不只是功能" class="headerlink" title="重点描述商业的价值不只是功能"></a>重点描述商业的价值不只是功能</h4><ul>
<li>帮助团队了解需求背后的意图，利于开发团队协同客户、业务部门设计出更好的解决方案</li>
</ul>
<h4 id="用业务语言描述"><a href="#用业务语言描述" class="headerlink" title="用业务语言描述"></a>用业务语言描述</h4><ul>
<li>利于客户、业务部门理解并区分优先级</li>
</ul>
<h4 id="利益相关者不仅包含用户"><a href="#利益相关者不仅包含用户" class="headerlink" title="利益相关者不仅包含用户"></a>利益相关者不仅包含用户</h4><ul>
<li>系统拥有者的角度也是需求的重要来源</li>
</ul>
<h2 id="CCC-组件-The-three-‘C’s"><a href="#CCC-组件-The-three-‘C’s" class="headerlink" title="CCC 组件 (The three ‘C’s)"></a>CCC 组件 (The three ‘C’s)</h2><h3 id="Card-卡片"><a href="#Card-卡片" class="headerlink" title="Card (卡片)"></a>Card (卡片)</h3><ul>
<li>业务价值 remainder</li>
<li>做计划和沟通业务时的 token</li>
</ul>
<h3 id="Conversation-交流"><a href="#Conversation-交流" class="headerlink" title="Conversation (交流)"></a>Conversation (交流)</h3><ul>
<li>用于在做计划和沟通业务时引发沟通，制造共同话题（收敛）</li>
<li>需求文档的生成方式</li>
</ul>
<h3 id="Confirmation-确认"><a href="#Confirmation-确认" class="headerlink" title="Confirmation (确认)"></a>Confirmation (确认)</h3><ul>
<li>将细节以验收测试的方式检测功能的完整性和准确性</li>
</ul>
<h2 id="划分原则-INVEST"><a href="#划分原则-INVEST" class="headerlink" title="划分原则 INVEST"></a>划分原则 INVEST</h2><h3 id="Independent-独立性"><a href="#Independent-独立性" class="headerlink" title="Independent (独立性)"></a>Independent (独立性)</h3><p>故事和故事之间尽量保持独立，互相依赖的故事对于估算工作量、确定优先级和安排计划都带来很多不便。通常我们可以通过组合和拆分的方式减少依赖性（去除重复）。<br>独立性更多的指的是实现要完整。前后端拆分通常不是很好的拆分方法</p>
<h3 id="Negotiated-可协商的"><a href="#Negotiated-可协商的" class="headerlink" title="Negotiated (可协商的)"></a>Negotiated (可协商的)</h3><p>一个故事是可以协商的，故事卡不是合同，它只是包含对一个需求的简短描述。具体的细节在沟通阶段产出，以验收测试的方式。如果带有太多的细节，反而限制了和用户的沟通。</p>
<h3 id="Valuable-有价值的"><a href="#Valuable-有价值的" class="headerlink" title="Valuable (有价值的)"></a>Valuable (有价值的)</h3><p>每个故事都必须对客户有价值（无论是用户还是客户）。一个让用户故事有价值的好办法就是客户写下它们。</p>
<h3 id="Estimable-可评估的"><a href="#Estimable-可评估的" class="headerlink" title="Estimable (可评估的)"></a>Estimable (可评估的)</h3><p>开发团队需要去估计一个用户故事以便确定优先级，工作量，安排计划。如果难以估计故事的时间, 意味着:</p>
<ul>
<li>领域知识的缺乏: 这种情况下需要更多的沟通</li>
<li>技术实现的模糊: 这种情况下要做试验, 做原型</li>
<li>或者故事太大了: 这时需要把故事切分成小些的</li>
<li>还有对其它团队的依赖…</li>
</ul>
<h3 id="Small-短小的"><a href="#Small-短小的" class="headerlink" title="Small (短小的)"></a>Small (短小的)</h3><p>一个好的故事在工作量上应该是尽量短小的，至少确保能在一个迭代或 Sprint 中能够完成。用户故事越大，在估算、计划安排等方面的风险就越大。</p>
<h3 id="Testable-可测试的"><a href="#Testable-可测试的" class="headerlink" title="Testable (可测试的)"></a>Testable (可测试的)</h3><p>一个用户的故事必须是可被测试的，以便它是可以完成的。如果一个故事无法测试，那么就无法知道它何时可以完成。一个不可测试的例子：为了节省时间，作为用户，我希望软件是易用的。</p>
<h3 id="判断标准-经验准则"><a href="#判断标准-经验准则" class="headerlink" title="判断标准 (经验准则)"></a>判断标准 (经验准则)</h3><ul>
<li>可以写在 Release Notes 里</li>
<li>值得讲给其它行业的人听</li>
<li>可以写在市场宣传材料中</li>
</ul>
<h2 id="验收条件"><a href="#验收条件" class="headerlink" title="验收条件"></a>验收条件</h2><h3 id="捕获预期的行为"><a href="#捕获预期的行为" class="headerlink" title="捕获预期的行为"></a>捕获预期的行为</h3><p>一般验收条件都会在开发之前准备好，用于捕获预期的系统行为，同时作为故事卡业务描述的一部分，定义了故事卡的 DoD（Definition of Done）。</p>
<h3 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h3><ul>
<li><strong>Given</strong> 前置条件，告诉我们在进行操作之前，需要设置和完成什么；</li>
<li><strong>When</strong> 触发结果的操作</li>
<li><strong>Then</strong> 操作之后的预期结果</li>
</ul>
<h3 id="最佳实践模式"><a href="#最佳实践模式" class="headerlink" title="最佳实践模式"></a>最佳实践模式</h3><h4 id="1-可读的"><a href="#1-可读的" class="headerlink" title="1. 可读的"></a>1. 可读的</h4><p>我们希望业务人员审阅和修正验收条件，如果写的内容只有开发人员能懂，我们就失去了获得反馈的机会。使用上述书写格式，可以提高可读性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Given: that my mobile phone is switched on</span><br><span class="line"></span><br><span class="line">And: I have sufficient signal to make a call</span><br><span class="line"></span><br><span class="line">When: I dial a number</span><br><span class="line"></span><br><span class="line">Then: I am connected to the person I want to talk to</span><br><span class="line"></span><br><span class="line">And: incoming calls are diverted to my voicemail</span><br></pre></td></tr></table></figure>

<h4 id="2-可测试的"><a href="#2-可测试的" class="headerlink" title="2. 可测试的"></a>2. 可测试的</h4><h5 id="反模式1-模棱两可的陈述"><a href="#反模式1-模棱两可的陈述" class="headerlink" title="反模式1 - 模棱两可的陈述"></a>反模式1 - 模棱两可的陈述</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Given: that I have the search page loaded</span><br><span class="line"></span><br><span class="line">When: I perform a search</span><br><span class="line"></span><br><span class="line">Then: the search results come back within a reasonable period of time</span><br></pre></td></tr></table></figure>
<p>这里的 reasonable period of time 就是不可测试的，因为没有人可以决定什么才是 reasonable.</p>
<p>合理的改法是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Given: that I have the search page loaded</span><br><span class="line"></span><br><span class="line">When: I perform a search</span><br><span class="line"></span><br><span class="line">Then: the search results come back within 5ms</span><br></pre></td></tr></table></figure>
<p>5ms 之内，这是一个标量，完全可以衡量。</p>
<h5 id="反模式2-非系统输出"><a href="#反模式2-非系统输出" class="headerlink" title="反模式2 - 非系统输出"></a>反模式2 - 非系统输出</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Given: that I am on the home page</span><br><span class="line"></span><br><span class="line">And: I am logged in</span><br><span class="line"></span><br><span class="line">When: I navigate to account preferences</span><br><span class="line"></span><br><span class="line">Then: I can see my account preferences</span><br></pre></td></tr></table></figure>
<p>这里的 I can see my account preferences 是无法进行断言的，因为这是系统无关的，说得极端些，假如用户闭上眼睛，这个功能就没法通过验收了。</p>
<p>合理的改法是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Given: that I am on the home page</span><br><span class="line"></span><br><span class="line">And: I am logged in</span><br><span class="line"></span><br><span class="line">When: I navigate to account preferences</span><br><span class="line"></span><br><span class="line">Then: my account preferences are displayed</span><br></pre></td></tr></table></figure>
<p>这个时候，我可以检查系统展示了我的用户页面。</p>
<h5 id="反模式3-when-隐藏到-given"><a href="#反模式3-when-隐藏到-given" class="headerlink" title="反模式3 - when 隐藏到 given"></a>反模式3 - when 隐藏到 given</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Given: that I am on the homepage</span><br><span class="line"></span><br><span class="line">And: I navigate to the search</span><br><span class="line"></span><br><span class="line">When: I look at the page</span><br><span class="line"></span><br><span class="line">Then: the search options are displayed</span><br></pre></td></tr></table></figure>
<p>基本上，这是团队编写 AC 时最容易犯的错误，操作出现在前置条件中，<em>when</em> 反而不是系统行为了。</p>
<p>合理的改法是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Given: that I am on the homepage</span><br><span class="line"></span><br><span class="line">When: I navigate to the search</span><br><span class="line"></span><br><span class="line">Then: the search options are displayed</span><br></pre></td></tr></table></figure>

<h4 id="3-实现无关的"><a href="#3-实现无关的" class="headerlink" title="3. 实现无关的"></a>3. 实现无关的</h4><p>验收条件应该是实现无关的，它和用户故事一样，是给业务和开发人员提供交流凭证的一种工具，所以它应该聚焦于功能，而不是功能的展现形式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Given: that I am on the home page</span><br><span class="line"></span><br><span class="line">And: I am logged in</span><br><span class="line"></span><br><span class="line">When: I navigate to advanced search</span><br><span class="line"></span><br><span class="line">Then: the advanced search web page must be displayed</span><br><span class="line"></span><br><span class="line">And: a text box labelled &quot;Name&quot; is displayed</span><br><span class="line"></span><br><span class="line">And: a text box labelled &quot;Description&quot; is displayed</span><br><span class="line"></span><br><span class="line">And: a command button named &quot;Search&quot; is displayed</span><br></pre></td></tr></table></figure>
<p>这里已经框死了必须要使用 text box 实现展示功能，而实际上其背后真正的意图是通过属性字段进行搜索，隐藏了业务含义的验收条件是不可取的。</p>
<p>合理的改法是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Given: that I am on the home page</span><br><span class="line"></span><br><span class="line">And: I am logged in</span><br><span class="line"></span><br><span class="line">When: I navigate to advanced search</span><br><span class="line"></span><br><span class="line">Then: the advanced search is displayed</span><br><span class="line"></span><br><span class="line">And: an option to search by name is displayed</span><br><span class="line"></span><br><span class="line">And: an option search by description is displayed</span><br><span class="line"></span><br><span class="line">And: the advanced search is displayed in accordance with the attached wireframe</span><br></pre></td></tr></table></figure>
<p>换句话说，验收条件本身不应该关注于展现形式，当然，为了便于理解，wireframe 是提供直观素材的更好的方式。</p>
<h2 id="代码评审"><a href="#代码评审" class="headerlink" title="代码评审"></a>代码评审</h2><p>代码评审是团队针对今天一天<strong>提交过的</strong>代码的评审会议。这样做的目的是去除代码的坏味道，减少累积的技术债。</p>
<p>团队成员使用版本控制工具，轮流展示自己一天的编码成果并且说明代码的用途。这期间，其他的成员不仅要评审代码的逻辑是否正确（满足验收条件），还必须思考是否有更优雅的方式实现这段功能。大家可以随意表达自己对这些代码的好恶，代码所有者也可以据理力争，所有者一旦被说服就必须无条件地按意见修改。为防止遗忘，可以使用便笺纸记录下来。</p>
<h2 id="结对编程"><a href="#结对编程" class="headerlink" title="结对编程"></a>结对编程</h2><p>通俗地讲，结对编程就是两个人同时工作在同一个 Story 上，一起讨论 Story 的解决方案，并编写代码实现功能，一个人敲键盘，一个人看屏幕，穿插着进行。Pair的双方在快速敲击键盘的时候会伴随一些交流。能力相当的两人，可以一人写测试，一人写实现代码。</p>
<h2 id="测试驱动开发-TDD"><a href="#测试驱动开发-TDD" class="headerlink" title="测试驱动开发 (TDD)"></a>测试驱动开发 (TDD)</h2><p>TDD，即测试驱动开发，强调的是测试先行，跟我们先实现功能代码后添加测试的过程恰恰相反。测试驱动开发是一种驱动代码实现和设计的过程。我们说要先有测试，再去实现；保证实现功能的前提下，重构代码以达到较好的设计。整个过程就好比演绎推理，测试就是其中的证明步骤，而最终实现的功能则是证明的结果。</p>
<p>实践方法：</p>
<ul>
<li>Given：初始状态或前置条件</li>
<li>When：行为发生</li>
<li>Then：断言结果</li>
</ul>
<h2 id="单元测试和测试驱动开发"><a href="#单元测试和测试驱动开发" class="headerlink" title="单元测试和测试驱动开发"></a>单元测试和测试驱动开发</h2><p>测试的价值表现在两个方面：</p>
<ol>
<li>防止已有的功能被破坏</li>
<li>驱动出功能实现</li>
</ol>
<p>从测试金字塔描述的层级来看，单元测试是基座。这类测试数量应该是非常多的，而且还有一个显著特征——运行速度特别快。一般违反快速这个标准的，基本上可以肯定这不是单元测试。</p>
<p>基于以往带团队的经验，我给出一些写单元测试时常犯的错误和好的实践：</p>
<h3 id="常犯的错误"><a href="#常犯的错误" class="headerlink" title="常犯的错误"></a>常犯的错误</h3><ol>
<li>覆盖率100%，却没有任何断言</li>
<li>使用Java反射setAccessible(true)访问私有属性</li>
<li>依赖某些地方产生的数据才能运行</li>
<li>单元测试运行速度超级慢</li>
<li>开始测试之前，准备巨量的数据</li>
<li>测试之间必须以特定顺序运行</li>
<li>上帝类（God Object）导致数以千行的测试代码</li>
</ol>
<h3 id="好的实践"><a href="#好的实践" class="headerlink" title="好的实践"></a>好的实践</h3><ol>
<li>绝对不测试私有的方法</li>
<li>当方法没有返回值，可以通过测试异常或者其委托对象的方式<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. @Test(expected = RuntimeException.class) </span><br><span class="line">2. Mockito.verify(mockObj).doSomething(args…)</span><br></pre></td></tr></table></figure>
3. 静态方法调用是强耦合的信号。需要重构待测类依赖新接口，新接口定义的方法由子类实现，实现方法中包装这些静态方法。</li>
</ol>
<h3 id="什么时候写单元测试？"><a href="#什么时候写单元测试？" class="headerlink" title="什么时候写单元测试？"></a>什么时候写单元测试？</h3><ol>
<li>新的需求，首先写单元测试（保证功能实现）</li>
<li>已经存在的代码，补充单元测试 （保证功能不被破坏）</li>
<li>发现Bug，首先加测试（保证缺陷不再出现）</li>
</ol>
<h2 id="自动化测试"><a href="#自动化测试" class="headerlink" title="自动化测试"></a>自动化测试</h2><p>测试金字塔和 <a target="_blank" rel="noopener" href="http://fabiopereira.me/blog/2012/03/18/introducing-depth-of-test-dot/">DOT</a>（Depth of Test)</p>
<h2 id="持续集成-持续交付"><a href="#持续集成-持续交付" class="headerlink" title="持续集成&#x2F;持续交付"></a>持续集成&#x2F;持续交付</h2><p><strong>再次强调一下，持续集成是一项团队务必遵守的实践。</strong></p>
<p>开发过程中，我们鼓励小步提交的代码控制方式。即当开发人员对story的部分功能编码完成之后，如果<strong>确认</strong>可以提交到代码仓库（如果是分布式的Git，可以考虑提交到本地仓库），应该尽早提交。开发人员的每日工作可以遵循7步提交法，如下：</p>
<ol>
<li>更新代码；</li>
<li>本地编码；</li>
<li>本地构建（使用<code>mvn test</code>）；</li>
<li>再次更新代码；</li>
<li>本地构建；</li>
<li>提交到代码仓库；</li>
<li>CI上构建。</li>
</ol>
<p>既然是实践（规矩），就有几项有效的纪律需要遵守：</p>
<ul>
<li>CI红的时候不能提交代码</li>
<li>CI红着不能过夜（不能等到第二天才去修复）</li>
<li>任何人提交后CI失败，无论原因，都有责任跟进修复</li>
<li>在提交代码前运行所有测试</li>
<li>不注释掉或删除失败的测试</li>
</ul>
<p>这也就意味着开发人员需要密切关注CI的状态。CI持续反馈着软件的可工作状态，所以团队应该把CI的健康状况列为项目的最高优先级，甚至高于开发新特性。</p>
<hr>
<h2 id="友情链接"><a href="#友情链接" class="headerlink" title="友情链接"></a>友情链接</h2><ol>
<li><a target="_blank" rel="noopener" href="https://insights.thoughtworks.cn/thoughtworks-agile/">ThoughtWorks的敏捷开发-XR</a>)</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2017/09/17/release-jar-to-clojars/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ryan Qian">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鄢倩">
      <meta itemprop="description" content="Senior Consultant | DevOps Master | Blockchain & Web3 Specialist">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 鄢倩">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/09/17/release-jar-to-clojars/" class="post-title-link" itemprop="url">如何发布jar到clojars</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-09-17 21:39:40" itemprop="dateCreated datePublished" datetime="2017-09-17T21:39:40+08:00">2017-09-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2017-09-20 07:28:25" itemprop="dateModified" datetime="2017-09-20T07:28:25+08:00">2017-09-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Clojure/" itemprop="url" rel="index"><span itemprop="name">Clojure</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Clojars-介绍"><a href="#Clojars-介绍" class="headerlink" title="Clojars 介绍"></a>Clojars 介绍</h2><p>Clojars 是一个为开源 Clojure 类库打造的仓库，截止2017年9月17日，大概有19831个项目发布在上面。整个网站也是用 Clojure 编写的。</p>
<h2 id="发布-Clojure-library"><a href="#发布-Clojure-library" class="headerlink" title="发布 Clojure library"></a>发布 Clojure library</h2><h3 id="1-注册-clojars"><a href="#1-注册-clojars" class="headerlink" title="1. 注册 clojars"></a>1. 注册 clojars</h3><p>前往 <a target="_blank" rel="noopener" href="https://clojars.org/register">clojars</a> 注册</p>
<h3 id="2-lein-部署"><a href="#2-lein-部署" class="headerlink" title="2. lein 部署"></a>2. lein 部署</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ lein deploy clojars # lein deploy [repository name], here the repo name is clojars.</span><br></pre></td></tr></table></figure>
<p>如果不想加上 <code>clojars</code> 参数，则需要在当前项目下的 <em>project.clj</em> 添加如下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;:deploy-repositories [[&quot;releases&quot; :clojars]</span><br><span class="line">                       [&quot;snapshots&quot; :clojars]]&#125;</span><br></pre></td></tr></table></figure>
<p><strong>这里注意一点：</strong><br>这里使用 <code>:deploy-repositories</code> 而非 <code>:repositories</code>，原因是 <code>:repositories</code> 除了用于部署还会作为依赖源被项目使用。所以，如若必要，还是职责单一点好。这样，也可以加入 <em>:user profile (~&#x2F;.lein&#x2F;profiles.clj)</em> 供所有本地项目发布使用。</p>
<p>这个时候可以执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ lein deploy</span><br><span class="line">No credentials found for snapshots(did you mean `lein deploy clojars`?) </span><br><span class="line"># 这里应该是 leiningen 的 bug，提示信息 `lein deploy clojars` 显得很奇怪，可以忽略之。</span><br><span class="line">See `lein help deploying` for how to configure credentials to avoid prompts.</span><br><span class="line">Username: username</span><br><span class="line">Password: password</span><br></pre></td></tr></table></figure>
<p>如上，这时会弹出用户名和密码输入框。为了节省时间，避免每次输入，最好把用户凭证 (credentials) 以文件的形式存放到用户范围的目录下，即*~&#x2F;.lein&#x2F;credentials.clj*，并做加密处理。</p>
<h3 id="3-设置全局的-credentials-map"><a href="#3-设置全局的-credentials-map" class="headerlink" title="3. 设置全局的 credentials map"></a>3. 设置全局的 credentials map</h3><p>首先，把如下的 credentials map 写入 <em>~&#x2F;.lein&#x2F;credentials.clj</em></p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="regex">#&quot;https://clojars.org/repo&quot;</span> &#123;<span class="symbol">:username</span> <span class="string">&quot;username_on_clojars&quot;</span> <span class="symbol">:password</span> <span class="string">&quot;password_on_clojars&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>其次，使用 gpg 加密该文件</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --default-recipient-self -e \</span><br><span class="line">    ~/.lein/credentials.clj &gt; ~/.lein/credentials.clj.gpg</span><br></pre></td></tr></table></figure>
<p>加密后，即可删除原文件 <em>~&#x2F;.lein&#x2F;credentials.clj</em>。然后在<code>:deploy-repositories</code> map 中指定 <code>:creds :gpg</code></p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">:deploy-repositories</span> [[<span class="string">&quot;releases&quot;</span> <span class="symbol">:clojars</span></span><br><span class="line">                        <span class="symbol">:creds</span> <span class="symbol">:gpg</span>]]</span><br><span class="line">                       [<span class="string">&quot;snapshots&quot;</span> <span class="symbol">:clojars</span></span><br><span class="line">                        <span class="symbol">:creds</span> <span class="symbol">:gpg</span>]]&#125;</span><br></pre></td></tr></table></figure>
<p>完成上述，<code>lein deploy</code> 的时候即可解密 <code>~/.lein/credentials.clj.gpg</code>，从中获取对应仓库的<code>username</code>和<code>password</code>（<strong>注：</strong>为了便于索引查找，credentials 使用正则表达式 #”<a target="_blank" rel="noopener" href="https://clojars.org/repo">https://clojars.org/repo</a>“ 作为 key）</p>
<h2 id="Error-gpg-agent-timeout"><a href="#Error-gpg-agent-timeout" class="headerlink" title="Error: gpg agent timeout"></a>Error: gpg agent timeout</h2><p>有时候，deploy 时会出现 gpg agent 超时的错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ lein deploy</span><br><span class="line">gpg: problem with the agent: Timeout</span><br><span class="line">gpg: decryption failed: No secret key</span><br><span class="line">Could not decrypt credentials from /Users/qianyan/.lein/credentials.clj.gpg</span><br><span class="line">nil</span><br><span class="line">See `lein help gpg` for how to install gpg.</span><br></pre></td></tr></table></figure>
<p>仔细搜索<a target="_blank" rel="noopener" href="https://github.com/technomancy/leiningen/blob/master/doc/DEPLOY.md#gpg">文档</a>会发现下面这句很重要的话</p>
<blockquote>
<p>Due to a bug in gpg you currently need to use gpg-agent and have already unlocked your key before Leiningen launches, but with gpg-agent you only have to enter your passphrase periodically; it will keep it cached for a given period.</p>
</blockquote>
<p>大意是，leiningen 需要用到 gpg-agent，而且在 <code>lein deploy</code> 之前，就应该解锁密钥。</p>
<p>不实际操作的话，还是很难弄懂这句话具体的指代。我们不妨思考一下。</p>
<h3 id="1-看看后台是否有个进程叫做-gpg-agent？"><a href="#1-看看后台是否有个进程叫做-gpg-agent？" class="headerlink" title="1. 看看后台是否有个进程叫做 gpg-agent？"></a>1. 看看后台是否有个进程叫做 gpg-agent？</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ps -ef |grep gpg</span></span><br><span class="line">  501 87095     1   0  8:27PM ??         0:00.00 gpg-agent --daemon</span><br></pre></td></tr></table></figure>
<p>嗯，还真有！</p>
<h3 id="2-gpg-直接解密-credentials-clj-gpg"><a href="#2-gpg-直接解密-credentials-clj-gpg" class="headerlink" title="2. gpg 直接解密 credentials.clj.gpg"></a>2. gpg 直接解密 credentials.clj.gpg</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --decrypt ~/.lein/credentials.clj.gpg</span></span><br><span class="line"></span><br><span class="line">You need a passphrase to unlock the secret key for</span><br><span class="line">user: &quot;Yan Qian (lambeta) &lt;qianyan.lambda@gmail.com&gt;&quot;</span><br><span class="line">2048-bit RSA key, ID E13DFD8A, created 2016-05-14 (main key ID 3C5030FF)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">接下来，漫无止境的等待中...</span></span><br></pre></td></tr></table></figure>
<p>这奇怪的等待让我不安，所以我使出了杀手锏 <code>kill -9</code>，直接把 gpg-agent 干掉。</p>
<h3 id="3-重新-gpg-–decrypt"><a href="#3-重新-gpg-–decrypt" class="headerlink" title="3. 重新 gpg –decrypt"></a>3. 重新 gpg –decrypt</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --decrypt ~/.lein/credentials.clj.gpg</span></span><br><span class="line"></span><br><span class="line">You need a passphrase to unlock the secret key for</span><br><span class="line">user: &quot;Yan Qian (lambeta) &lt;qianyan.lambda@gmail.com&gt;&quot;</span><br><span class="line">2048-bit RSA key, ID E13DFD8A, created 2016-05-14 (main key ID 3C5030FF)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里要输入 passphrase</span></span><br><span class="line">gpg: encrypted with 2048-bit RSA key, ID E13DFD8A, created 2016-05-14</span><br><span class="line">      &quot;Yan Qian (lambeta) &lt;qianyan.lambda@gmail.com&gt;&quot;</span><br><span class="line">&#123; #&quot;https://clojars.org/repo&quot; &#123;:username &quot;username_on_clojars&quot; :password &quot;password_on_clojars&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>终于可以输入 passphrase 了，解密完成。这大概就是上面引文所说的 unlock your key before Leiningen launches.</p>
<h3 id="4-重新部署"><a href="#4-重新部署" class="headerlink" title="4. 重新部署"></a>4. 重新部署</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">lein deploy</span></span><br><span class="line">Created /Users/qianyan/Projects/clojure-pr/clj-moco/target/clj-moco-0.1.0-SNAPSHOT.jar</span><br><span class="line">Wrote /Users/qianyan/Projects/clojure-pr/clj-moco/pom.xml</span><br><span class="line">Retrieving clj-moco/clj-moco/0.1.0-SNAPSHOT/maven-metadata.xml</span><br><span class="line">    from https://clojars.org/repo/</span><br><span class="line">Sending clj-moco/clj-moco/0.1.0-SNAPSHOT/clj-moco-0.1.0-20170917.122837-4.jar (10k)</span><br><span class="line">    to https://clojars.org/repo/</span><br><span class="line">Sending clj-moco/clj-moco/0.1.0-SNAPSHOT/clj-moco-0.1.0-20170917.122837-4.pom (3k)</span><br><span class="line">    to https://clojars.org/repo/</span><br><span class="line">Retrieving clj-moco/clj-moco/maven-metadata.xml</span><br><span class="line">    from https://clojars.org/repo/</span><br><span class="line">Sending clj-moco/clj-moco/0.1.0-SNAPSHOT/maven-metadata.xml (1k)</span><br><span class="line">    to https://clojars.org/repo/</span><br><span class="line">Sending clj-moco/clj-moco/maven-metadata.xml (1k)</span><br><span class="line">    to https://clojars.org/repo/</span><br></pre></td></tr></table></figure>
<p>没有出现 gpg-agent timeout 的错误，部署完成。</p>
<hr>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a><strong>提示</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--default-recipient-self</span><br><span class="line">    Use the default key as default recipient if option --recipient is not used and don’t ask if this is a valid one.</span><br><span class="line">    The default key is the first one from the secret keyring or the one set with --default-key.</span><br></pre></td></tr></table></figure></h2><p>参考链接<br>[1] <a target="_blank" rel="noopener" href="https://github.com/technomancy/leiningen/blob/master/doc/DEPLOY.md">Leiningen Deployment</a><br>[2] <a target="_blank" rel="noopener" href="https://www.gnupg.org/documentation/manuals/gnupg-devel/GPG-Configuration-Options.html#GPG-Configuration-Options">GPG: How to change the configuration</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2017/09/15/release-jar-to-maven-central-repository/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ryan Qian">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鄢倩">
      <meta itemprop="description" content="Senior Consultant | DevOps Master | Blockchain & Web3 Specialist">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 鄢倩">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/09/15/release-jar-to-maven-central-repository/" class="post-title-link" itemprop="url">如何发布Jar包到Maven Central Repository</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-09-15 22:29:07" itemprop="dateCreated datePublished" datetime="2017-09-15T22:29:07+08:00">2017-09-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2017-09-18 21:40:57" itemprop="dateModified" datetime="2017-09-18T21:40:57+08:00">2017-09-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="太长不读篇"><a href="#太长不读篇" class="headerlink" title="太长不读篇"></a>太长不读篇</h2><ol>
<li>在 <a target="_blank" rel="noopener" href="https://issues.sonatype.org/secure/Signup!default.jspa">issues tracker</a> 上注册</li>
<li>创建 <a target="_blank" rel="noopener" href="https://issues.sonatype.org/browse/OSSRH-33944">issues</a></li>
<li>配置 <a target="_blank" rel="noopener" href="https://github.com/qianyan/underscore.string.java/blob/master/build.gradle">build.gradle</a></li>
<li>gpg 生成 key pair 以便签名</li>
<li>上传 Release Archive</li>
<li>关闭并验证 <a target="_blank" rel="noopener" href="https://oss.sonatype.org/">Staging 环境</a>的 Archive</li>
<li>发布 Archive</li>
<li>通知 issue 管理员开启同步</li>
</ol>
<h2 id="细读篇"><a href="#细读篇" class="headerlink" title="细读篇"></a>细读篇</h2><h3 id="1-注册"><a href="#1-注册" class="headerlink" title="1. 注册"></a>1. 注册</h3><p>Maven Central 网站并不提供注册的功能，你需要到 Sonatype 网站上进行注册。而事实上，Sonatype 网站也没有直接提供一个注册链接。真正的注册入口在 <a target="_blank" rel="noopener" href="https://issues.sonatype.org/secure/Signup!default.jspa">issues tracker</a> 上。一旦完成注册后，你需要创建包含待发布包信息的 issue。</p>
<h3 id="2-创建-issue"><a href="#2-创建-issue" class="headerlink" title="2. 创建 issue"></a>2. 创建 issue</h3><p><img src="http://upload-images.jianshu.io/upload_images/217988-502c1f4fc580c120.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建 issues"><br>在 Sonatype 的 <a target="_blank" rel="noopener" href="https://issues.sonatype.org/secure/Dashboard.jspa">dashboard</a> 上点击创建按钮，根据弹出框的提示，填写简介、描述、GroupId、Project URL、SCM url 以及你在 jira 上的用户名。创建完毕后，会被自动跳转到该 issue 的详情页并分配一个唯一的ID，如：OSSRH-33944。余下的时间只需要等待，一般在两个工作日之内，Sonatype 的工作人员就会着手处理，然后他会在该 issue 底下的评论区留言。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/217988-29e35a58393f39ce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建成功的 issue"></p>
<p>如果代码是托管在 github 上，按照惯例，GroupId 应该取 github 上的域名，比如：com.github.qianyan。不过，这里我预备上传的包的 GroupId 是 com.lambeta，这是我购买的域名。审核者对此有所顾虑，所以很贴心地留言如下：</p>
<blockquote>
<p>Do you own the domain lambeta.com? If not, please read:<br><a target="_blank" rel="noopener" href="http://central.sonatype.org/pages/choosing-your-coordinates.html">http://central.sonatype.org/pages/choosing-your-coordinates.html</a><br>You may also choose a groupId that reflects your project hosting, in this case, something like io.github.qianyan or com.github.qianyan</p>
</blockquote>
<p>在回复这个域名确实为我所有之后，工作人员就贴出不同环境的仓库地址。</p>
<blockquote>
<p>Configuration has been prepared, now you can:<br>Deploy snapshot artifacts into repository <a target="_blank" rel="noopener" href="https://oss.sonatype.org/content/repositories/snapshots">https://oss.sonatype.org/content/repositories/snapshots</a><br>Deploy release artifacts into the staging repository <a target="_blank" rel="noopener" href="https://oss.sonatype.org/service/local/staging/deploy/maven2">https://oss.sonatype.org/service/local/staging/deploy/maven2</a><br>Promote staged artifacts into repository ‘Releases’<br>Download snapshot and release artifacts from group <a target="_blank" rel="noopener" href="https://oss.sonatype.org/content/groups/public">https://oss.sonatype.org/content/groups/public</a><br>Download snapshot, release and staged artifacts from staging group <a target="_blank" rel="noopener" href="https://oss.sonatype.org/content/groups/staging">https://oss.sonatype.org/content/groups/staging</a><br><strong>please comment on this ticket when you promoted your first release, thanks</strong></p>
</blockquote>
<p><strong>最后一句很重要</strong>，说的是，当我第一次正式发布的时候，需要留言告知工作人员，以便他们开启中央仓库的同步，这样我的包才会在 Maven Central 仓库中可见。</p>
<h3 id="3-配置项目的-build-gradle"><a href="#3-配置项目的-build-gradle" class="headerlink" title="3. 配置项目的 build.gradle"></a>3. 配置项目的 build.gradle</h3><p>拿到仓库地址，我们就需要在自己的项目中进行一些必要的配置，包含：jar、sourcesJar、javadocJar 以及对这些产物的 signing（签名）。</p>
<h4 id="maven-插件"><a href="#maven-插件" class="headerlink" title="maven 插件"></a>maven 插件</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;maven&#x27;</span></span><br></pre></td></tr></table></figure>
<p>maven 插件提供了 uploadArchives task，我们需要在这个 task 中配置仓库地址，以及 pom 的相关信息，因为上载到 maven 仓库的包必须要有 pom 文件，否则无法查找或被依赖。具体配置如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">uploadArchives &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenDeployer &#123;</span><br><span class="line">            beforeDeployment &#123; deployment -&gt; signing.signPom(deployment) &#125;</span><br><span class="line"></span><br><span class="line">            repository(<span class="attr">url:</span> <span class="string">&quot;https://oss.sonatype.org/service/local/staging/deploy/maven2/&quot;</span>) &#123;</span><br><span class="line">                authentication(<span class="attr">userName:</span> ossrhUsername, <span class="attr">password:</span> ossrhPassword)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            snapshotRepository(<span class="attr">url:</span> <span class="string">&quot;https://oss.sonatype.org/content/repositories/snapshots&quot;</span>) &#123;</span><br><span class="line">                authentication(<span class="attr">userName:</span> sonatypeUsername, <span class="attr">password:</span> sonatypePassword)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            pom.project &#123;</span><br><span class="line">                name project.name</span><br><span class="line">                packaging <span class="string">&#x27;jar&#x27;</span></span><br><span class="line">                description <span class="string">&#x27;underscore string in java&#x27;</span></span><br><span class="line">                url <span class="string">&#x27;https://github.com/qianyan/underscore.string.java&#x27;</span></span><br><span class="line"></span><br><span class="line">                scm &#123;</span><br><span class="line">                    url <span class="string">&#x27;https://github.com/qianyan/underscore.string.java&#x27;</span></span><br><span class="line">                    connection <span class="string">&#x27;https://github.com/qianyan/underscore.string.java.git&#x27;</span></span><br><span class="line">                    developerConnection <span class="string">&#x27;git@github.com:qianyan/underscore.string.java.git&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                licenses &#123;</span><br><span class="line">                    license &#123;</span><br><span class="line">                        name <span class="string">&#x27;MIT Licence&#x27;</span></span><br><span class="line">                        url <span class="string">&#x27;https://raw.githubusercontent.com/qianyan/underscore.string.java/master/LICENSE&#x27;</span></span><br><span class="line">                        distribution <span class="string">&#x27;repo&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                developers &#123;</span><br><span class="line">                    developer &#123;</span><br><span class="line">                        id <span class="string">&#x27;lambeta&#x27;</span></span><br><span class="line">                        name <span class="string">&#x27;Yan Qian&#x27;</span></span><br><span class="line">                        email <span class="string">&#x27;qianyan.lambeta@gmail.com&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应生成的 pom.xml 大致如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>underscore.string.java<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>underscore string in java<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>https://github.com/qianyan/underscore.string.java<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">licenses</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">license</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>MIT Licence<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://raw.githubusercontent.com/qianyan/underscore.string.java/master/LICENSE<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">distribution</span>&gt;</span>repo<span class="tag">&lt;/<span class="name">distribution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">licenses</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">developers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">developer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>lambeta<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>Yan Qian<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">email</span>&gt;</span>qianyan.lambeta@gmail.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">developer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">connection</span>&gt;</span>https://github.com/qianyan/underscore.string.java.git<span class="tag">&lt;/<span class="name">connection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span>git@github.com:qianyan/underscore.string.java.git<span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>https://github.com/qianyan/underscore.string.java<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong> <code>authentication(userName: ossrhUsername, password: ossrhPassword)</code> 和 <code>authentication(userName: sonatypeUsername, password: sonatypePassword)</code>，这里的用户名和密码其实就是在 Sonatype 上注册的用户名和密码。为了让 gradle 脚本顺利执行，需要在当前工程下的 gradle.properties 文件中设置对应的变量，如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sonatypeUsername=</span><br><span class="line">sonatypePassword=</span><br><span class="line">ossrhUsername=</span><br><span class="line">ossrhPassword=</span><br></pre></td></tr></table></figure>
<p>这份文件会作为源代码的一部分提交，所以聪明的我们不会傻傻地把自己的用户名和密码 push 到 github 上面。和大部分 *nix 系统上的工具类似，gradle 也有本地配置，我们可以新建一份 gradle.properties 文件到 <code>~/.gradle/gradle.properties</code>，然后把用户名和密码写入其中。这样，实际运行时，本地配置就会覆盖项目下对应的这些变量值。</p>
<h4 id="4-设置-gpg-以签名-Archive"><a href="#4-设置-gpg-以签名-Archive" class="headerlink" title="4. 设置 gpg 以签名 Archive"></a>4. 设置 gpg 以签名 Archive</h4><p><a target="_blank" rel="noopener" href="https://gnupg.org/">gpg</a> 生成的 key pair 主要是供签名使用的。假定本机已经安装 gpg，首先使用 gpg 生成 key pair。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --gen-key</span></span><br></pre></td></tr></table></figure>
<p>然后，查找你的 keyId：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --list-keys</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-&gt;</span></span><br><span class="line">pub   2048R/XXXXXX 2017-09-14 [expires: 2018-05-14]</span><br><span class="line">uid       [ultimate] Yan Qian (lambeta) &lt;qianyan.lambeta@gmail.com&gt;</span><br></pre></td></tr></table></figure>
<p>其中 XXXXXX 就是你的 keyId。接下来必须发布你的公钥：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --keyserver hkp://pgp.mit.edu --send-keys XXXXXX</span></span><br></pre></td></tr></table></figure>
<p>验证公钥已经发布成功：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gpg --keyserver hkp://pgp.mit.edu --search-keys qianyan.lambeta@gamil.com <span class="comment"># user email address</span></span></span><br></pre></td></tr></table></figure>
<p>当然，上述操作都可以使用 <a target="_blank" rel="noopener" href="https://gpgtools.org/">gpg tools</a> 在 UI 上完成。</p>
<h4 id="signing-插件"><a href="#signing-插件" class="headerlink" title="signing 插件"></a>signing 插件</h4><p>完成上述步骤之后，我们需要在 build.gradle 中添加 signing 插件及其配置，如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;signing&#x27;</span></span><br><span class="line"></span><br><span class="line">signing &#123;</span><br><span class="line">    required &#123; gradle.taskGraph.hasTask(<span class="string">&quot;uploadArchives&quot;</span>) &#125;</span><br><span class="line">    sign configurations.archives</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的配置明确了 gradle task 的 DAG 中必须含有 uploadArchives，之后针对 archives 进行签名。</p>
<p>signing 插件如何同 gpg 生成 key pair 交互呢？这就需要在<code>~/.gradle/gradle.properties</code>再声明三个变量，如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">signing.keyId=XXXXXX</span><br><span class="line">signing.password=your_key_pair_password</span><br><span class="line">signing.secretKeyRingFile=<span class="regexp">/Users/</span>your_name<span class="regexp">/.gnupg/</span>secring.gpg</span><br></pre></td></tr></table></figure>
<p>还剩下最后的一步，归档 Jar，sourceJar（源代码）和javadocJar（API 文档），这些是需要签名的对象。</p>
<h4 id="archive"><a href="#archive" class="headerlink" title="archive"></a>archive</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;java&#x27;</span></span><br><span class="line"></span><br><span class="line">task sourcesJar(<span class="attr">type:</span> Jar) &#123;</span><br><span class="line">    classifier = <span class="string">&#x27;sources&#x27;</span></span><br><span class="line">    from sourceSets.main.allSource</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task javadocJar(<span class="attr">type:</span> Jar, <span class="attr">dependsOn:</span> javadoc) &#123;</span><br><span class="line">    classifier = <span class="string">&#x27;javadoc&#x27;</span></span><br><span class="line">    from <span class="string">&#x27;build/docs/javadoc&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">artifacts &#123;</span><br><span class="line">    archives jar</span><br><span class="line">    archives sourcesJar</span><br><span class="line">    archives javadocJar</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>归档产物最终都会被签名，生成以 .asc 为后缀的签名文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">build/libs</span><br><span class="line">├── underscore.string.java-0.0.1-javadoc.jar</span><br><span class="line">├── underscore.string.java-0.0.1-javadoc.jar.asc</span><br><span class="line">├── underscore.string.java-0.0.1-sources.jar</span><br><span class="line">├── underscore.string.java-0.0.1-sources.jar.asc</span><br><span class="line">├── underscore.string.java-0.0.1.jar</span><br><span class="line">└── underscore.string.java-0.0.1.jar.asc</span><br></pre></td></tr></table></figure>
<p>这些产出物在最终发布的时候，需要经过验证，如果验证失败，比如：缺少 javadoc 或者某个 *.asc 文件，则不被允许发布。</p>
<h3 id="5-上传-Release-Archives"><a href="#5-上传-Release-Archives" class="headerlink" title="5. 上传 Release Archives"></a>5. 上传 Release Archives</h3><p>根据的 maven 的标准，日常开发我们会使用 snapshot 版本，如：0.0.1-SNAPSHOT；发布时，去掉后缀-SNAPSHOT，即：0.0.1。而 maven 会根据这个特点，机智地辨识是上传到 snapshotRepository 还是 releaseRepository 的。因为我们得发布包，所以修改版本为 0.0.1 之后，我们只需要简单地执行如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gradle uploadArchives <span class="comment"># or `gradle uA` this is a shortcut.</span></span></span><br></pre></td></tr></table></figure>
<h3 id="6-关闭并验证-Staging-环境上的-Archive"><a href="#6-关闭并验证-Staging-环境上的-Archive" class="headerlink" title="6. 关闭并验证 Staging 环境上的 Archive"></a>6. 关闭并验证 Staging 环境上的 Archive</h3><p><img src="http://upload-images.jianshu.io/upload_images/217988-c6a888ec20e93530.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="staging Repo"></p>
<p>登录 Sonatype 的 <a target="_blank" rel="noopener" href="https://oss.sonatype.org/">Nexus Repository Manager</a>，然后点击左边侧边栏的 Staging Repositories，搜索<code>comlambeta</code> (GroupId 去掉中间的’.’)。接下来查看 Content tab，重点检查 pom 或者签名文件是否遗漏！当确认无误后，即可关闭 (Close) 这个 Repo。关闭过程中，Nexus 会逐项检查产物是否合规，如果出现验证错误，则在 Activity tab 中显示具体失败的步骤及原因。</p>
<h3 id="7-发布-Archive"><a href="#7-发布-Archive" class="headerlink" title="7. 发布 Archive"></a>7. 发布 Archive</h3><p>如果上面的验证通过，上面本来不可用的 Release 按钮会变为可用。点击 Release 按钮，直接发布包。</p>
<h3 id="8-通知-issue-管理员开启同步"><a href="#8-通知-issue-管理员开启同步" class="headerlink" title="8. 通知 issue 管理员开启同步"></a>8. 通知 issue 管理员开启同步</h3><p>发布包之后，就可以通知管理员开启同步。我在原来的 issue 的评论区留言：</p>
<blockquote>
<p>I have a first release version 0.0.1 for this library.</p>
</blockquote>
<p>很快地，管理员就回复同步已经开启：</p>
<blockquote>
<p>Central sync is activated for com.lambeta. After you successfully release, your component will be published to Central, typically within 10 minutes, though updates to search.maven.org can take up to two hours.</p>
</blockquote>
<p>不过，由于当时所用 gradle2.1 的版本，导致了上传时 pom 文件被遗漏，在 search.maven.org 中搜索不到。管理员很热心地解释了这个现象：</p>
<blockquote>
<p>search.maven.org needs a valid POM file to be a part of your uploaded artifacts. Browsing Maven Central directly:<br><a target="_blank" rel="noopener" href="http://repo1.maven.org/maven2/com/lambeta/underscore.string.java/0.0.1/">http://repo1.maven.org/maven2/com/lambeta/underscore.string.java/0.0.1/</a><br>it appears that a POM file is missing.</p>
</blockquote>
<p>遂升级到 3.1 版本，重新上传之后就能在 <a target="_blank" rel="noopener" href="http://search.maven.org/#search%7Cga%7C1%7Ccom.lambeta">search.maven.org</a> 中看到。</p>
<h3 id="9-检查同步成功"><a href="#9-检查同步成功" class="headerlink" title="9. 检查同步成功"></a>9. 检查同步成功</h3><p>除了通过 <a target="_blank" rel="noopener" href="http://search.maven.org/#search%7Cga%7C1%7Ccom.lambeta">search.maven.org</a> 检查同步是否成功之外，查询<a target="_blank" rel="noopener" href="http://mvnrepository.com/search?q=com.lambeta">mvnrepository</a>也是常用的搜索方式。不过，值得一提的是，mvnrepository 相较于 search.maven.org 同步会更慢点，原因是 mvnrepository 引用了 central.maven.org 仓库。而 <code>central.maven.org == repo1.maven.org</code>，两个域名对应的 IP 是一样的，而这个 repo1.maven.org 就是默认的 Maven central repository，也就是 search.maven.org 的仓库。<br>所以，你可以在以下两个仓库看到发布包：<br><a target="_blank" rel="noopener" href="http://central.maven.org/maven2/com/lambeta/underscore.string.java/">http://central.maven.org/maven2/com/lambeta/underscore.string.java/</a><br><a target="_blank" rel="noopener" href="http://repo1.maven.org/maven2/com/lambeta/underscore.string.java/">http://repo1.maven.org/maven2/com/lambeta/underscore.string.java/</a></p>
<hr>
<p>参考链接<br>[1] <a target="_blank" rel="noopener" href="http://zserge.com/blog/gradle-maven-publish.html">simple library publishing with gradle</a><br>[2] <a target="_blank" rel="noopener" href="http://central.sonatype.org/pages/releasing-the-deployment.html">release deployment</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2017/09/06/Underscore-string-java/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ryan Qian">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鄢倩">
      <meta itemprop="description" content="Senior Consultant | DevOps Master | Blockchain & Web3 Specialist">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 鄢倩">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/09/06/Underscore-string-java/" class="post-title-link" itemprop="url">一个Java中操作字符串的类库</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-09-06 23:02:28" itemprop="dateCreated datePublished" datetime="2017-09-06T23:02:28+08:00">2017-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2017-10-15 20:03:36" itemprop="dateModified" datetime="2017-10-15T20:03:36+08:00">2017-10-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Underscore-string-java-是什么？"><a href="#Underscore-string-java-是什么？" class="headerlink" title="Underscore.string.java 是什么？"></a>Underscore.string.java 是什么？</h2><p><a target="_blank" rel="noopener" href="https://github.com/qianyan/underscore.string.java">underscore.string.java</a> 是一个Java中方便操作字符串的类库，提供了众多帮助方法。</p>
<h2 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h2><p>写过 Javascript 代码的人，估计没有几个不知道 <a target="_blank" rel="noopener" href="http://underscorejs.org/">underscore</a> 这个类库的，因为它太好（有）用了，尽管现如今由于实现上不够优雅的缘故，已经被<a target="_blank" rel="noopener" href="https://lodash.com/">lodash</a>所取代。而我想介绍的是 github 上 star 3000+的 <a target="_blank" rel="noopener" href="https://github.com/epeli/underscore.string">underscore.string</a>，它原本是 underscore 的扩展，不过现在已经演变成独立的库。顾名思义，它的作用就是弥补 Javascript 本身对于字符串操作支持的匮乏。<br>举个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> slugify = <span class="built_in">require</span>(<span class="string">&quot;underscore.string/slugify&quot;</span>);</span><br><span class="line"><span class="title function_">slugify</span>(<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line"></span><br><span class="line">-&gt; hello-world</span><br></pre></td></tr></table></figure>
<p><code>slugify</code>是一种规整字符串的操作，常用于把url中的非法字符规整成 <em>word-word</em> 的模样。比如，我的这篇 blog 是通过 hexo 生成的 <code>hexo new &quot;Underscore.string.java&quot;</code>，它会自动帮我转换成 <em>2017-09-06-Underscore-string-java</em> 这样的亲和url的格式。</p>
<h2 id="想法"><a href="#想法" class="headerlink" title="想法"></a>想法</h2><p>接触这个类库的时候，我正在使用 google <a target="_blank" rel="noopener" href="https://github.com/google/guava">guava</a>，惊讶于这里头的各类操作，包括 ImmutableList、CharMatcher、Strings 等等。一来准备针对 guava 练练手，二来确实想学习一下 underscore.string 的操作，所以就开始着手写起了 <a target="_blank" rel="noopener" href="https://github.com/qianyan/underscore.string.java">underscore.string.java</a> 这个项目。编写的过程中确实学到了不少平常不太可能接触到的设计方法。</p>
<h2 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h2><p>这个类库已经正式发布在 Maven Central Repository. 最新版本是 <a target="_blank" rel="noopener" href="http://search.maven.org/#search%7Cga%7C1%7Cunderscore.string.java">0.2.0</a>.</p>
<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><ul>
<li>java &gt;&#x3D; 1.6</li>
<li>guava 18.0</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="gradle"><a href="#gradle" class="headerlink" title="gradle"></a>gradle</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">&#x27;com.lambeta:underscore.string.java:0.2.0&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lambeta<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>underscore.string.java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="支持的特性"><a href="#支持的特性" class="headerlink" title="支持的特性"></a>支持的特性</h2><ul>
<li>capitalize</li>
<li>slugify</li>
<li>count</li>
<li>trim</li>
<li>ltrim</li>
<li>rtrim</li>
<li>repeat</li>
<li>decapitalize</li>
<li>join</li>
<li>reverse</li>
<li>clean</li>
<li>chop</li>
<li>splice</li>
<li>pred</li>
<li>succ</li>
<li>titleize</li>
<li>camelize</li>
<li>dasherize</li>
<li>underscored</li>
<li>classify</li>
<li>humanize</li>
<li>quote</li>
<li>unquote</li>
<li>surround</li>
<li>numberFormat</li>
<li>strRight</li>
<li>strRightBack</li>
<li>strLeft</li>
<li>strLeftBack</li>
<li>toSentence</li>
<li>truncate</li>
<li>lpad</li>
<li>rpad</li>
<li>lrpad</li>
<li>words</li>
<li>prune</li>
<li>isBlank</li>
<li>replaceAll</li>
<li>swapCase</li>
<li>naturalSort</li>
<li>naturalCmp</li>
<li>dedent</li>
<li>commonPrefix</li>
<li>commonSuffix</li>
<li>chopPrefix</li>
<li>chopSuffix</li>
<li>screamingUnderscored</li>
<li>stripAccents</li>
<li>pascalize</li>
<li>translate</li>
<li>mixedCase</li>
<li>collapseWhitespaces</li>
<li>ascii</li>
<li>chomp</li>
<li>startsWith</li>
<li>endsWith</li>
<li>levenshtein</li>
<li>hamming</li>
<li>longestCommonSubstring</li>
</ul>
<h2 id="New-Features-in-0-2-1-SNAPSHOT"><a href="#New-Features-in-0-2-1-SNAPSHOT" class="headerlink" title="New Features in 0.2.1-SNAPSHOT"></a>New Features in 0.2.1-SNAPSHOT</h2><h3 id="gradle-1"><a href="#gradle-1" class="headerlink" title="gradle"></a>gradle</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">repositories</span> &#123;</span><br><span class="line">    maven &#123;</span><br><span class="line">        url <span class="string">&#x27;https://oss.sonatype.org/content/groups/public&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">compile</span> (<span class="string">&quot;com.lambeta:underscore.string.java:0.2.1-SNAPSHOT&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="maven-1"><a href="#maven-1" class="headerlink" title="maven"></a>maven</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>my-repo<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>sonatype<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://oss.sonatype.org/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lambeta<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>underscore.string.java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>replaceZeroWidthDelimiterWith</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2017/04/27/How-to-active-different-profiles-in-SpringBootTest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ryan Qian">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鄢倩">
      <meta itemprop="description" content="Senior Consultant | DevOps Master | Blockchain & Web3 Specialist">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 鄢倩">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/04/27/How-to-active-different-profiles-in-SpringBootTest/" class="post-title-link" itemprop="url">如何在SpringBootTest中启用不同的profiles</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-04-27 08:39:56" itemprop="dateCreated datePublished" datetime="2017-04-27T08:39:56+08:00">2017-04-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2017-09-25 16:35:28" itemprop="dateModified" datetime="2017-09-25T16:35:28+08:00">2017-09-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h2><ul>
<li>测试类标注@ActiveProfiles(resolver &#x3D; ProfilesResolver.class)</li>
<li>自定义类 ProfilesResolver 实现接口 ActiveProfilesResolver，并实现接口中唯一的方法<code>resolve(Class&lt;?&gt; targetClass)</code></li>
<li>maven-surefire-plugin 插件中配置<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> &lt;systemPropertyVariables&gt;</span><br><span class="line">    &lt;spring.profiles.active&gt;$&#123;spring.profiles.active&#125;&lt;/spring.profiles.active&gt;</span><br><span class="line">&lt;/systemPropertyVariables&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>实现如下：</p>
<h3 id="1-标注启用"><a href="#1-标注启用" class="headerlink" title="1. 标注启用"></a>1. 标注启用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(classes = &#123;PetstoreApp.class&#125;, // 我们的 application 名为 PetstoreApp</span><br><span class="line">    webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span><br><span class="line">@ActiveProfiles(resolver = ProfilesResolver.class)</span><br><span class="line">public abstract class BaseResourceTest &#123;</span><br><span class="line">    @BeforeClass</span><br><span class="line">    public static void setUp() &#123;</span><br><span class="line">        String activeProfiles = System.getProperty(&quot;spring.profiles.active&quot;);</span><br><span class="line">        System.out.println(String.format(&quot;Resource Tests resolved profiles are [%s]&quot;, activeProfiles));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个类存在的意义就是为了让其它类别的 ResourceTest 继承它，并在一次启动当中运行完所有的集成测试。避免每个 ResourceTest 都初始化启动 Application，造成运行速度变慢。</p>
<p><strong>注意<code>abstract</code>关键字</strong><br>如果不使用<code>abstract</code>关键字，那么maven-surefire-plugin就会抛出如下错误：</p>
<blockquote>
<p>Tests in error:<br>  BaseResourceTest.initializationError »  No runnable methods</p>
</blockquote>
<h3 id="2-实现自定义类-ProfilesResolver，如下："><a href="#2-实现自定义类-ProfilesResolver，如下：" class="headerlink" title="2. 实现自定义类 ProfilesResolver，如下："></a>2. 实现自定义类 ProfilesResolver，如下：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.test.context.ActiveProfilesResolver;</span><br><span class="line"></span><br><span class="line">public class ProfilesResolver implements ActiveProfilesResolver &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String[] resolve(Class&lt;?&gt; aClass) &#123;</span><br><span class="line">        String activeProfiles = System.getProperty(&quot;spring.profiles.active&quot;);</span><br><span class="line"></span><br><span class="line">        return new String[] &#123;activeProfiles != null ? activeProfiles : &quot;local&quot;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里表示我们会从系统变量当中读取<em>spring.profiles.active</em>，但是这个变量从什么地方来呢？<br>我首先想到的是 maven 的 profiles 中设置 properties，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;profile&gt;</span><br><span class="line">        &lt;id&gt;local&lt;/id&gt;</span><br><span class="line">        &lt;properties&gt;</span><br><span class="line">            &lt;spring.profiles.active&gt;local&lt;/spring.profiles.active&gt;</span><br><span class="line">        &lt;/properties&gt;</span><br><span class="line">&lt;/profile&gt;</span><br></pre></td></tr></table></figure>
<p>如此，当我们在命令行中运行<code>mvn test -Plocal</code>的时候，就表明启用了 local 这个 profile。相应地，在 maven 的上下文当中，<em>spring.profiles.active</em>变量的值就是<em>local</em>。</p>
<p>但是运行测试的时候，我们 ProfilesResolver 中的<code> System.getProperty(&quot;spring.profiles.active&quot;)</code>返回的始终是<code>null</code>。其实道理很简单，maven 中定义的 properties 全是给 maven 自己（包含各类插件）用的，它并不会<strong>传递</strong>给应用程序使用。</p>
<p><strong>注意：</strong></p>
<hr>
<p>properties 中定义的 spring.profiles.active 其实主要是给插件 maven-resources-plugin 使用的，具体请参看备注。</p>
<hr>
<h3 id="3-定义systemPropertyVariables"><a href="#3-定义systemPropertyVariables" class="headerlink" title="3. 定义systemPropertyVariables"></a>3. 定义<code>systemPropertyVariables</code></h3><p>所以我们需要定义<code>systemPropertyVariables</code>，顾名思义，这是系统变量的定义，在应用程序中就可以使用<code>System.getProperty(&quot;spring.profiles.active&quot;)</code>获得。</p>
<p>放在哪里合适呢？跑测试的插件中最合适！</p>
<p>所以，我们有如下的配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;runOrder&gt;alphabetical&lt;/runOrder&gt;</span><br><span class="line">    &lt;systemPropertyVariables&gt;</span><br><span class="line">        &lt;spring.profiles.active&gt;$&#123;spring.profiles.active&#125;&lt;/spring.profiles.active&gt;</span><br><span class="line">    &lt;/systemPropertyVariables&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结合上面 properties 的配置，当我们再次运行<code>mvn test -Plocal</code>的时候，就会得到一个名为<em>spring.profiles.active</em>的系统变量，它的值由<code>$&#123;spring.profiles.active&#125;</code>决定。此处，就是local。</p>
<hr>
<h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p><strong>properties 中 spring.profiles.active 的另外用途</strong><br>只要 maven 的 properties 中定义了 <em>spring.profiles.active</em> ，运行<code>mvn spring-boot:run -Plocal</code>的时候，spring boot 就会启用<code>applicaiton-local.yml</code> profile 文件。</p>
<p>为什么会这样的呢？按常理推断，应该是<em>spring-boot-maven-plugin</em>的配置项自动读取了我们设置的 properties <code>spring.profiles.active</code>，但是只要看一眼这个插件的<a target="_blank" rel="noopener" href="http://docs.spring.io/spring-boot/docs/current/maven-plugin/run-mojo.html#profiles">文档</a>就会发现，除非显式地在插件的<em>configuration</em>下配置了<em>profiles</em>参数或者手动传入<em>run.profiles</em>系统变量<a target="_blank" rel="noopener" href="http://docs.spring.io/spring-boot/docs/current/maven-plugin/examples/run-profiles.html">example</a>，否则插件本身（可以像我一样扫一眼插件的<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-tools/spring-boot-maven-plugin/src/main/java/org/springframework/boot/maven/AbstractRunMojo.java">源码</a>）并无法感知到底启用 spring 的哪个 profile！所以这个假设不成立。</p>
<p><strong>答案在<em>bootstrap.yml</em>当中！</strong><br>以下是<em>resources&#x2F;config&#x2F;bootstrap.yml</em>中的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">    application:</span><br><span class="line">        name: petstore</span><br><span class="line">    profiles:</span><br><span class="line">        # The commented value for `active` can be replaced with valid Spring profiles to load.</span><br><span class="line">        # *注意底下这句话*</span><br><span class="line">        # Otherwise, it will be filled in by maven when building the WAR file</span><br><span class="line">        # Either way, it can be overridden by `--spring.profiles.active` value passed in the commandline or `-Dspring.profiles.active` set in `JAVA_OPTS`</span><br><span class="line">        active: #spring.profiles.active#</span><br></pre></td></tr></table></figure>
<p>这里的注释很有用，明确地告诉我们在构建 WAR 包的时候，maven 会帮我们把<code>#spring.profiles.active#</code>替换成真正的值。</p>
<p>这又是怎么做到的呢？一切归功于<em>maven-resources-plugin</em>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;$&#123;maven-resources-plugin.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;executions&gt;</span><br><span class="line">        &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;default-resources&lt;/id&gt;</span><br><span class="line">            &lt;phase&gt;validate&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">                &lt;goal&gt;copy-resources&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;outputDirectory&gt;target/classes&lt;/outputDirectory&gt;</span><br><span class="line">                &lt;useDefaultDelimiters&gt;false&lt;/useDefaultDelimiters&gt;</span><br><span class="line">                &lt;delimiters&gt;</span><br><span class="line">                    &lt;delimiter&gt;#&lt;/delimiter&gt; &lt;!-- 看这里 --&gt;</span><br><span class="line">                &lt;/delimiters&gt;</span><br><span class="line">                &lt;resources&gt;</span><br><span class="line">                    &lt;resource&gt;</span><br><span class="line">                        &lt;directory&gt;src/main/resources/&lt;/directory&gt;</span><br><span class="line">                        &lt;filtering&gt;true&lt;/filtering&gt;</span><br><span class="line">                        &lt;includes&gt;</span><br><span class="line">                            &lt;include&gt;**/*.xml&lt;/include&gt;</span><br><span class="line">                            &lt;include&gt;**/*.yml&lt;/include&gt;</span><br><span class="line">                        &lt;/includes&gt;</span><br><span class="line">                    &lt;/resource&gt;</span><br><span class="line">                    &lt;resource&gt;</span><br><span class="line">                        &lt;directory&gt;src/main/resources/&lt;/directory&gt;</span><br><span class="line">                        &lt;filtering&gt;false&lt;/filtering&gt;</span><br><span class="line">                        &lt;excludes&gt;</span><br><span class="line">                            &lt;exclude&gt;**/*.xml&lt;/exclude&gt;</span><br><span class="line">                            &lt;exclude&gt;**/*.yml&lt;/exclude&gt;</span><br><span class="line">                        &lt;/excludes&gt;</span><br><span class="line">                    &lt;/resource&gt;</span><br><span class="line">                &lt;/resources&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">        &lt;/execution&gt;</span><br><span class="line">    &lt;/executions&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure>

<p>这个插件除了简单的 copy 功能之外，还能进行 <em>Filtering</em> <a target="_blank" rel="noopener" href="https://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html">操作</a>。</p>
<blockquote>
<p>Filtering<br>Variables can be included in your resources. These variables, denoted by the ${…} delimiters, can come from the system properties, your project properties, from your filter resources and from the command line.</p>
</blockquote>
<p>大意是说，你可以在 resources 文件定义自己的变量，这些变量可以来自系统属性、maven 工程属性，你过滤的 resources 文件和命令行。</p>
<p>说白了，就是在 copy 资源文件的时候，同时帮你把文件中的变量（占位符）替换成真实的值。而这里就是通过<code>&lt;delimiter&gt;#&lt;/delimiter&gt;</code>来规定变量格式的！换句话说，在文件中只要是以<code>#</code>开头和结尾的字符串都会被替换掉（变量有定义的情况下；否则保持原样）。</p>
<p>这里，由于绑定了生命周期——validate，可以直接运行<code>mvn validate -Plocal</code>这样的命令进行快速验证。得到的<em>bootstrap.yml</em>内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">    application:</span><br><span class="line">        name: petstore</span><br><span class="line">    profiles:</span><br><span class="line">        # The commented value for `active` can be replaced with valid Spring profiles to load.</span><br><span class="line">        # Otherwise, it will be filled in by maven when building the WAR file</span><br><span class="line">        # Either way, it can be overridden by `--spring.profiles.active` value passed in the commandline or `-Dspring.profiles.active` set in `JAVA_OPTS`</span><br><span class="line">        active: dev # 替换成功</span><br></pre></td></tr></table></figure>

<p>回到最开始的疑问，为什么只要 maven 的 properties 中定义了 <em>spring.profiles.active</em> ，运行<code>mvn spring-boot:run -Plocal</code>的时候，就可以spring boot 就会启用<code>applicaiton-local.yml</code> profile 文件呢？</p>
<p>因为，maven 在运行命令之前已经做了 copy-resources 的操作，那时候就已经把<em>bootstrap.yml</em>中的<em>spring.profiles.active</em>替换成 local 了，所以启动 springboot application 的时候，它会启用<em>spring.profiles.active</em>代表的值，此处就是 local，那么启用的文件自然就是<em>application-local.yml</em>。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2017/04/18/Techniques-for-Efficiently-Learning-Programming-Languages/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ryan Qian">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鄢倩">
      <meta itemprop="description" content="Senior Consultant | DevOps Master | Blockchain & Web3 Specialist">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 鄢倩">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/04/18/Techniques-for-Efficiently-Learning-Programming-Languages/" class="post-title-link" itemprop="url">如何高效地学习编程语言</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2017-04-18 15:15:09 / 修改时间：21:44:20" itemprop="dateCreated datePublished" datetime="2017-04-18T15:15:09+08:00">2017-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Clojure/" itemprop="url" rel="index"><span itemprop="name">Clojure</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>这是Clojure好书《Clojure for the Brave and True》作者 Daniel Higginbotham 写于2017年4月16日的博文。从作者的丰富的经验来看，本文非常具有指导意义。</p>
</blockquote>
<p>学习编程语言是一种技巧：做好了，你会感受到掌握新事物之后的快感（dopamine：多巴胺）；做不好，就会接二连三的沮丧，甚至放弃。下面这些学习编程语言的最佳技巧是我从多年的<a target="_blank" rel="noopener" href="http://www.braveclojure.com/">著书</a><a target="_blank" rel="noopener" href="http://www.flyingmachinestudios.com/programming/the-unofficial-guide-to-rich-hickeys-brain/">写作</a>，<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=eRq5UBx6cbA">演讲</a>和<a target="_blank" rel="noopener" href="http://www.braveclojure.com/training/">培训</a>中总结出来的。这里头很多技巧来源于对高效学习前沿研究做了解释的书籍。你可以在 <a target="_blank" rel="noopener" href="http://www.communitypicks.com/r/learnprogramming">Community Picks Learn Programming</a> 中找到那些书（还有其它牛x的编程书籍）。</p>
<h2 id="持续测试自己以抵抗胜任力错觉"><a href="#持续测试自己以抵抗胜任力错觉" class="headerlink" title="持续测试自己以抵抗胜任力错觉"></a>持续测试自己以抵抗胜任力错觉</h2><p>最不济的学习方法中的一种就是重读或者重看材料。这种重复会给你一种感觉——似乎不用花什么气力，你就理解了话题所涵盖的内容。研究者们把这种现象称作胜任力错觉。</p>
<p>更好的一种方式（你可以掌握的最佳技巧之一）则是持续地测试自己。不要重读一个函数、类或者一个对象是什么，而是让自己定义这些概念或者把它们用到短小的程序当中——强迫你用某种方式显示自己的理解。这一过程常常很不舒服的，但是对形成长期记忆非常有效。更进一步，你可以在阅读材料之前先去行测试，举个例子，尝试在阅读一个章节之前做做练习。值得一提的是，这也被证明有助于记忆的形成。</p>
<p>测试对于学习的显著影响被称为<strong>测试效用</strong>，下面是一些具体方法可以利用：</p>
<ul>
<li>在阅读章节或者看视频之前，尝试猜测你将要学习的东西，并写下来。</li>
<li>在阅读章节之前先做做这个章节的练习题。</li>
<li>一直做练习，即使是最难的那些。暂时（永远）放弃一个练习也是可以的，不过至少要尝试一遍。（下个章节会详细谈到）</li>
<li>阅读短小的程序并且尝试不看源码重新写一个。或者，再小一些，写个函数也行。</li>
<li>在学习了对象、类、方法或者高阶函数等新概念之后，立即编码做示例。</li>
<li>创建阐述这些概念的图示，以及这些概念之间的区别和联系。</li>
<li>把你刚刚学到的概念写成博客。</li>
<li>尝试把概念解释给非技术的朋友听。（在写《Clojure for Brave and True》的时候，我常常这么干。这样能够以外行的话阐述一个想法，进而迫使你深入理解想法本身。）</li>
</ul>
<p>这些技巧的大部分都要规约到编写代码上！说到编程，由于程序都是重文本和概念性的，所以很容易以为我们仅仅通过阅读（代码）就在学习。但是程序同时也是一门手艺，就像其它手艺一样你得操练才能娴熟。编码是暴露你对程序作有错误假设的最佳方式。你越快地这么做，就会越快地纠正错误和提升技能。</p>
<p>如果你想了解更多测试效应的事情，敬请查看<a target="_blank" rel="noopener" href="http://www.communitypicks.com/r/learnprogramming/s/17592186047889-make-it-stick-the-science-of-successful-learning">坚持：成功学习的科学（make it stick： The Science of Successful Learning）</a>。</p>
<h2 id="花时间放空自己"><a href="#花时间放空自己" class="headerlink" title="花时间放空自己"></a>花时间放空自己</h2><p>如果你纠结在一个问题上，或者对刚才读到的东西不能理解，就去散散步甚或洗个澡 —— 只要能进入一种舒缓、放空的状态就行。解除障碍的最佳方式之一就是歇一会儿，这可能听上去有点反直觉，但确实如此。</p>
<p>问题是，当全神贯注解决问题时，我们很容易陷入思维障碍（mental blinder）。我的意思是，这差不多就是“关注”（字面上）的意思。不过，全神贯注会导致我们只能一直探索解决方案空间的一小部分。一旦放空，我们的潜意识就可以探索并联结我们经验中的广泛领域。</p>
<p>对我来说，这就像当你试图在纸质地图上找到一个目的地（是否还记得？）。你不用刻意就确信你想抵达的城市应该就在这里！在地图的左上角的区域，所以你看了一遍又一遍，都没有成功。然后你放下地图，做了深呼吸并让目光游离了一会儿。当你重新看地图时，确切的地点立马映入眼帘。</p>
<p>我们曾经都有过这样的经验，在洗澡的时候突发灵感。现在你对于为什么这么做有了更好的了解，那么也就能刻意地使用这个技巧。个人来讲，如果纠结在某事上，我真的会洗个澡，这个技巧的功效显著。另一方面，我又是多么干净（注：洗澡这件事）。</p>
<p>如果你想多学一些关于思考的关注和分散模式，敬请查看<a target="_blank" rel="noopener" href="http://www.communitypicks.com/r/learnprogramming/s/17592186047884-a-mind-for-numbers-how-to-excel-at">A Mind for Numbers: How to Excel at Math and Science (Even If You FLunked Algebra)</a></p>
<h2 id="别浪费时间沮丧"><a href="#别浪费时间沮丧" class="headerlink" title="别浪费时间沮丧"></a>别浪费时间沮丧</h2><p>和上一个章节相关：别浪费时间为代码沮丧了。沮丧会让我们做一些愚蠢的事情，比如重新编译或者重刷浏览器，期望这次会有所不同。</p>
<p>把沮丧看作你的知识有差距的信号。一旦你意识到自己沮丧了，它可以帮你后退一步，清晰地识别问题。如果你写的代码不起作用，坦率地向自己或者别人说明你期望的结果。使用科学的方法，就非预期行为的根因提出一个假说。然后测试你的假说。再次试验后，如果依然解决不了，就把这个问题放到一边，待会儿回来。</p>
<p>在一些似乎没法解决的问题上，我不知有多少次恼怒地扔掉了自己的笔记本电脑。隔天再看，一个显而易见的解决方案立马跳入脑海。甚至上周就发生过。</p>
<h2 id="确认你正在处理语言的哪个方面"><a href="#确认你正在处理语言的哪个方面" class="headerlink" title="确认你正在处理语言的哪个方面"></a>确认你正在处理语言的哪个方面</h2><p>个人观点，我觉得记住这些是有用的——当学习一门编程语言的时候，你实际上正在学四件事情。</p>
<ul>
<li>怎么写代码：语法、语义以及资源管理</li>
<li>语言的范式：面向对象，函数式，逻辑等</li>
<li>产出物的生态圈：如何构建、运行可执行文件以及如何使用库</li>
<li>工具：编辑器，编译器，调试器，代码质量检测器（linter）</li>
</ul>
<p>这四项很容易搞混，不幸的结果是，当你遇到问题最终完全找错了地方。</p>
<p>举个例子，某些完全的编程新手，可能准备开始构建iOS应用。他们可能会试着让自己的应用在朋友的手机上运行，只看得到有关需要开发人员证书或其他信息的消息。这是产出物生态圈的一部分，不过小白可能将此视为编写代码的问题。他们可能会浏览自己写的每行代码来尝试解决问题，尽管问题和代码没有半毛钱关系。</p>
<p>如果我系统地处理这些方面，我会发现学习一种语言会更加容易。我将在其它的博客文章中罗列一些待回答的宽泛问题的列表，应该能帮助你学习任何语言。</p>
<h2 id="明确目的，外部模型，内部模型"><a href="#明确目的，外部模型，内部模型" class="headerlink" title="明确目的，外部模型，内部模型"></a>明确目的，外部模型，内部模型</h2><p>任何时候你学习使用新工具，明确学习的目的，外部模型和内部模型都是十分有用的。</p>
<p>当你了解了工具的目的时，你的大脑会加载有用的上下文细节，使你更容易吸收新知识。这就好比拼图：当你看到完整拼图之后，更容易把各部件拼到一起。这个道理适用于语言本身以及语言库。</p>
<p>工具的外部模型就是它呈现出来的接口以及它想让你思考问题解决的方式。Clojure 的外部模型就是一个 Lisp，它想让你把编程当做大部分以数据为中心，不可变的转换过程。Ansible 希望你把服务器的整备工作想成定义最终状态，而不是定义抵达那种状态所要采取的步骤。</p>
<p>工具的内部模型就是如何将输入到其接口转换成一些底层的抽象。Clojure 把 Lisp 转换成 JVM 的字节码。Ansible 把任务定义转换成了 shell 命令。在一个理想国中，你不需要理解工具的内部模型，但事实上，理解内部模型总是有用的，因为在某些看上去迷惑或者矛盾的部分，它可以让你有个统一视图。举个例子，当 DNA 双螺旋模型被发现的时候，它帮助科学家们了解更高层次的现象。从我的角度来讲，当然，这篇博文也是历来所有伟大科学成就之一。</p>
<p>很多教程经常混淆工具的外部和内部模型，使学习者感到困惑。意识到这点可以帮你轻松辨别何时你会感到沮丧。</p>
<h2 id="间隔重复帮助记忆"><a href="#间隔重复帮助记忆" class="headerlink" title="间隔重复帮助记忆"></a>间隔重复帮助记忆</h2><p>间隔重复被证明是长期记忆中新信息编码的最佳方法之一。 这个想法是以不断增加的时间间隔来测验自己，使用最少重复次数来最小化记忆衰减。 卫报写了一篇<a target="_blank" rel="noopener" href="https://www.theguardian.com/education/2016/jan/23/spaced-repetition-a-hack-to-make-your-brain-store-information">很好的介绍性文章</a>。</p>
<h2 id="睡眠和练习"><a href="#睡眠和练习" class="headerlink" title="睡眠和练习"></a>睡眠和练习</h2><p>保重身体！身体可不仅仅是你脑袋的载体。如果你想保持专注和高效的学习，就要足够的睡眠和练习，而不是（原文：beats the pants off）狂饮咖啡因和能量饮料。</p>
<h2 id="更多小贴士"><a href="#更多小贴士" class="headerlink" title="更多小贴士"></a>更多小贴士</h2><p>如果你还有其它有用的技巧，请不吝评论！如果你想知道更多关于学习编程的优质资源，敬请查看<a target="_blank" rel="noopener" href="http://www.communitypicks.com/r/learnprogramming">Community Picks: Learn Programming</a>，这是一个社区策划编程学习书籍的收集活动，内容广泛，包含入门编程，工艺以及关于软技能和面试方面的书籍。</p>
<hr>
<p>原文链接<br>[1] <a target="_blank" rel="noopener" href="http://www.flyingmachinestudios.com/programming/learn-programming-languages-efficiently/">Techniques for Efficiently Learning Programming Languages</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Ryan Qian</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>






  <script src="/js/third-party/addtoany.js"></script>

  





</body>
</html>
