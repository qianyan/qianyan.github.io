<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"qianyan.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Elegance and familiarity are orthogonal">
<meta property="og:type" content="website">
<meta property="og:title" content="λ">
<meta property="og:url" content="https://qianyan.github.io/page/6/index.html">
<meta property="og:site_name" content="λ">
<meta property="og:description" content="Elegance and familiarity are orthogonal">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lambeta">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://qianyan.github.io/page/6/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/6/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>λ</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">λ</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">(conj clojurians me)</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">lambeta</p>
  <div class="site-description" itemprop="description">Elegance and familiarity are orthogonal</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">77</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/qianyan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;qianyan" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:qianyan.lambda@gmail.com" title="E-Mail → mailto:qianyan.lambda@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://weibo.com/3672207020" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;3672207020" rel="noopener me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://x.com/_qian_yan" title="Twitter → https:&#x2F;&#x2F;x.com&#x2F;_qian_yan" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="http://blog.jayfields.com/" title="http:&#x2F;&#x2F;blog.jayfields.com&#x2F;" rel="noopener" target="_blank">Jay Fields</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://aphyr.com/" title="https:&#x2F;&#x2F;aphyr.com" rel="noopener" target="_blank">Aphyr</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://bucharestfp.ro/" title="http:&#x2F;&#x2F;bucharestfp.ro" rel="noopener" target="_blank">Bucharest FP</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://www.yinwang.org/" title="http:&#x2F;&#x2F;www.yinwang.org" rel="noopener" target="_blank">Wangyin</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://blog.rlmflores.me/" title="http:&#x2F;&#x2F;blog.rlmflores.me&#x2F;" rel="noopener" target="_blank">Rodrigo Flores</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://seancorfield.github.io/" title="https:&#x2F;&#x2F;seancorfield.github.io&#x2F;" rel="noopener" target="_blank">Seancorfield</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2015/01/27/Javascript-Hoisting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lambeta">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="λ">
      <meta itemprop="description" content="Elegance and familiarity are orthogonal">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | λ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/01/27/Javascript-Hoisting/" class="post-title-link" itemprop="url">Javascript Hoisting</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2015-01-27 22:47:12" itemprop="dateCreated datePublished" datetime="2015-01-27T22:47:12+08:00">2015-01-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2017-10-23 19:35:24" itemprop="dateModified" datetime="2017-10-23T19:35:24+08:00">2017-10-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>编程过程中，别人谈到Javascript中的funcation是顺序执行的，所以书写的顺序要留心，不然会出未定义就执行的错误。当然，C语言出身的程序员不以为意，会认为理所当然，C语言就是这么干的。但Javascript并非如此！</p>
<figure class="highlight javascript"><figcaption><span>ints.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ints</span>(<span class="params">arrOfNumberStr</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> arrOfNumberStr.<span class="title function_">map</span>(toInt);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">toInt</span>(<span class="params">str</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">parseInt</span>(str, <span class="number">10</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">ints</span>([<span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;11&#x27;</span>]);</span><br><span class="line">-&gt; [<span class="number">11</span>, <span class="number">11</span>, <span class="number">11</span>]</span><br></pre></td></tr></table></figure>
<p>从执行结果上来看，先调用后执行时正确的。但是JS是解析执行的，如果没有预先定义，执行到调用处必然会失败，那么为什么这段代码可以工作呢？</p>
<p>先看一段略做修改之后的代码</p>
<figure class="highlight javascript"><figcaption><span>ints_fail.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ints</span>(<span class="params">arrOfNumberStr</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> arrOfNumberStr.<span class="title function_">map</span>(toInt);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> toInt = <span class="keyword">function</span>(<span class="params">str</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">parseInt</span>(str, <span class="number">10</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">ints</span>([<span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;11&#x27;</span>]);</span><br><span class="line">-&gt; <span class="title class_">TypeError</span>: <span class="literal">undefined</span> is not a <span class="keyword">function</span></span><br></pre></td></tr></table></figure>
<p>执行结果失败了。回头看这两段代码的定义，不难发现程序对于<code>toInt</code>的定义方式有差别，一种用常规的函数定义方式，一种使用<strong>var</strong>定义。</p>
<p>接着再看一段代码</p>
<figure class="highlight javascript"><figcaption><span>variables.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params">n</span>) &#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;n; i++);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">loop</span>(<span class="number">10</span>);</span><br><span class="line">-&gt; <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>估计学习C语言的人开始惊讶了：这个<code>i</code>的作用域不是应该只在<code>for loop</code>中吗？</p>
<p>那么到底是什么原因造成的呢？这就是Javascript Hoisting！简单解释，声明提升到作用域的最前面。</p>
<p>接上面的<em>variable.js</em></p>
<figure class="highlight javascript"><figcaption><span>variables_hoisting.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params">n</span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> i;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;n; i++);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这和原来的写法是等价的，所以<code>i</code>的作用域在整个<code>function</code>中都是有效的。依次类推，<em>init_fail.js</em>中的<code>var toInt</code>这样的函数声明也会被提升到作用域的最上方，但是只是声明被提升了，真正赋值还是在后面，所以此时调用该函数，它还是<code>undefined</code>。</p>
<p>但是对于<em>init.js</em>而言，它的声明方式会将整个函数都提升，所以它是先于调用方赋值初始化的，所以能工作。</p>
<h3 id="‘use-strict’-可以防止-only-reference-hoisting"><a href="#‘use-strict’-可以防止-only-reference-hoisting" class="headerlink" title="‘use strict’ 可以防止 only reference hoisting?"></a>‘use strict’ 可以防止 only reference hoisting?</h3><hr>
<p>如果变量未声明，<strong>use strict</strong>模式下赋值会报错。</p>
<figure class="highlight javascript"><figcaption><span>use_strict.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> foo = <span class="number">123</span>;<span class="comment">//works fine</span></span><br><span class="line">    bar = <span class="number">345</span>;<span class="comment">//ReferenceError: bar is not defined</span></span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>
<p>如果在以前例子中使用<strong>use strict</strong>，并不能提前报出<code>toInt</code>未赋值的错误。直到运行期间，才会发现<code>toInt</code>依然<code>undefined</code>。</p>
<figure class="highlight javascript"><figcaption><span>use_strict_for_hoisting.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> <span class="title function_">ints</span>(<span class="params">arrOfNumberStr</span>) &#123;</span><br><span class="line">	<span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">	<span class="keyword">return</span> arrOfNumberStr.<span class="title function_">map</span>(toInt);</span><br><span class="line">	<span class="keyword">var</span> toInt = <span class="keyword">function</span>(<span class="params">str</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">parseInt</span>(str, <span class="number">10</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)([<span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;11&#x27;</span>]);</span><br><span class="line">-&gt; <span class="title class_">Uncaught</span> <span class="title class_">TypeError</span>: <span class="literal">undefined</span> is not a <span class="keyword">function</span>(<span class="params">…</span>)</span><br></pre></td></tr></table></figure>

<h3 id="优先使用function-declaration"><a href="#优先使用function-declaration" class="headerlink" title="优先使用function declaration"></a>优先使用function declaration</h3><hr>
<blockquote>
<p>Why? Function declarations are named, so they’re easier to identify in call stacks. Also, the whole body of a function declaration is hoisted, whereas only the reference of a function expression is hoisted. This rule makes it possible to always use Arrow Functions in place of function expressions. – from <a target="_blank" rel="noopener" href="https://github.com/airbnb/javascript#functions">javascript style guide</a></p>
</blockquote>
<p>下篇会记录Javascript的<a target="_blank" rel="noopener" href="http://lambeta.com/2015/01/30/Javascript-Scope/">作用域</a>，<code>Global Scope, Lexical Scope, Dynamic Scope, Function Scope</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2015/01/27/Javascript-Modularize-2nd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lambeta">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="λ">
      <meta itemprop="description" content="Elegance and familiarity are orthogonal">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | λ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/01/27/Javascript-Modularize-2nd/" class="post-title-link" itemprop="url">Javascript Modularize 2nd</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2015-01-27 00:01:26" itemprop="dateCreated datePublished" datetime="2015-01-27T00:01:26+08:00">2015-01-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2016-09-06 22:39:55" itemprop="dateModified" datetime="2016-09-06T22:39:55+08:00">2016-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="NodeJS-Module-require"><a href="#NodeJS-Module-require" class="headerlink" title="NodeJS Module require"></a>NodeJS Module require</h4><p>require实现了CommonJS标准，在Node中作为一个全局的函数来支持模块管理。<br>但是开发中遇到了一个有意思的场景：</p>
<p>假如ModuleA和ModuleB同时依赖一个第三方库，简单起见，设为<code>var Foo = &#123;request: &#39;foo&#39;&#125;</code></p>
<p>现在ModuleA引入Foo.js</p>
<figure class="highlight javascript"><figcaption><span>ModuleA</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Foo</span> = <span class="built_in">require</span>(<span class="string">&#x27;Foo&#x27;</span>);</span><br><span class="line"><span class="title class_">Foo</span>.<span class="property">request</span> = <span class="string">&#x27;bar&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>ModuleB中也引入Foo.js</p>
<figure class="highlight javascript"><figcaption><span>ModuleB</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Foo</span> = <span class="built_in">require</span>(<span class="string">&#x27;Foo&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Foo</span>.<span class="property">request</span>); <span class="comment">//bar</span></span><br></pre></td></tr></table></figure>
<p>结果是这个对象的属性被改变了！这不就相当于全局变量了吗？</p>
<p>不过，据此可以推测NodeJS是如何实现require的：</p>
<ol>
<li>内部把依赖的module用function包装了一遍，使得require的变量变成私有的；</li>
<li>内部使用缓存机制，防止重复加载相同的JS文件。</li>
</ol>
<figure class="highlight javascript"><figcaption><span>module.js</span><a target="_blank" rel="noopener" href="https://github.com/joyent/node/blob/069dd07a1732c6a752773aaed9e8c18ab472375f/lib/module.js#L354">NodeJs</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Module</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">require</span> = <span class="keyword">function</span>(<span class="params">path</span>) &#123;</span><br><span class="line">  <span class="title function_">assert</span>(util.<span class="title function_">isString</span>(path), <span class="string">&#x27;path must be a string&#x27;</span>);</span><br><span class="line">  <span class="title function_">assert</span>(path, <span class="string">&#x27;missing path&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Module</span>.<span class="title function_">_load</span>(path, <span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>上面这段代码就是require源代码，直接进入_load：</p>
<figure class="highlight javascript"><figcaption><span>Module._load</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Module</span>.<span class="property">_load</span> = <span class="keyword">function</span>(<span class="params">request, parent, isMain</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (parent) &#123;</span><br><span class="line">    <span class="title function_">debug</span>(<span class="string">&#x27;Module._load REQUEST  &#x27;</span> + (request) + <span class="string">&#x27; parent: &#x27;</span> + parent.<span class="property">id</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> filename = <span class="title class_">Module</span>.<span class="title function_">_resolveFilename</span>(request, parent);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> cachedModule = <span class="title class_">Module</span>.<span class="property">_cache</span>[filename];</span><br><span class="line">  <span class="keyword">if</span> (cachedModule) &#123;</span><br><span class="line">    <span class="keyword">return</span> cachedModule.<span class="property">exports</span>;</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line">  <span class="keyword">var</span> <span class="variable language_">module</span> = <span class="keyword">new</span> <span class="title class_">Module</span>(filename, parent);</span><br><span class="line">...</span><br><span class="line">  <span class="title class_">Module</span>.<span class="property">_cache</span>[filename] = <span class="variable language_">module</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> hadException = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable language_">module</span>.<span class="title function_">load</span>(filename); <span class="comment">//invoke extensions[&#x27;.js|json&#x27;] -&gt; _compile js</span></span><br><span class="line">    hadException = <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (hadException) &#123;</span><br><span class="line">      <span class="keyword">delete</span> <span class="title class_">Module</span>.<span class="property">_cache</span>[filename];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">module</span>.<span class="property">exports</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我省略一些无关紧要的代码，仅从以上代码可以看出，确实有cache使用了，所以require到内存中的对象其实只有一个！</p>
<figure class="highlight plaintext"><figcaption><span>Module.prototype._compile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// create wrapper function</span><br><span class="line">  var wrapper = Module.wrap(content);</span><br><span class="line">  var compiledWrapper = runInThisContext(wrapper, &#123; filename: filename &#125;);</span><br><span class="line">...</span><br><span class="line">  var args = [self.exports, require, self, filename, dirname];</span><br><span class="line">  return compiledWrapper.apply(self.exports, args);</span><br></pre></td></tr></table></figure>
<p>上面是一小段compile的代码，执行到这里的顺序是_load -&gt; _extensions[‘.js’] -&gt; _compile.<br>可以看到确实进行了wrap操作，将js文件中的内容wrap成一个function, 最后传入self.exports (module.exports)，这样module.exports便继承了原JS执行的结果。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2015/01/25/Javascript-Modularize/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lambeta">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="λ">
      <meta itemprop="description" content="Elegance and familiarity are orthogonal">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | λ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/01/25/Javascript-Modularize/" class="post-title-link" itemprop="url">Javascript Modularize</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2015-01-25 17:28:40" itemprop="dateCreated datePublished" datetime="2015-01-25T17:28:40+08:00">2015-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2016-09-06 22:55:53" itemprop="dateModified" datetime="2016-09-06T22:55:53+08:00">2016-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Closure"><a href="#Closure" class="headerlink" title="Closure"></a>Closure</h3><h4 id="什么是闭包？"><a href="#什么是闭包？" class="headerlink" title="什么是闭包？"></a>什么是闭包？</h4><blockquote>
<p>一个包含了自由变量的开发表达式，和该自由变量的约束环境组合之后，产生了一种封闭的状态。</p>
</blockquote>
<p>举个例子，如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">inc</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> counter++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//invoke</span></span><br><span class="line"><span class="keyword">var</span> id = <span class="title function_">inc</span>();</span><br><span class="line"><span class="title function_">id</span>(); <span class="comment">//0</span></span><br><span class="line"><span class="title function_">id</span>(); <span class="comment">//1</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>变量counter只在inc中可见，inc就是counter的约束环境，而内部的function就是开放的表达式，达到的封闭状态就是闭包。</p>
<h3 id="Javascript-Closure"><a href="#Javascript-Closure" class="headerlink" title="Javascript Closure"></a>Javascript Closure</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>);</span><br><span class="line">&#125;())</span><br><span class="line">or</span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>);</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<p>注意两种闭包的写法: **()**一个在内，另一个在外，两者是等价的。<br>这种写法有两个作用</p>
<ol>
<li>立即执行(Immediately-Invoked Function Expression, IIFE)</li>
<li>封装内部变量，使之对外不可见</li>
</ol>
<p><strong>NOTICE</strong><br><code>对外不可见，不代表闭包内部不能访问全局变量。闭包内部是可以访问外部变量的，如上面的例子所示</code></p>
<blockquote>
<p>JavaScript has a feature known as implied globals. Whenever a name is used, the interpreter walks the scope chain backwards looking for a var statement for that name. If none is found, that variable is assumed to be global. If it’s used in an assignment, the global is created if it doesn’t already exist. This means that using or creating global variables in an anonymous closure is easy. Unfortunately, this leads to hard-to-manage code, as it’s not obvious (to humans) which variables are global in a given file.</p>
</blockquote>
<p>以上就是理由。这种做法不好的地方有三个：</p>
<ol>
<li>代码不便管理，这是全局变量的弊病</li>
<li>依赖关系不明确</li>
<li>性能损失，因为需要向后查找变量声明</li>
</ol>
<p>正确的做法是导入作用域</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(function(window)&#123;</span><br><span class="line">	console.log(window);</span><br><span class="line">&#125;)(window)</span><br></pre></td></tr></table></figure>

<p>借助closure，我们可以简单实现JS的模块化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var module = (function()&#123;</span><br><span class="line">	var counter = 0;</span><br><span class="line">	return &#123;</span><br><span class="line">		inc: function() &#123;</span><br><span class="line">			return counter++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">//invoke</span><br><span class="line">module.counter //undefined</span><br><span class="line">module.inc(); //0</span><br><span class="line">module.inc(); //1</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="Augmentation-mixin-trait-…"><a href="#Augmentation-mixin-trait-…" class="headerlink" title="Augmentation (mixin, trait …)"></a>Augmentation (mixin, trait …)</h3><p>模块化之后，如何扩展这部分的功能？</p>
<h4 id="Loose-augmentation"><a href="#Loose-augmentation" class="headerlink" title="Loose augmentation"></a>Loose augmentation</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var module = (function(self)&#123;</span><br><span class="line"></span><br><span class="line">	self.todo = function() &#123;</span><br><span class="line">		console.log(&#x27;cannot access counter&#x27;);</span><br><span class="line">	&#125;</span><br><span class="line">	return self;</span><br><span class="line">&#125;)(module || &#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>之所以称为宽松augmentation，是因为多个modules可以异步加载。如果变量没有声明，就会重新创建。与之对应的就是Tight augmentation</p>
<h4 id="Tight-augmentation"><a href="#Tight-augmentation" class="headerlink" title="Tight augmentation"></a>Tight augmentation</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var module = (function(self)&#123;</span><br><span class="line"></span><br><span class="line">	self.todo = function() &#123;</span><br><span class="line">		console.log(&#x27;cannot access counter&#x27;);</span><br><span class="line">	&#125;</span><br><span class="line">	return self;</span><br><span class="line">&#125;)(module)</span><br></pre></td></tr></table></figure>
<p>这样就要求严格的加载顺序了。</p>
<p>更多模式参考 <a target="_blank" rel="noopener" href="http://www.adequatelygood.com/JavaScript-Module-Pattern-In-Depth.html">JavaScript Module Pattern: In-Depth</a></p>
<p>通用的JS规范共有两种：CommonJS和AMD</p>
<h3 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h3><p>该标准中，有一个自由函数require，用于加载模块。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//math.js</span><br><span class="line">exports.add = function() &#123;</span><br><span class="line">    var sum = 0, i = 0, args = arguments, l = args.length;</span><br><span class="line">    while (i &lt; l) &#123;</span><br><span class="line">        sum += args[i++];</span><br><span class="line">    &#125;</span><br><span class="line">    return sum;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这样就可以在其他模块中引用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//increment.js</span><br><span class="line">var add = require(&#x27;math&#x27;).add;</span><br><span class="line">exports.increment = function(val) &#123;</span><br><span class="line">    return add(val,1);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>NOTICE</strong></p>
<p><code>任何require进来的模块，其变量都是私有的</code></p>
<p>举个例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//program.js</span><br><span class="line">var inc = require(&#x27;increment&#x27;).increment;</span><br><span class="line">var a = 1;</span><br><span class="line">inc(a); // 2</span><br><span class="line">inc.add //undefined</span><br><span class="line">module.id == &quot;program&quot;;</span><br></pre></td></tr></table></figure>
<p>这里的inc.add对于program.js是不可见的。</p>
<p>NodeJs的模块系统实现了改标准 <a target="_blank" rel="noopener" href="http://nodejs.org/docs/latest/api/modules.html">Nodejs Module</a></p>
<h3 id="AMD-Asynchronous-Module-Definition"><a href="#AMD-Asynchronous-Module-Definition" class="headerlink" title="AMD (Asynchronous Module Definition)"></a>AMD (Asynchronous Module Definition)</h3><p>对于浏览器环境，由于js文件在服务端，异步加载使得CommonJS不实用了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">define(&quot;alpha&quot;, [&quot;require&quot;, &quot;exports&quot;, &quot;beta&quot;],</span><br><span class="line">function (require, exports, beta) &#123;</span><br><span class="line">       exports.verb = function() &#123;</span><br><span class="line">           return beta.verb();</span><br><span class="line">           //Or:</span><br><span class="line">           return require(&quot;beta&quot;).verb();</span><br><span class="line">       &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这样，只有等到所有的模块加载成功后，才会调用回调函数。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2014/11/19/maven-in-action/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lambeta">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="λ">
      <meta itemprop="description" content="Elegance and familiarity are orthogonal">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | λ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2014/11/19/maven-in-action/" class="post-title-link" itemprop="url">maven in action</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2014-11-19 22:20:49" itemprop="dateCreated datePublished" datetime="2014-11-19T22:20:49+08:00">2014-11-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2018-02-02 10:59:16" itemprop="dateModified" datetime="2018-02-02T10:59:16+08:00">2018-02-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="maven-phases-and-plugins-goal"><a href="#maven-phases-and-plugins-goal" class="headerlink" title="maven phases and plugins goal"></a>maven phases and plugins goal</h2><h3 id="three-built-in-Lifecycle"><a href="#three-built-in-Lifecycle" class="headerlink" title="three built-in Lifecycle"></a>three built-in Lifecycle</h3><ul>
<li>default</li>
<li>clean</li>
<li>site</li>
</ul>
<h3 id="built-in-Lifecycle-is-made-up-of-phases"><a href="#built-in-Lifecycle-is-made-up-of-phases" class="headerlink" title="built-in Lifecycle is made up of phases"></a>built-in Lifecycle is made up of phases</h3><ul>
<li>default<ul>
<li>validate - validate project is correct and all neccessary infomation is avaiable</li>
<li>compile</li>
<li>test</li>
<li>package</li>
<li>integration-test</li>
<li>verify - run and checks to verify the package is valid and meets quality criteria</li>
<li>install - install to local repository</li>
<li>deploy - copy the final package to the remote repository for sharing.</li>
</ul>
</li>
</ul>
<h3 id="a-build-phase-is-made-up-of-plugin-goals"><a href="#a-build-phase-is-made-up-of-plugin-goals" class="headerlink" title="a build phase is made up of plugin goals"></a>a build phase is made up of plugin goals</h3><ul>
<li>a plugin goal represents a specific task, and bound to those build phases.</li>
<li>it’s bound to zero or more build phases</li>
<li><code>mvn clean dependency:copy-dependencies package</code></li>
<li>a phase can also have zero or more goals bound to it. if a build phase has no goals bound to it, it cannot execute.</li>
</ul>
<p><code>编写插件的时候，我们会给每一个goal默认绑定一个phase，所以在对应的plugin中，我们或许不需要显式绑定两者</code></p>
<h3 id="maven-core-concept-coordinate-and-dependency"><a href="#maven-core-concept-coordinate-and-dependency" class="headerlink" title="maven core concept: coordinate and dependency"></a>maven core concept: coordinate and dependency</h3><h4 id="coordinate"><a href="#coordinate" class="headerlink" title="coordinate"></a>coordinate</h4><ul>
<li>groupId</li>
<li>artifactId</li>
<li>version</li>
<li>packaging - jar（default）, war</li>
<li>classfier - javadoc.jar, sources.jar. cannot defined directly</li>
</ul>
<h4 id="dependency"><a href="#dependency" class="headerlink" title="dependency"></a>dependency</h4><ul>
<li>dependency scope: (compile, test, provided, runtime, system, import), provided(servlet-api) system should with systemPath.</li>
<li>transitive dependency</li>
<li>dependency mediate (the shortest path, otherwise declartive order in pom)</li>
<li>execlusion dependency(groupId &amp; artifactId)</li>
</ul>
<p>How to look for dependency</p>
<p><code>mvn dependency:list mvn dependency:tree</code></p>
<p><code>mvn dependency:analyze</code> : 标注声明但未使用的依赖或者使用但未声明的依赖(传递依赖)</p>
<h4 id="dependency-management"><a href="#dependency-management" class="headerlink" title="dependency management"></a>dependency management</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure>
<p><code>防止subModules继承不必要的依赖，同时如果需要，只要在subModule中声明此依赖的groupId, artifactId，无需对应的versionId，因为这是可以继承自parentModule的</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2014/11/17/funny-q/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lambeta">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="λ">
      <meta itemprop="description" content="Elegance and familiarity are orthogonal">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | λ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2014/11/17/funny-q/" class="post-title-link" itemprop="url">funny Q</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2014-11-17 23:27:44" itemprop="dateCreated datePublished" datetime="2014-11-17T23:27:44+08:00">2014-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2016-09-06 22:39:24" itemprop="dateModified" datetime="2016-09-06T22:39:24+08:00">2016-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="funny-Q"><a href="#funny-Q" class="headerlink" title="funny Q"></a>funny Q</h2><h3 id="q"><a href="#q" class="headerlink" title="$q"></a>$q</h3><blockquote>
<p>$q can be used in two fashions — one which is more similar to Kris Kowal’s Q or jQuery’s Deferred implementations, and the other which resembles ES6 promises to some degree.</p>
</blockquote>
<h3 id="ES6-style"><a href="#ES6-style" class="headerlink" title="ES6 style"></a>ES6 style</h3><blockquote>
<p>The streamlined ES6 style promise is essentially just using $q as a constructor which takes a resolver function as the first argument. </p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// assume that $q and $resource are available.</span><br><span class="line">function = asyncGo() &#123;</span><br><span class="line">    return $q( function(resolve, reject) &#123;</span><br><span class="line">        $resource(&quot;www.example.com&quot;, &#123;&#125;, &#123;&#125;)</span><br><span class="line">        .get(&#123;&#125;, function(result) &#123;</span><br><span class="line">            resolve(&quot;hello, &quot; + result);</span><br><span class="line">        &#125;, function(error) &#123;</span><br><span class="line">            reject(&quot;sorry, &quot; + error + &quot; is not allowed&quot;);</span><br><span class="line">        &#125;) </span><br><span class="line">        &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var promise = asyncGo();</span><br><span class="line">promise.then(function(greeting)&#123;</span><br><span class="line">    console.log(greeting);</span><br><span class="line">&#125;, function(err)&#123;</span><br><span class="line">    console.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Deferred-style"><a href="#Deferred-style" class="headerlink" title="Deferred style"></a>Deferred style</h3><blockquote>
<p>The purpose of the deferred object is to expose the associated Promise instance as well as APIs that can be used for signaling the successful or unsuccessful completion, as well as the status of the task.</p>
</blockquote>
<ul>
<li><p>resolve(value) – resolves the derived promise with the value. If the value is a rejection constructed via $q.reject, the promise will be rejected instead.</p>
</li>
<li><p>reject(reason) – rejects the derived promise with the reason. This is equivalent to resolving it with a rejection constructed via $q.reject.</p>
</li>
<li><p>notify(value) - provides updates on the status of the promise’s execution. This may be called multiple times before the promise is either resolved or rejected.</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">promiseB = promiseA.then(function(result) &#123;</span><br><span class="line">  return result + 1;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// promiseB will be resolved immediately after promiseA is resolved and its value</span><br><span class="line">// will be the result of promiseA incremented by 1</span><br></pre></td></tr></table></figure>

<h3 id="q-vs-rootScope"><a href="#q-vs-rootScope" class="headerlink" title="$q vs. $rootScope"></a>$q vs. $rootScope</h3><h4 id="q-is-integrated-with-the-rootScope-Scope-Scope-model-observation-mechanism-in-angular"><a href="#q-is-integrated-with-the-rootScope-Scope-Scope-model-observation-mechanism-in-angular" class="headerlink" title="$q is integrated with the $rootScope.Scope Scope model observation mechanism in angular"></a>$q is integrated with the $rootScope.Scope Scope model observation mechanism in angular</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;should simulate promise&#x27;, inject(function($q, $rootScope) &#123;</span><br><span class="line">  var deferred = $q.defer();</span><br><span class="line">  var promise = deferred.promise;</span><br><span class="line">  var resolvedValue;</span><br><span class="line"></span><br><span class="line">  promise.then(function(value) &#123; resolvedValue = value; &#125;);</span><br><span class="line">  expect(resolvedValue).toBeUndefined();</span><br><span class="line"></span><br><span class="line">  // Simulate resolving of promise</span><br><span class="line">  deferred.resolve(123);</span><br><span class="line">  // Note that the &#x27;then&#x27; function does not get called synchronously.</span><br><span class="line">  // This is because we want the promise API to always be async, whether or not</span><br><span class="line">  // it got called synchronously or asynchronously.</span><br><span class="line">  expect(resolvedValue).toBeUndefined();</span><br><span class="line"></span><br><span class="line">  // Propagate promise resolution to &#x27;then&#x27; functions using $apply().</span><br><span class="line">  $rootScope.$apply();</span><br><span class="line">  expect(resolvedValue).toEqual(123);</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<h3 id="then"><a href="#then" class="headerlink" title="then"></a>then</h3><p><code>then</code> that can accept three arguments(three callback types)–success, failure, progress.<br>for defer object, resolve will apply to success, reject apply to failure and notify apply to progress.</p>
<p>a defer object contains always, done, fail methods! so the always and done will trigger if resovle be called and return a promise object, which contains resolved result.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2014/11/09/thinking-about-microservice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lambeta">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="λ">
      <meta itemprop="description" content="Elegance and familiarity are orthogonal">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | λ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2014/11/09/thinking-about-microservice/" class="post-title-link" itemprop="url">Thinking about microservice</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2014-11-09 23:19:14" itemprop="dateCreated datePublished" datetime="2014-11-09T23:19:14+08:00">2014-11-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2016-09-06 22:39:18" itemprop="dateModified" datetime="2016-09-06T22:39:18+08:00">2016-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="谈谈我对microservice的理解"><a href="#谈谈我对microservice的理解" class="headerlink" title="谈谈我对microservice的理解"></a>谈谈我对microservice的理解</h2><h2 id="1-在比较中理解"><a href="#1-在比较中理解" class="headerlink" title="1. 在比较中理解"></a>1. 在比较中理解</h2><h3 id="功能上"><a href="#功能上" class="headerlink" title="功能上"></a>功能上</h3><h4 id="传统的service"><a href="#传统的service" class="headerlink" title="传统的service"></a>传统的service</h4><ul>
<li>功能全面，大而全；</li>
<li>系统内部耦合严重，数据服务部分互相依赖，逻辑错综复杂；</li>
<li>表现层和服务层耦合，解除耦合难以实现；</li>
<li>整个应用程序独立存在，完全不可以复用。</li>
</ul>
<h4 id="新型的microservice"><a href="#新型的microservice" class="headerlink" title="新型的microservice"></a>新型的microservice</h4><ul>
<li>多模块，每个模块功能单一；</li>
<li>采用统一的数据传输格式；</li>
<li>数据服务单独部署，可以互相依赖；</li>
<li>采用RESTful服务标准，表现层和服务层解耦；</li>
<li>分布式部署，服务可以冗余，容灾</li>
<li>采用分布式事务：BASE原则，1. Basiclly Available 2. Soft state 3.Eventually Consistent</li>
</ul>
<h3 id="开发中"><a href="#开发中" class="headerlink" title="开发中"></a>开发中</h3><h4 id="传统的service-1"><a href="#传统的service-1" class="headerlink" title="传统的service"></a>传统的service</h4><ul>
<li>代码组织结构和逻辑复杂，难以阅读；</li>
<li>功能性测试简单；</li>
<li>系统对外暴露较少，沟通成本较低。</li>
</ul>
<h4 id="新型的microservice-1"><a href="#新型的microservice-1" class="headerlink" title="新型的microservice"></a>新型的microservice</h4><ul>
<li>代码结构简单，易于阅读；</li>
<li>需要大量的mock service，以完成功能性测试；</li>
<li>web技术上可能存在跨域问题；</li>
<li>系统对外依赖较重，交互频繁；</li>
<li>人员沟通成本巨大。</li>
</ul>
<h2 id="Service-Dependency-Management"><a href="#Service-Dependency-Management" class="headerlink" title="Service Dependency Management"></a>Service Dependency Management</h2><blockquote>
<p>既然服务之间的依赖很困扰，那么为何不学习maven或者gradle，将服务依赖统一管理起来？<br>Taobao中configServer是一个独立的中央管理服务器，其作用无非让应用知晓其他应用，然后去调用；这就是依赖！<br>而且假设不同服务是有版本号的，事实上很多人已经这么做了，这个实在太类似jar的依赖管理了。</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2014/11/02/thinking-in-ioc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lambeta">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="λ">
      <meta itemprop="description" content="Elegance and familiarity are orthogonal">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | λ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2014/11/02/thinking-in-ioc/" class="post-title-link" itemprop="url">Thinking in IoC</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2014-11-02 17:09:57" itemprop="dateCreated datePublished" datetime="2014-11-02T17:09:57+08:00">2014-11-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2016-09-06 22:39:15" itemprop="dateModified" datetime="2016-09-06T22:39:15+08:00">2016-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="为什么要面向接口编程？"><a href="#为什么要面向接口编程？" class="headerlink" title="为什么要面向接口编程？"></a>为什么要面向接口编程？</h3><hr>
<h4 id="背景提要"><a href="#背景提要" class="headerlink" title="背景提要"></a>背景提要</h4><blockquote>
<p>莱恩是一名程序员，混迹Java界三载有余。从刚接触这门语言起，就被前辈告知必须遵循面向接口编程这一原则。之后，反复翻阅《设计模式》，面向接口编程的理念便深入脑髓。当然，他也不是没有思想的小白，“不好的东西不用”这种基本常识还是有的。人类这种动物，最擅长地就是提问，莱恩也会问“为什么我要面向接口编程呐？”。有经验的老人告诉过他，这样有利于解除耦合，根据依赖倒置原则——高层次的模块不应该依赖低层次的模块，抽象不应该依赖实现，实现应该依赖抽象。换句话说，就是要面向抽象编程。这顿论调，老生常谈了，但是高度概括的东西没有实践的基石，就如同空中楼阁，虚幻飘渺，能否理解，需要看小沙弥的悟性。</p>
</blockquote>
<h4 id="IoC中谁的控制权被反转？"><a href="#IoC中谁的控制权被反转？" class="headerlink" title="IoC中谁的控制权被反转？"></a>IoC中谁的控制权被反转？</h4><blockquote>
<p>莱恩实践过Java界家喻户晓的framework spring，被它强大的IoC容器深深吸引。好莱坞经典语录：“Don’t call me, I’ll call you”。它揭示的是这样一个道理：我需要你自然会找你。莱恩不禁问自己：IoC容器究竟和这个道理有什么关系呢？<br>大师说：获取和管理对象的方式被倒转了。</p>
</blockquote>
<p>接下来，通过一个实际的例子探索IoC容器的意义所在。</p>
<h4 id="面向接口编程＝定义行为的标准"><a href="#面向接口编程＝定义行为的标准" class="headerlink" title="面向接口编程＝定义行为的标准"></a>面向接口编程＝定义行为的标准</h4><p>以开关和灯泡为例：</p>
<blockquote>
<p>最简单的实现：开关依赖(<em>use</em>)灯泡，然后控制。</p>
</blockquote>
<p>这个例子中，开关创建并维护了灯泡的实例。不过有一天，灯泡要延伸出多种类型了。没关系，简单实现：</p>
<blockquote>
<p>开关依赖灯泡这个抽象东西，其余的灯泡派生自灯泡。</p>
</blockquote>
<p>好像问题也不大。然而，实际上开关不会只控制灯泡，还有冰箱，电视，空调呢？我们终于发现，其实开关的职责不是去开关灯泡，而是开合电源。<em>but who cares the electrinic?</em> 所以我们假设电源就是一只信号，某位ruby大牛把所有对象的调用，都看作是向这些对象发送message。用在这里，倒是很合理。</p>
<p>那么现在我们运用接口隔离原则，提升一个最小接口。</p>
<blockquote>
<p>依赖又不是只有聚合、组合，还有继承和<strong>实现(implement)<strong>。这样的话，我们把灯泡依赖到一个具有开合行为的接口。</strong>开关</strong>此时就定义了电源开合的接口。</p>
</blockquote>
<p>这里，灯泡并不知道哪只开关让自己或亮或暗，而开关也只知道开合某个电源接口。言而总之，所谓的面向接口编程等同于定义行为的标准。不过问题来了，谁为开关连上灯泡呢？我们现在只知道开关持有一个开合接口，不能在开关里新建一个灯泡的对象，否则好不容易获得依赖抽象的好处便会付诸东流了。</p>
<p>怎么办？记住计算机中的任何问题都能通过构造一个抽象层解决。IoC容器就是干这件事的，根据各个实例之间的依赖关系创建和管理对象的实例。</p>
<p>所以说，IoC中被反转控制权的是获取和管理对象的方式，它被反转到IoC容器当中了。“I’ll call you.”中的I也就是IoC容器。</p>
<h4 id="谈谈IoC和DI"><a href="#谈谈IoC和DI" class="headerlink" title="谈谈IoC和DI"></a>谈谈IoC和DI</h4><p>大部分书上，都把这两者混为一谈。</p>
<p>DI是IoC的子集。IoC是个泛泛之论，通俗来讲，任何有利于程序高内聚低耦合的框架都具有IoC的特征。在OO里，Dependency被反转；在基于Event的编程模型里，Event Loop被反转了；在Observer Pattern中，Subject通知Observer的方式被反转了。</p>
<h4 id="方法级别上的IoC"><a href="#方法级别上的IoC" class="headerlink" title="方法级别上的IoC"></a>方法级别上的IoC</h4><p>Template Method方法具有IoC的特点：</p>
<ul>
<li>父类方法决定了必要的流程和某些不变的部分；</li>
<li>子类继承父类，重写可变的方法；</li>
<li>子类只关心职责，而不关心流程。</li>
</ul>
<p>所以是父类定义了标准，让子类实现之。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><hr>
<ul>
<li>IoC不等于DI；</li>
<li>IoC不是对象的专利，方法级别一样适用。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2014/10/30/vim-in-practice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lambeta">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="λ">
      <meta itemprop="description" content="Elegance and familiarity are orthogonal">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | λ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2014/10/30/vim-in-practice/" class="post-title-link" itemprop="url">vim in practice (1)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2014-10-30 23:08:38" itemprop="dateCreated datePublished" datetime="2014-10-30T23:08:38+08:00">2014-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2016-09-06 22:39:12" itemprop="dateModified" datetime="2016-09-06T22:39:12+08:00">2016-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Vim-Practice"><a href="#Vim-Practice" class="headerlink" title="Vim Practice"></a>Vim Practice</h2><h3 id=""><a href="#" class="headerlink" title="&lt;leader&gt;"></a>&lt;leader&gt;</h3><blockquote>
<p>Vim have a extra key to activate mappings, and call this “prefix” key the “leader”.</p>
<blockquote>
<p>*Mapping keys is one of the places where Vim comments does’t work. </p>
</blockquote>
</blockquote>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let mapleader=&#x27;,&#x27;</span><br><span class="line">nnoremap &lt;leader&gt;ev :vsplit $MYVIMRC&lt;cr&gt;</span><br><span class="line">nnoremap &lt;leader&gt;sv :source $MYVIMRC&lt;cr&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Abbrevation"><a href="#Abbrevation" class="headerlink" title="Abbrevation"></a>Abbrevation</h3><blockquote>
<p>Vim has a feature called “abbreviations” that feel similar to mappings but are meant for use in insert, replace, and command modes. </p>
</blockquote>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iabbrev what what</span><br><span class="line">when you type *what&lt;space&gt;*</span><br><span class="line">were substituted with *what&lt;space&gt;*</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Disable-old-keys"><a href="#Disable-old-keys" class="headerlink" title="Disable old keys"></a>Disable old keys</h3><blockquote>
<p>This effectively disables the escape key in insert mode by telling Vim to perform <nop> (no operation) instead.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inoremap &lt;esc&gt; &lt;nop&gt; &quot;no operation</span><br></pre></td></tr></table></figure>

<h3 id="Autocommands"><a href="#Autocommands" class="headerlink" title="Autocommands"></a>Autocommands</h3><blockquote>
<p>Autocommands are the way to tell Vim to run commands whenever certain events happen.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">:autocmd BufNewFile * :write</span><br><span class="line">         ^          ^ ^</span><br><span class="line">         |          | |</span><br><span class="line">         |          | The command to run.</span><br><span class="line">         |          |</span><br><span class="line">         |          A &quot;pattern&quot; to filter the event.</span><br><span class="line">         |</span><br><span class="line">         The &quot;event&quot; to watch for.</span><br><span class="line"></span><br><span class="line">:autocmd BufWritePre,BufRead *.html :normal gg=G</span><br><span class="line">:help autocmd-events</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="System-clipboard"><a href="#System-clipboard" class="headerlink" title="System clipboard"></a>System clipboard</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BundleInstall fakeclip</span><br><span class="line">1. Normal mode</span><br><span class="line">&quot;+Y or &quot;+yy (use system register&lt;+&gt; to copy)</span><br><span class="line">2. Visual mode</span><br><span class="line">&quot;+Y</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2014/10/11/briefing-of-programming-language/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lambeta">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="λ">
      <meta itemprop="description" content="Elegance and familiarity are orthogonal">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | λ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2014/10/11/briefing-of-programming-language/" class="post-title-link" itemprop="url">程序语言的精髓</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2014-10-11 00:31:34" itemprop="dateCreated datePublished" datetime="2014-10-11T00:31:34+08:00">2014-10-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2016-09-12 21:53:54" itemprop="dateModified" datetime="2016-09-12T21:53:54+08:00">2016-09-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>当夜幕已近闭合，沉睡的晚灯张起结界，昏黄中没半点柔情，仿佛在告诉行人：非诚勿扰</code></p>
<blockquote>
<p>夜晚11:11分，注定孤独的时分。Carl倚靠窗台失神了半晌，回过来就顺手拉紧了窗帘。拧开台灯，桌上静静地躺着一本书，是日本人西尾太和的《代码之髓》。他翻开扉页，签上自己的大名，满足地撇撇嘴，开始看起来。</p>
</blockquote>
<h3 id="Lisp是这个世界上最精练，最美观的语言"><a href="#Lisp是这个世界上最精练，最美观的语言" class="headerlink" title="Lisp是这个世界上最精练，最美观的语言"></a>Lisp是这个世界上最精练，最美观的语言</h3><hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(setq f</span><br><span class="line">      (let ((x 1))</span><br><span class="line">        (lambda (y) (* x y))))</span><br></pre></td></tr></table></figure>
<p>直观上，这个函数f的结果就是(* 1 y)，也就是y的值。那么实际调用的结果如何呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(let ((x 2))</span><br><span class="line">  (funcall f 2))</span><br></pre></td></tr></table></figure>
<p>即f(2)的结果是2？实际运行的结果让人大跌眼镜，是4！</p>
<blockquote>
<p>Carl揉揉被蹂躏多时的眼球，问自己：为什么是这样，像梦一场？</p>
</blockquote>
<p>行文到这里，我们的黑暗主角慢慢走向台前——作用域(Scope)。作用域在程序的世界里，见怪不怪，谁都知道它的第一要务就是防止命名冲突！</p>
<blockquote>
<p>Carl点点头，道：嗯，教材里是这么说的。他抬头看了一下光，阴影里有种烦躁的情绪在跳动。</p>
</blockquote>
<p>其实，作用域是分类别的。Lisp中用到了其中之一的动态作用域(Dynamic Scope)，动态作用域最根本的特点是从时间维度上判断进入和离开某个函数具有独立的作用域。上面Lisp的例子当中，<code>(let ((x 2)) (funcall f 2))</code>表示一个函数，也就是独立的作用域。它调用了f这个函数，但从时间上看，调用点依旧处于原来的作用域当中，所以x&#x3D;2这样的变量在f函数里是有效的，最后的结果是(* 2 y)，等于4也就理所应当了。</p>
<blockquote>
<p>Carl接受了这样的解释，他想：既然存在，那么一定合理。闭目养神的时间里，他的思维遨游了很久，有溺水的迹象，仿佛得到了神启。他想到了人生，理想，家人，婚姻和<code>python2</code></p>
</blockquote>
<h3 id="在python2里面，这个世界里有怪物存在——嵌套的函数和外部作用域的再绑定。"><a href="#在python2里面，这个世界里有怪物存在——嵌套的函数和外部作用域的再绑定。" class="headerlink" title="在python2里面，这个世界里有怪物存在——嵌套的函数和外部作用域的再绑定。"></a>在<code>python2</code>里面，这个世界里有怪物存在——嵌套的函数和外部作用域的再绑定。</h3><hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x = &quot;global&quot;</span><br><span class="line">def foo():</span><br><span class="line">	x = &quot;foo&quot;</span><br><span class="line">	def bar():</span><br><span class="line">		print x</span><br><span class="line">	bar()</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>
<p>答案是global，而不是想当然的foo。<code>python2</code>里头使用了静态作用域(Static Scope), 与动态作用域相对。静态作用域的显著特点是源码级别上拥有独立的作用域，简单地可以理解成每一个函数都是独立的作用域。然后，2011年发布的<code>python2.1</code>修改了逻辑，最终返回了foo，他们显然认为嵌套的函数不是函数，而是形同if&#x2F;else这样的嵌套结构体。感觉上，又回到了当初动态作用域的年代。</p>
<blockquote>
<p>Carl咽了口水，他讨厌动态作用域如同父母窥视了孩子狭小私人空间，这让他很不舒服。有一首诗：阴郁的日子总会过去。接下来，事情总算不太坏。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def foo():</span><br><span class="line">	x = &quot;old&quot;</span><br><span class="line">	def bar():</span><br><span class="line">		x ＝ &quot;new&quot;</span><br><span class="line">	bar()</span><br><span class="line">	print x</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>
<p>这回得到的还是old。</p>
<blockquote>
<p>Carl笑了，这才像话。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def foo():</span><br><span class="line">	x = &quot;old&quot;</span><br><span class="line">	def bar():</span><br><span class="line">		nonlocal x</span><br><span class="line">		x ＝ &quot;new&quot;</span><br><span class="line">	bar()</span><br><span class="line">	print x</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>
<p>这回得到的却是new。</p>
<blockquote>
<p>Carl哭了。他想起来了，java里的类，private, protected修饰符，还有静态变量。他触摸到了作用域的本质，如同一直看不见的手，抚摸那薄膜面纱背后吹弹可破的脸蛋。至于有没有被赐予洪亮的耳光，那已经是后话了。</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://qianyan.github.io/2014/09/25/a-way-to-handle-angularjs-components-problem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lambeta">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="λ">
      <meta itemprop="description" content="Elegance and familiarity are orthogonal">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | λ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2014/09/25/a-way-to-handle-angularjs-components-problem/" class="post-title-link" itemprop="url">AngularJS components</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2014-09-25 00:08:02" itemprop="dateCreated datePublished" datetime="2014-09-25T00:08:02+08:00">2014-09-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2017-01-01 17:19:50" itemprop="dateModified" datetime="2017-01-01T17:19:50+08:00">2017-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><hr>
<p>假设某种Web App的业务场景是这样的：每个页面仅仅只有简单的表单，包括文字提醒label, 单选radio button, 问题列表dropdown menu, 处理页面前后跳转的button, 复杂一点的如价格输入input，时间选择date picker。而且这些可以独立展现业务价值，也就是说任何一个或者多个这样的页面元素可以经过简单组合，甚至无需组合就能反映一个独立的业务提问（具备评估填写人能力的价值），那么我们就可以将这些页面元素及其简单的组合体作为一个独立的component。这些component最大的好处就是恰如其分地反映了它本身的业务，但是这也不能成为封装成component的理由——因为我们完全可以通过一个良好名称的id来反映。独立出来的好处无非两个：可插拔，能复用。</p>
<p>首先，来讨论一下可插拔这个问题。假如BA美女告诉说某个业务提问T不应该再出现在A页面了，它应该出现在B页面。若不是component，问题来了：我们需要删掉本页面的T，连带着需要删除分散的js和css文件。麻烦！若是独立一个component，简单了先解除该页面对T的使用（在AngularJS中是删除对应的指令），然后在B页面导入进来。因为是component，且每个页面的结构都是表单，代码结构也类似，所以改动的量少。方便！</p>
<p>再来讨论一下能复用这个问题。我刚才提到过，因为是反映一个独立的业务提问，所以很可能在其他同类的产品上，这东西也是存在的，可能唯一不同的就是问法不同，以及提示信息有别。换句话说这些问句和提示是可编辑的。有人说那简单呐，component的所有提问和提示信息弄成可编辑的不就行了？component是可变的（可编辑），但是具体在哪个页面给出什么提问和提示总是不变的吧。我原来也是这样想的，但是仔细想想我发现这里有一个矛盾之处：我们想复用业务，而不是组件！这世界上最不可信的就是业务，最可能变的也是业务，但我们还异想天开地复用业务。任何一个独立的component，在具体的业务上，都很可能不是简单地替换显示文本，它完全会增加一小条额外的询问条目！那么原来的component就只能乖乖地被copy&#x2F;paste成另一个可怜的component——因为它们是不同的业务啊！BA如是说。作为程序员，我讨厌重复的代码，这也是我们不断使用重构的原因。但是就因为业务不同，哪怕代码相似度是99%，我也得重新创建一个，这个实在不值得！</p>
<p>而且，更奇葩地是这些可编辑信息居然被写入了后端的properties文件当中，使用Java这样静态的语言来抽象出一个给这些component提供文本信息的接口。试想一下，哪天某个BA告诉我：我想为某个业务X，添加一个subTitle。我的回答：不行呐，我们的接口只提供了一个label，而且这里已经使用了，我如果加一个新的，会影响其他的所有component的。BA：!&amp;^$%@$. 我接着说：我可以提供一个sub.label的property key，这样前端可以写成 [X.sub].label，如何？BA：呵呵……</p>
<h3 id="探索"><a href="#探索" class="headerlink" title="探索"></a>探索</h3><hr>
<h4 id="简单得出几个结论"><a href="#简单得出几个结论" class="headerlink" title="简单得出几个结论"></a>简单得出几个结论</h4><ul>
<li>不用妄图复用业务，即使它们在UI表现上极其相似；</li>
<li>业务和UI的关系，等同于饮料和瓶子的关系，瓶子一个模子就够了，饮料随便换；</li>
<li>饮料要换个瓶模子了，那换就是，具体是从原来的模子继承，还是组合，饮料不需要关心。</li>
</ul>
<h4 id="如何做瓶子，如何换饮料，如何组合成卖品"><a href="#如何做瓶子，如何换饮料，如何组合成卖品" class="headerlink" title="如何做瓶子，如何换饮料，如何组合成卖品"></a>如何做瓶子，如何换饮料，如何组合成卖品</h4><p>做瓶子简单。作为程序员，我使用AngularJS的Directive构建基础的common components，如radio button, dropdown menu, search box. 这些仅仅和UI相关。当然这些还仅仅是瓶子的组成成分。</p>
<p>那么接下来，如何换饮料呢？饮料有自己的骄傲——它不仅口味各异，还分品牌！每种品牌下的饮料自然不同。那我们只好先做一下分类。先从品牌开始，先分成X, Y, Z这几类，然后开始分口味了，又分成A, B, C这几类。这个季度，老板说我们要推出X类的A, B, C饮料！怎么做？我们把A, B, C写入配置文件(properties)，拿A举例子：A有颜色，甜度，气味三个属性，分别对应如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A:</span><br><span class="line">  color: red</span><br><span class="line">  sweet: middle</span><br><span class="line">  smell: nice</span><br></pre></td></tr></table></figure>
<p>Ok，接下来我们来构造A这款饮料的<strong>业务</strong>的directive</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(function(global, angular)&#123;</span><br><span class="line">    &#x27;use strict&#x27;;</span><br><span class="line">    angular.module(&#x27;a.b.c&#x27;,[])</span><br><span class="line">        .directive(&#x27;A&#x27;, function()&#123;</span><br><span class="line">           return &#123;</span><br><span class="line">               restrict: &#x27;AE&#x27;,</span><br><span class="line">               templateUrl: &#x27;views/A.html&#x27;</span><br><span class="line">           &#125;;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;)(this, angular);</span><br></pre></td></tr></table></figure>
<p>好了，我们有业务细节A了，又有业务A的directive了。我们理所应当地认为这个directive和A应该是一体的，为什么不直接将A细节写入directive的scope中呢？答案是X, Y, Z在这里是可以复用这个directive的，所以不能硬编码。不能硬编码，我首先的直觉就是变量替换，又要求复用，那么就立马想到了继承或者组合。又因为组合优于继承（更现实的是我不知道如何在AngularJS中实现继承），我决定使用组合。接下来这个过程的产出物就是我们的卖品，构造如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># define in common module</span><br><span class="line">A:&#123;</span><br><span class="line">  color: red,</span><br><span class="line">  sweet: middle,</span><br><span class="line">  smell: nice</span><br><span class="line">&#125;</span><br><span class="line">##</span><br><span class="line"></span><br><span class="line">(function(global, angular)&#123;</span><br><span class="line">    &#x27;use strict&#x27;;</span><br><span class="line">    angular.module(&#x27;a.b.c&#x27;, [&#x27;common&#x27;])</span><br><span class="line">        .directive(&#x27;A&#x27;, [&#x27;me&#x27;, function()&#123;</span><br><span class="line">           return &#123;</span><br><span class="line">               restrict: &#x27;AE&#x27;,</span><br><span class="line">               scope: &#123;</span><br><span class="line">                  self: &#x27;=&#x27;</span><br><span class="line">               &#125;,</span><br><span class="line">               link: function($scope) &#123;</span><br><span class="line">               	   $scope.self = me;</span><br><span class="line">               &#125;,</span><br><span class="line">               templateUrl: &#x27;views/A.html&#x27;</span><br><span class="line">           &#125;;</span><br><span class="line">        &#125;]);</span><br><span class="line">&#125;)(this, angular);</span><br></pre></td></tr></table></figure>
<p>从代码中很容易看出，我们把A这个业务，组成了一个叫做common的module，可以类比为装着众多饮料的机器，然后对准一个叫做A的瓶子注入，注意A这个瓶子用到了很多common components。这整个过程就是Angular完成这个A的directive的过程，也就是饮料和瓶子组装的过程。然后这个A的directive就是我们的卖品。</p>
<h3 id="实际成效"><a href="#实际成效" class="headerlink" title="实际成效"></a>实际成效</h3><hr>
<p>事实验证，上述的方式是不合理的。理由有下面三点：</p>
<ul>
<li>依赖过剩。我们将会有很多的components，如果每次都得手动注入common依赖的话，量实在是太大了。</li>
<li>非独立。一个纯净的业务组件不应该有第三方的依赖，有依赖，必然导致无法独立使用。</li>
<li>不可扩展设备。这个最大的怪兽就是我们将业务的东西全部放到了前端，如果要兼容其他设备，我们后端的这块业务功能是缺失的，不能给其他设备提供支持。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">lambeta</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>






  <script src="/js/third-party/addtoany.js"></script>

  





</body>
</html>
